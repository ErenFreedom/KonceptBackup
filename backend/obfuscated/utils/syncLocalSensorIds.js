const a2_0x4dd51d=a2_0x54c4;(function(_0x480737,_0xfb0473){const _0xe50270=a2_0x54c4,_0x21d27b=_0x480737();while(!![]){try{const _0x347d2d=-parseInt(_0xe50270(0x1c9))/0x1+-parseInt(_0xe50270(0x1ef))/0x2*(-parseInt(_0xe50270(0x1c3))/0x3)+-parseInt(_0xe50270(0x1e6))/0x4+-parseInt(_0xe50270(0x1bb))/0x5*(-parseInt(_0xe50270(0x1c5))/0x6)+-parseInt(_0xe50270(0x1e3))/0x7*(parseInt(_0xe50270(0x1f0))/0x8)+parseInt(_0xe50270(0x1cf))/0x9+-parseInt(_0xe50270(0x1ec))/0xa;if(_0x347d2d===_0xfb0473)break;else _0x21d27b['push'](_0x21d27b['shift']());}catch(_0xdac557){_0x21d27b['push'](_0x21d27b['shift']());}}}(a2_0x2833,0xd9853));function a2_0x54c4(_0x1c2704,_0x31d143){const _0x28330a=a2_0x2833();return a2_0x54c4=function(_0x54c454,_0x119b1e){_0x54c454=_0x54c454-0x1b6;let _0x49ec2e=_0x28330a[_0x54c454];return _0x49ec2e;},a2_0x54c4(_0x1c2704,_0x31d143);}const axios=require('axios'),jwt=require(a2_0x4dd51d(0x1d2));function a2_0x2833(){const _0x5d332f=['/api/sensors/list','log','6897650AkdKcH','Bearer\x20','humjU','1002398gMwmtu','312PSHHFT','jEyml','❌\x20Error\x20syncing\x20Local\x20Sensor\x20IDs:','env','token','SELECT\x20token\x20FROM\x20AuthTokens\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x201','15JCSuzG','Error\x20fetching\x20token\x20from\x20database','kJdIi','xTtaV','CLOUD_API_URL','❌\x20Error\x20fetching\x20token:','error','exports','9WfIbQk','🔍\x20Extracted\x20companyId:\x20','892686VpuSgk','CHSgR','OqZTr','sensors','523604bzKYxb','Failed\x20to\x20fetch\x20sensors\x20from\x20Cloud\x20DB','lHfMD','lJgJT','response','run','8688690UGfquv','SREiJ','fgBrh','jsonwebtoken','get','JWT_SECRET_APP','Invalid\x20token','companyId','No\x20stored\x20token\x20found.','data','WOAcr','✅\x20Received\x20','📤\x20Fetching\x20sensors\x20from\x20Cloud:\x20','JQSCM','object_id','❌\x20Error\x20decoding\x20JWT:','UPDATE\x20LocalSensorBank\x20SET\x20id\x20=\x20?\x20WHERE\x20object_id\x20=\x20?','⚠\x20No\x20sensors\x20to\x20update\x20in\x20Local\x20DB.','\x20sensors\x20from\x20Cloud.','⚠\x20No\x20sensors\x20found\x20in\x20Cloud\x20DB.','84455WCuGCp','message','length','1361932igaeKy','forEach','wZGfx','❌\x20Error\x20updating\x20Sensor\x20ID\x20for\x20'];a2_0x2833=function(){return _0x5d332f;};return a2_0x2833();}require('dotenv')['config']();const {db}=require('../db/sensorDB'),getStoredToken=()=>{const _0x18401d=a2_0x4dd51d,_0x5cb81f={'ScAsr':function(_0x4ca714,_0x2699b6){return _0x4ca714(_0x2699b6);},'xTtaV':_0x18401d(0x1bc),'CHSgR':_0x18401d(0x1d7),'fgBrh':_0x18401d(0x1ba)};return new Promise((_0x330057,_0x3d22cc)=>{const _0x3e2649=_0x18401d,_0x2d8c57={'OqZTr':function(_0x32ebfd,_0x365ac2){return _0x5cb81f['ScAsr'](_0x32ebfd,_0x365ac2);},'SREiJ':_0x5cb81f[_0x3e2649(0x1be)],'kJdIi':_0x5cb81f[_0x3e2649(0x1c6)]};db['get'](_0x5cb81f[_0x3e2649(0x1d1)],[],(_0x40267c,_0x3c5f49)=>{const _0x4e5585=_0x3e2649;if(_0x40267c)console[_0x4e5585(0x1c1)](_0x4e5585(0x1c0),_0x40267c[_0x4e5585(0x1e4)]),_0x2d8c57[_0x4e5585(0x1c7)](_0x3d22cc,_0x2d8c57[_0x4e5585(0x1d0)]);else!_0x3c5f49?_0x2d8c57[_0x4e5585(0x1c7)](_0x3d22cc,_0x2d8c57[_0x4e5585(0x1bd)]):_0x2d8c57[_0x4e5585(0x1c7)](_0x330057,_0x3c5f49[_0x4e5585(0x1b9)]);});});},getCompanyIdFromToken=async()=>{const _0x4517d0=a2_0x4dd51d,_0x58f2f5={'JQSCM':function(_0x598270){return _0x598270();},'HOGgs':_0x4517d0(0x1de),'humjU':_0x4517d0(0x1d5)};try{const _0x3b0bca=await _0x58f2f5[_0x4517d0(0x1dc)](getStoredToken),_0x5696b1=jwt['verify'](_0x3b0bca,process[_0x4517d0(0x1b8)][_0x4517d0(0x1d4)]);return console[_0x4517d0(0x1eb)](_0x4517d0(0x1c4)+_0x5696b1[_0x4517d0(0x1d6)]),{'token':_0x3b0bca,'companyId':_0x5696b1[_0x4517d0(0x1d6)]};}catch(_0x5ce717){console[_0x4517d0(0x1c1)](_0x58f2f5['HOGgs'],_0x5ce717[_0x4517d0(0x1e4)]);throw new Error(_0x58f2f5[_0x4517d0(0x1ee)]);}},fetchCloudSensors=async _0x9f3d45=>{const _0x21a73b=a2_0x4dd51d,_0x45ec18={'jEyml':function(_0x13802c,_0xee2db7){return _0x13802c===_0xee2db7;},'oMTdt':_0x21a73b(0x1e2)};try{const _0x3f4ae4=process[_0x21a73b(0x1b8)][_0x21a73b(0x1bf)]+_0x21a73b(0x1ea);console[_0x21a73b(0x1eb)](_0x21a73b(0x1db)+_0x3f4ae4);const _0x58a5e6=await axios[_0x21a73b(0x1d3)](_0x3f4ae4,{'headers':{'Authorization':_0x21a73b(0x1ed)+_0x9f3d45}});if(!_0x58a5e6[_0x21a73b(0x1d8)][_0x21a73b(0x1c8)]||_0x45ec18[_0x21a73b(0x1b6)](_0x58a5e6[_0x21a73b(0x1d8)][_0x21a73b(0x1c8)][_0x21a73b(0x1e5)],0x0))return console[_0x21a73b(0x1eb)](_0x45ec18['oMTdt']),[];return console[_0x21a73b(0x1eb)](_0x21a73b(0x1da)+_0x58a5e6[_0x21a73b(0x1d8)][_0x21a73b(0x1c8)]['length']+_0x21a73b(0x1e1)),_0x58a5e6[_0x21a73b(0x1d8)][_0x21a73b(0x1c8)];}catch(_0x566b2f){console[_0x21a73b(0x1c1)]('❌\x20Error\x20fetching\x20sensors\x20from\x20Cloud:',_0x566b2f[_0x21a73b(0x1cd)]?.['data']||_0x566b2f[_0x21a73b(0x1e4)]);throw new Error(_0x21a73b(0x1ca));}},updateLocalSensorIds=async()=>{const _0x385f09=a2_0x4dd51d,_0x2d5625={'wZGfx':function(_0x4238ca){return _0x4238ca();},'WOAcr':function(_0x5c0f3f,_0x3eaca2){return _0x5c0f3f(_0x3eaca2);},'lHfMD':function(_0x4cf2b1,_0x3ede65){return _0x4cf2b1===_0x3ede65;},'lJgJT':_0x385f09(0x1e0)};try{const {token:_0x5aa45c,companyId:_0x4d8481}=await _0x2d5625[_0x385f09(0x1e8)](getCompanyIdFromToken),_0x107d51=await _0x2d5625[_0x385f09(0x1d9)](fetchCloudSensors,_0x5aa45c);if(_0x2d5625[_0x385f09(0x1cb)](_0x107d51[_0x385f09(0x1e5)],0x0)){console[_0x385f09(0x1eb)](_0x2d5625[_0x385f09(0x1cc)]);return;}_0x107d51[_0x385f09(0x1e7)](_0xff6bba=>{const _0x37ce78=_0x385f09;db[_0x37ce78(0x1ce)](_0x37ce78(0x1df),[_0xff6bba['id'],_0xff6bba[_0x37ce78(0x1dd)]],_0x230d5e=>{const _0x4325e3=_0x37ce78;_0x230d5e?console['error'](_0x4325e3(0x1e9)+_0xff6bba['object_id']+':',_0x230d5e[_0x4325e3(0x1e4)]):console['log']('✅\x20Updated\x20Local\x20SensorBank:\x20object_id='+_0xff6bba[_0x4325e3(0x1dd)]+'\x20→\x20id='+_0xff6bba['id']);});}),console[_0x385f09(0x1eb)]('✅\x20ID\x20Sync\x20completed\x20successfully!');}catch(_0x5e4a2b){console[_0x385f09(0x1c1)](_0x385f09(0x1b7),_0x5e4a2b['message']);}};module[a2_0x4dd51d(0x1c2)]={'updateLocalSensorIds':updateLocalSensorIds};