function a0_0x4343(_0x374f93,_0x42c574){const _0x45ec44=a0_0x45ec();return a0_0x4343=function(_0x434304,_0x1004b6){_0x434304=_0x434304-0x19f;let _0x1a4052=_0x45ec44[_0x434304];return _0x1a4052;},a0_0x4343(_0x374f93,_0x42c574);}const a0_0x4da358=a0_0x4343;(function(_0x152d11,_0x56a46c){const _0xcc954e=a0_0x4343,_0x4a855e=_0x152d11();while(!![]){try{const _0x5130c0=parseInt(_0xcc954e(0x1bb))/0x1+parseInt(_0xcc954e(0x1ac))/0x2*(-parseInt(_0xcc954e(0x1cc))/0x3)+parseInt(_0xcc954e(0x1ca))/0x4*(parseInt(_0xcc954e(0x1c8))/0x5)+-parseInt(_0xcc954e(0x1dd))/0x6*(-parseInt(_0xcc954e(0x1b5))/0x7)+-parseInt(_0xcc954e(0x1d8))/0x8*(parseInt(_0xcc954e(0x1cf))/0x9)+parseInt(_0xcc954e(0x1b9))/0xa*(-parseInt(_0xcc954e(0x19f))/0xb)+-parseInt(_0xcc954e(0x1a4))/0xc;if(_0x5130c0===_0x56a46c)break;else _0x4a855e['push'](_0x4a855e['shift']());}catch(_0x3ad1a1){_0x4a855e['push'](_0x4a855e['shift']());}}}(a0_0x45ec,0x59317));const axios=require(a0_0x4da358(0x1a1)),jwt=require(a0_0x4da358(0x1c3)),{db}=require('../db/sensorDB');require(a0_0x4da358(0x1b4))[a0_0x4da358(0x1b8)]();const CLOUD_API_URL=process[a0_0x4da358(0x1a7)]['CLOUD_API_URL'],syncAllSubSites=async()=>{const _0x38fcc4=a0_0x4da358,_0x2dc178={'JxLaV':function(_0x19933d,_0x572aa7){return _0x19933d||_0x572aa7;},'OmsPs':'❌\x20Sub-site\x20sync\x20failed:'};try{db['get']('SELECT\x20token\x20FROM\x20AuthTokens\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x201',async(_0x1040d2,_0x23232f)=>{const _0x113831=a0_0x4343;if(_0x2dc178[_0x113831(0x1a0)](_0x1040d2,!_0x23232f)){console[_0x113831(0x1b7)](_0x113831(0x1ab));return;}const _0x147fc3=_0x23232f[_0x113831(0x1df)];let _0x5b5e93;try{_0x5b5e93=jwt[_0x113831(0x1d5)](_0x147fc3,process[_0x113831(0x1a7)]['JWT_SECRET_APP']);}catch(_0x38b0bb){console[_0x113831(0x1b7)](_0x113831(0x1e7),_0x38b0bb[_0x113831(0x1ba)]);return;}const _0x3b140b=_0x5b5e93['companyId']||_0x5b5e93[_0x113831(0x1c6)],_0x5532a3=await axios[_0x113831(0x1da)](CLOUD_API_URL+_0x113831(0x1b1),{'headers':{'Authorization':_0x113831(0x1cd)+_0x147fc3}});for(const _0x290ec2 of _0x5532a3[_0x113831(0x1e2)][_0x113831(0x1c2)]){const {subsiteId:_0x38f4e0,sensorBank:_0x50b293,activeSensors:_0xa5e160,sensorApis:_0x569b42,sensorDataBankIds:_0x2fdae8}=_0x290ec2,_0x32258f=_0x113831(0x1c1)+_0x3b140b+'_'+_0x38f4e0,_0x1c26c1=_0x113831(0x1d7)+_0x3b140b+'_'+_0x38f4e0,_0x2668e5=_0x113831(0x1ae)+_0x3b140b+'_'+_0x38f4e0;db['serialize'](()=>{const _0x37df12=_0x113831;db[_0x37df12(0x1d3)]('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20'+_0x32258f+_0x37df12(0x1e0)),db['run'](_0x37df12(0x1cb)+_0x1c26c1+_0x37df12(0x1db)+_0x32258f+_0x37df12(0x1bd)),db[_0x37df12(0x1d3)]('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20'+_0x2668e5+_0x37df12(0x1e6)+_0x32258f+_0x37df12(0x1bd));const _0x12765c=_0x37df12(0x1b2)+_0x3b140b+'_'+_0x38f4e0;db[_0x37df12(0x1d3)](_0x37df12(0x1e1)+_0x12765c+_0x37df12(0x1ad)+_0x1c26c1+_0x37df12(0x1a9),_0x354cfb=>{const _0x2439c2=_0x37df12;if(_0x354cfb)console[_0x2439c2(0x1b7)](_0x2439c2(0x1d6)+_0x12765c+':',_0x354cfb[_0x2439c2(0x1ba)]);});const _0x4d2f82=_0x37df12(0x1b6)+_0x3b140b+'_'+_0x38f4e0;db[_0x37df12(0x1d3)](_0x37df12(0x1c4)+_0x4d2f82+_0x37df12(0x1ce),_0x1e3e86=>{const _0xd8fd5f=_0x37df12;if(_0x1e3e86)console[_0xd8fd5f(0x1b7)](_0xd8fd5f(0x1d0)+_0x4d2f82+':',_0x1e3e86['message']);});for(const _0xf81dd of _0x50b293){db['run'](_0x37df12(0x1d2)+_0x32258f+_0x37df12(0x1a5),[_0xf81dd['id'],_0xf81dd[_0x37df12(0x1d4)],_0xf81dd[_0x37df12(0x1e4)],_0xf81dd[_0x37df12(0x1a6)],_0xf81dd[_0x37df12(0x1c0)],_0xf81dd['data_type'],_0xf81dd['is_active'],_0xf81dd[_0x37df12(0x1bc)],_0xf81dd[_0x37df12(0x1a8)],_0xf81dd[_0x37df12(0x1dc)],_0x38f4e0],_0x3534f5=>{const _0x254161=_0x37df12;if(_0x3534f5)console[_0x254161(0x1b7)](_0x254161(0x1b3)+_0x38f4e0+']:',_0x3534f5[_0x254161(0x1ba)]);});}for(const _0x20a7d8 of _0xa5e160){db[_0x37df12(0x1d3)]('INSERT\x20OR\x20IGNORE\x20INTO\x20'+_0x1c26c1+_0x37df12(0x1c5),[_0x20a7d8['id'],_0x20a7d8[_0x37df12(0x1aa)],_0x20a7d8['is_active'],_0x20a7d8['created_at'],_0x20a7d8[_0x37df12(0x1dc)]],_0x319c04=>{const _0x7e6b62=_0x37df12;if(_0x319c04)console[_0x7e6b62(0x1b7)](_0x7e6b62(0x1e5)+_0x38f4e0+']:',_0x319c04['message']);});}for(const _0x107cc7 of _0x569b42){db[_0x37df12(0x1d3)]('INSERT\x20OR\x20IGNORE\x20INTO\x20'+_0x2668e5+'\x20VALUES\x20(?,\x20?,\x20?,\x20?)',[_0x107cc7['id'],_0x107cc7['sensor_id'],_0x107cc7[_0x37df12(0x1a2)],_0x107cc7['created_at']],_0x7ae257=>{const _0x31ea25=_0x37df12;if(_0x7ae257)console[_0x31ea25(0x1b7)](_0x31ea25(0x1d1)+_0x38f4e0+']:',_0x7ae257[_0x31ea25(0x1ba)]);});}});for(const _0x3780ea of _0x2fdae8){const _0x17e4f2=_0x113831(0x1be)+_0x3b140b+'_'+_0x38f4e0+'_'+_0x3780ea,_0x3b3377=_0x113831(0x1d7)+_0x3b140b+'_'+_0x38f4e0,_0x5b6268='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20'+_0x17e4f2+_0x113831(0x1af)+_0x3b3377+'(id)\x20ON\x20DELETE\x20CASCADE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';db[_0x113831(0x1d3)](_0x5b6268,_0x1220b8=>{const _0x238b17=_0x113831;_0x1220b8?console['error'](_0x238b17(0x1c7)+_0x17e4f2+':',_0x1220b8['message']):console[_0x238b17(0x1b0)](_0x238b17(0x1e3)+_0x17e4f2);});}console['log'](_0x113831(0x1d9)+_0x38f4e0+_0x113831(0x1de)+_0x50b293[_0x113831(0x1c9)]+',\x20ActiveSensors:\x20'+_0xa5e160['length']+_0x113831(0x1a3)+_0x569b42[_0x113831(0x1c9)]+')');}});}catch(_0xec590f){console[_0x38fcc4(0x1b7)](_0x2dc178[_0x38fcc4(0x1bf)],_0xec590f[_0x38fcc4(0x1ba)]);}};module['exports']={'syncAllSubSites':syncAllSubSites};function a0_0x45ec(){const _0x3b8853=['message','545882wWwQmS','room_id','(id)\x20ON\x20DELETE\x20CASCADE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);','SensorData_','OmsPs','property_name','SensorBank_','result','jsonwebtoken','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(id,\x20bank_id,\x20is_active,\x20created_at,\x20updated_at)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','company_id','❌\x20Failed\x20to\x20create\x20table\x20','52425gqrAaB','length','236RCBNAq','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20','792tytgvd','Bearer\x20','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20sensor_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20log\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20timestamp\x20DATETIME\x20DEFAULT\x20CURRENT_TIMESTAMP\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','3977118AQCvYy','❌\x20Failed\x20to\x20create\x20log\x20table\x20','❌\x20Insert\x20failed\x20[SensorAPI\x20','INSERT\x20OR\x20IGNORE\x20INTO\x20','run','name','verify','❌\x20Failed\x20to\x20create\x20','Sensor_','8wDfFMj','✅\x20Synced\x20sub-site\x20','get','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20bank_id\x20INTEGER\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20mode\x20TEXT\x20CHECK(\x20mode\x20IN\x20(\x27real_time\x27,\x20\x27manual\x27)\x20)\x20DEFAULT\x20\x27manual\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20interval_seconds\x20INTEGER\x20CHECK(\x20interval_seconds\x20>=\x205\x20AND\x20interval_seconds\x20<=\x20100\x20)\x20DEFAULT\x205,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20batch_size\x20INTEGER\x20DEFAULT\x205,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_active\x20BOOLEAN\x20DEFAULT\x201,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20TEXT\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20TEXT\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(bank_id)\x20REFERENCES\x20','updated_at','6hCNNlI','\x20(SensorBank:\x20','token','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20description\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20object_id\x20TEXT\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20property_name\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data_type\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_active\x20BOOLEAN,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20room_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20subsite_id\x20INTEGER\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20','data','✅\x20Created\x20sub-site\x20sensor\x20data\x20table:\x20','description','❌\x20Insert\x20failed\x20[Sensor\x20','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20sensor_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20api_endpoint\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(sensor_id)\x20REFERENCES\x20','❌\x20JWT\x20verification\x20failed:','253sQgovD','JxLaV','axios','api_endpoint',',\x20APIs:\x20','8444124rAiHhO','\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','object_id','env','created_at','(id)\x20ON\x20DELETE\x20CASCADE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','bank_id','❌\x20No\x20valid\x20token\x20found\x20in\x20AuthTokens','634woNBfh','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20sensor_id\x20INTEGER\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_fetching\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_sending\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(sensor_id)\x20REFERENCES\x20','SensorAPI_','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20sensor_id\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20quality\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20quality_good\x20BOOLEAN,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20timestamp\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20sent_to_cloud\x20BOOLEAN\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(sensor_id)\x20REFERENCES\x20','log','/api/subsite/cloud/sync/subsite-db','IntervalControl_','❌\x20Insert\x20failed\x20[SensorBank\x20','dotenv','3424666BGndmf','SensorLogs_','error','config','25710KkapCI'];a0_0x45ec=function(){return _0x3b8853;};return a0_0x45ec();}