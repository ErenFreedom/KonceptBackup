const a0_0x3f73fe=a0_0x150e;(function(_0x301d77,_0x75023d){const _0x539bff=a0_0x150e,_0x40f08a=_0x301d77();while(!![]){try{const _0x38f2ee=parseInt(_0x539bff(0xd6))/0x1*(parseInt(_0x539bff(0xde))/0x2)+parseInt(_0x539bff(0xd5))/0x3*(-parseInt(_0x539bff(0xdc))/0x4)+-parseInt(_0x539bff(0x111))/0x5+-parseInt(_0x539bff(0x104))/0x6+-parseInt(_0x539bff(0xeb))/0x7*(parseInt(_0x539bff(0xe7))/0x8)+parseInt(_0x539bff(0x114))/0x9*(parseInt(_0x539bff(0xe2))/0xa)+parseInt(_0x539bff(0x115))/0xb;if(_0x38f2ee===_0x75023d)break;else _0x40f08a['push'](_0x40f08a['shift']());}catch(_0x12a9ef){_0x40f08a['push'](_0x40f08a['shift']());}}}(a0_0x47c3,0xde5a0));const axios=require(a0_0x3f73fe(0xd9)),jwt=require(a0_0x3f73fe(0xef)),{db}=require(a0_0x3f73fe(0xf7));require(a0_0x3f73fe(0xfb))[a0_0x3f73fe(0xf5)]();function a0_0x150e(_0x26afba,_0x231d9f){const _0x47c344=a0_0x47c3();return a0_0x150e=function(_0x150ec8,_0x15de41){_0x150ec8=_0x150ec8-0xd5;let _0x32be1d=_0x47c344[_0x150ec8];return _0x32be1d;},a0_0x150e(_0x26afba,_0x231d9f);}const CLOUD_API_URL=process['env'][a0_0x3f73fe(0xe0)],syncAllSubSites=async()=>{const _0x2d0f9c=a0_0x3f73fe,_0x91be67={'EuWkl':function(_0x7c7b34,_0x1a5efd){return _0x7c7b34||_0x1a5efd;},'AUiNd':_0x2d0f9c(0xe1)};try{db[_0x2d0f9c(0x102)]('SELECT\x20token\x20FROM\x20AuthTokens\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x201',async(_0x43b619,_0x377fae)=>{const _0x436f89=_0x2d0f9c;if(_0x91be67['EuWkl'](_0x43b619,!_0x377fae)){console[_0x436f89(0x10f)](_0x436f89(0xf1));return;}const _0x2410ac=_0x377fae[_0x436f89(0x113)];let _0x49bc4e;try{_0x49bc4e=jwt[_0x436f89(0xfc)](_0x2410ac,process['env'][_0x436f89(0xfd)]);}catch(_0x553116){console[_0x436f89(0x10f)](_0x91be67[_0x436f89(0xea)],_0x553116[_0x436f89(0xf9)]);return;}const _0x389e5f=_0x49bc4e[_0x436f89(0x10b)]||_0x49bc4e[_0x436f89(0xe5)],_0x34fa94=await axios[_0x436f89(0x102)](CLOUD_API_URL+_0x436f89(0x106),{'headers':{'Authorization':_0x436f89(0xee)+_0x2410ac}});for(const _0x5c7d55 of _0x34fa94[_0x436f89(0x110)][_0x436f89(0x103)]){const {subsiteId:_0x1386c9,sensorBank:_0x3ac3cf,activeSensors:_0x473fe6,sensorApis:_0x170959,sensorDataBankIds:_0x21d641}=_0x5c7d55,_0xd4eec8='SensorBank_'+_0x389e5f+'_'+_0x1386c9,_0x46806d=_0x436f89(0xd7)+_0x389e5f+'_'+_0x1386c9,_0x5e46a7=_0x436f89(0xed)+_0x389e5f+'_'+_0x1386c9;db[_0x436f89(0x10a)](()=>{const _0x15d872=_0x436f89;db[_0x15d872(0x105)](_0x15d872(0x101)+_0xd4eec8+_0x15d872(0xe8)),db[_0x15d872(0x105)](_0x15d872(0x101)+_0x46806d+'\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20bank_id\x20INTEGER\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20mode\x20TEXT\x20CHECK(\x20mode\x20IN\x20(\x27real_time\x27,\x20\x27manual\x27)\x20)\x20DEFAULT\x20\x27manual\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20interval_seconds\x20INTEGER\x20CHECK(\x20interval_seconds\x20>=\x205\x20AND\x20interval_seconds\x20<=\x20100\x20)\x20DEFAULT\x205,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20batch_size\x20INTEGER\x20DEFAULT\x205,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_active\x20BOOLEAN\x20DEFAULT\x201,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20TEXT\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20TEXT\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(bank_id)\x20REFERENCES\x20'+_0xd4eec8+_0x15d872(0x107)),db['run'](_0x15d872(0x101)+_0x5e46a7+_0x15d872(0xe4)+_0xd4eec8+'(id)\x20ON\x20DELETE\x20CASCADE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);');for(const _0x140a35 of _0x3ac3cf){db[_0x15d872(0x105)](_0x15d872(0x109)+_0xd4eec8+_0x15d872(0x10d),[_0x140a35['id'],_0x140a35[_0x15d872(0xf8)],_0x140a35[_0x15d872(0xfa)],_0x140a35[_0x15d872(0xe3)],_0x140a35[_0x15d872(0xf6)],_0x140a35[_0x15d872(0xda)],_0x140a35[_0x15d872(0xf0)],_0x140a35[_0x15d872(0x108)],_0x140a35['created_at'],_0x140a35[_0x15d872(0xec)],_0x1386c9],_0x53fc6e=>{const _0x2208aa=_0x15d872;if(_0x53fc6e)console[_0x2208aa(0x10f)](_0x2208aa(0xff)+_0x1386c9+']:',_0x53fc6e[_0x2208aa(0xf9)]);});}for(const _0x2815ed of _0x473fe6){db['run'](_0x15d872(0x109)+_0x46806d+_0x15d872(0xdb),[_0x2815ed['id'],_0x2815ed['bank_id'],_0x2815ed[_0x15d872(0xf0)],_0x2815ed[_0x15d872(0xdf)],_0x2815ed[_0x15d872(0xec)]],_0x17bdbe=>{const _0x3a4dfb=_0x15d872;if(_0x17bdbe)console['error'](_0x3a4dfb(0x112)+_0x1386c9+']:',_0x17bdbe[_0x3a4dfb(0xf9)]);});}for(const _0x3aceda of _0x170959){db[_0x15d872(0x105)](_0x15d872(0x109)+_0x5e46a7+_0x15d872(0xf3),[_0x3aceda['id'],_0x3aceda[_0x15d872(0xf4)],_0x3aceda['api_endpoint'],_0x3aceda[_0x15d872(0xdf)]],_0x237d73=>{const _0x145b05=_0x15d872;if(_0x237d73)console[_0x145b05(0x10f)](_0x145b05(0xe6)+_0x1386c9+']:',_0x237d73[_0x145b05(0xf9)]);});}});for(const _0x4a1c45 of _0x21d641){const _0x543e14=_0x436f89(0x10e)+_0x389e5f+'_'+_0x1386c9+'_'+_0x4a1c45;db['run'](_0x436f89(0x101)+_0x543e14+'\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20sensor_id\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20quality\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20quality_good\x20BOOLEAN,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20timestamp\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(sensor_id)\x20REFERENCES\x20'+_0x46806d+_0x436f89(0xf2),_0x552f26=>{const _0x48509b=_0x436f89;if(_0x552f26)console[_0x48509b(0x10f)](_0x48509b(0xfe)+_0x543e14+':',_0x552f26[_0x48509b(0xf9)]);});}console['log'](_0x436f89(0x100)+_0x1386c9+_0x436f89(0x10c)+_0x3ac3cf[_0x436f89(0xdd)]+',\x20ActiveSensors:\x20'+_0x473fe6[_0x436f89(0xdd)]+_0x436f89(0xe9)+_0x170959[_0x436f89(0xdd)]+')');}});}catch(_0x25c783){console['error'](_0x2d0f9c(0xd8),_0x25c783[_0x2d0f9c(0xf9)]);}};module['exports']={'syncAllSubSites':syncAllSubSites};function a0_0x47c3(){const _0x4bb1de=['message','description','dotenv','verify','JWT_SECRET_APP','❌\x20Failed\x20to\x20create\x20table\x20','❌\x20Insert\x20failed\x20[SensorBank\x20','✅\x20Synced\x20sub-site\x20','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20','get','result','5405676YicAjI','run','/api/subsite/cloud/sync/subsite-db','(id)\x20ON\x20DELETE\x20CASCADE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);','room_id','INSERT\x20OR\x20IGNORE\x20INTO\x20','serialize','companyId','\x20(SensorBank:\x20','\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','SensorData_','error','data','8870785IMJVWS','❌\x20Insert\x20failed\x20[Sensor\x20','token','27801ZgnFOF','39339608lCXqBY','3MIlXKk','37816NrNVyO','Sensor_','❌\x20Sub-site\x20sync\x20failed:','axios','data_type','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(id,\x20bank_id,\x20is_active,\x20created_at,\x20updated_at)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','3256212hrHxkm','length','22qTAqAd','created_at','CLOUD_API_URL','❌\x20JWT\x20verification\x20failed:','4620PhVErR','object_id','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20sensor_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20api_endpoint\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(sensor_id)\x20REFERENCES\x20','company_id','❌\x20Insert\x20failed\x20[SensorAPI\x20','2718704CXBSdX','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20description\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20object_id\x20TEXT\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20property_name\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data_type\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_active\x20BOOLEAN,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20room_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20subsite_id\x20INTEGER\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);',',\x20APIs:\x20','AUiNd','21bUZYdF','updated_at','SensorAPI_','Bearer\x20','jsonwebtoken','is_active','❌\x20No\x20valid\x20token\x20found\x20in\x20AuthTokens','(bank_id)\x20ON\x20DELETE\x20CASCADE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);','\x20VALUES\x20(?,\x20?,\x20?,\x20?)','sensor_id','config','property_name','../db/sensorDB','name'];a0_0x47c3=function(){return _0x4bb1de;};return a0_0x47c3();}