const a0_0x59dcbd=a0_0xcea4;function a0_0x3eed(){const _0x1aa0a6=['404733HWfUHW','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20sensor_id\x20INTEGER\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_fetching\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_sending\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(sensor_id)\x20REFERENCES\x20','Sensor_','3124200dBgOUW','CLOUD_API_URL','64cfqRZa','length','3RCgEsp','bank_id','✅\x20Synced\x20sub-site\x20','3900186ObhdPB','1672674qXAjpe','pGrxc','log','❌\x20No\x20valid\x20token\x20found\x20in\x20AuthTokens','SensorAPI_','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20sensor_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20log\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20timestamp\x20DATETIME\x20DEFAULT\x20CURRENT_TIMESTAMP\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20sensor_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20api_endpoint\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(sensor_id)\x20REFERENCES\x20','(id)\x20ON\x20DELETE\x20CASCADE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);','❌\x20Insert\x20failed\x20[SensorBank\x20','❌\x20Failed\x20to\x20create\x20','IVysj','message','INSERT\x20OR\x20IGNORE\x20INTO\x20','❌\x20JWT\x20verification\x20failed:','../db/sensorDB','result',',\x20APIs:\x20','run','api_endpoint','object_id','JWT_SECRET_APP','❌\x20Insert\x20failed\x20[SensorAPI\x20','exports','❌\x20Insert\x20failed\x20[Sensor\x20','get','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20sensor_id\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20quality\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20quality_good\x20BOOLEAN,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20timestamp\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(sensor_id)\x20REFERENCES\x20','property_name','SensorBank_','\x20(SensorBank:\x20','sensor_id','env','9708570DDElst','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(id,\x20bank_id,\x20is_active,\x20created_at,\x20updated_at)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','config','error','723775saSHUZ','SELECT\x20token\x20FROM\x20AuthTokens\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x201','1701932ccSSrw','5rWmSge','serialize','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20','data_type','created_at','is_active','SensorLogs_','(bank_id)\x20ON\x20DELETE\x20CASCADE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);',',\x20ActiveSensors:\x20','data','\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)'];a0_0x3eed=function(){return _0x1aa0a6;};return a0_0x3eed();}function a0_0xcea4(_0x53df06,_0xc9ba6){const _0x3eed9e=a0_0x3eed();return a0_0xcea4=function(_0xcea434,_0x33ad16){_0xcea434=_0xcea434-0xc5;let _0x3578b9=_0x3eed9e[_0xcea434];return _0x3578b9;},a0_0xcea4(_0x53df06,_0xc9ba6);}(function(_0x217aa6,_0x33c8cb){const _0x5a421b=a0_0xcea4,_0x355083=_0x217aa6();while(!![]){try{const _0x452226=parseInt(_0x5a421b(0xe6))/0x1+-parseInt(_0x5a421b(0xff))/0x2*(-parseInt(_0x5a421b(0xfb))/0x3)+parseInt(_0x5a421b(0xe8))/0x4+-parseInt(_0x5a421b(0xe9))/0x5*(parseInt(_0x5a421b(0xf7))/0x6)+-parseInt(_0x5a421b(0xf4))/0x7*(-parseInt(_0x5a421b(0xf9))/0x8)+-parseInt(_0x5a421b(0xfe))/0x9+-parseInt(_0x5a421b(0xe2))/0xa;if(_0x452226===_0x33c8cb)break;else _0x355083['push'](_0x355083['shift']());}catch(_0x3582f4){_0x355083['push'](_0x355083['shift']());}}}(a0_0x3eed,0x7fbe4));const axios=require('axios'),jwt=require('jsonwebtoken'),{db}=require(a0_0x59dcbd(0xd1));require('dotenv')[a0_0x59dcbd(0xe4)]();const CLOUD_API_URL=process[a0_0x59dcbd(0xe1)][a0_0x59dcbd(0xf8)],syncAllSubSites=async()=>{const _0x2cb468=a0_0x59dcbd,_0xfca7ec={'pGrxc':function(_0x18a5f7,_0x4b2748){return _0x18a5f7||_0x4b2748;},'IVysj':_0x2cb468(0xc6),'HXwiD':_0x2cb468(0xd0)};try{db['get'](_0x2cb468(0xe7),async(_0x28dae2,_0x5ef209)=>{const _0xd766f2=_0x2cb468;if(_0xfca7ec[_0xd766f2(0x100)](_0x28dae2,!_0x5ef209)){console[_0xd766f2(0xe5)](_0xfca7ec[_0xd766f2(0xcd)]);return;}const _0x4e6a70=_0x5ef209['token'];let _0x33a51d;try{_0x33a51d=jwt['verify'](_0x4e6a70,process[_0xd766f2(0xe1)][_0xd766f2(0xd7)]);}catch(_0x2a456b){console['error'](_0xfca7ec['HXwiD'],_0x2a456b[_0xd766f2(0xce)]);return;}const _0x70d293=_0x33a51d['companyId']||_0x33a51d['company_id'],_0x17cbb0=await axios[_0xd766f2(0xdb)](CLOUD_API_URL+'/api/subsite/cloud/sync/subsite-db',{'headers':{'Authorization':'Bearer\x20'+_0x4e6a70}});for(const _0x53262e of _0x17cbb0[_0xd766f2(0xf2)][_0xd766f2(0xd2)]){const {subsiteId:_0x620c9f,sensorBank:_0x433aad,activeSensors:_0x22692a,sensorApis:_0x539e2d,sensorDataBankIds:_0x3a09fb}=_0x53262e,_0xea6210=_0xd766f2(0xde)+_0x70d293+'_'+_0x620c9f,_0x213a79=_0xd766f2(0xf6)+_0x70d293+'_'+_0x620c9f,_0xa20a90=_0xd766f2(0xc7)+_0x70d293+'_'+_0x620c9f;db[_0xd766f2(0xea)](()=>{const _0x4be95b=_0xd766f2;db['run']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20'+_0xea6210+'\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20description\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20object_id\x20TEXT\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20property_name\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data_type\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_active\x20BOOLEAN,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20room_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20subsite_id\x20INTEGER\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);'),db[_0x4be95b(0xd4)]('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20'+_0x213a79+'\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20bank_id\x20INTEGER\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20mode\x20TEXT\x20CHECK(\x20mode\x20IN\x20(\x27real_time\x27,\x20\x27manual\x27)\x20)\x20DEFAULT\x20\x27manual\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20interval_seconds\x20INTEGER\x20CHECK(\x20interval_seconds\x20>=\x205\x20AND\x20interval_seconds\x20<=\x20100\x20)\x20DEFAULT\x205,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20batch_size\x20INTEGER\x20DEFAULT\x205,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_active\x20BOOLEAN\x20DEFAULT\x201,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20TEXT\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20TEXT\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(bank_id)\x20REFERENCES\x20'+_0xea6210+_0x4be95b(0xca)),db[_0x4be95b(0xd4)]('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20'+_0xa20a90+_0x4be95b(0xc9)+_0xea6210+_0x4be95b(0xca));const _0x2696be='IntervalControl_'+_0x70d293+'_'+_0x620c9f;db[_0x4be95b(0xd4)](_0x4be95b(0xeb)+_0x2696be+_0x4be95b(0xf5)+_0x213a79+'(id)\x20ON\x20DELETE\x20CASCADE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x49010c=>{const _0x434f12=_0x4be95b;if(_0x49010c)console[_0x434f12(0xe5)](_0x434f12(0xcc)+_0x2696be+':',_0x49010c[_0x434f12(0xce)]);});const _0x1bb83a=_0x4be95b(0xef)+_0x70d293+'_'+_0x620c9f;db[_0x4be95b(0xd4)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20'+_0x1bb83a+_0x4be95b(0xc8),_0x54f208=>{const _0x5069dd=_0x4be95b;if(_0x54f208)console['error']('❌\x20Failed\x20to\x20create\x20log\x20table\x20'+_0x1bb83a+':',_0x54f208[_0x5069dd(0xce)]);});for(const _0x181f21 of _0x433aad){db[_0x4be95b(0xd4)]('INSERT\x20OR\x20IGNORE\x20INTO\x20'+_0xea6210+_0x4be95b(0xf3),[_0x181f21['id'],_0x181f21['name'],_0x181f21['description'],_0x181f21[_0x4be95b(0xd6)],_0x181f21[_0x4be95b(0xdd)],_0x181f21[_0x4be95b(0xec)],_0x181f21[_0x4be95b(0xee)],_0x181f21['room_id'],_0x181f21['created_at'],_0x181f21['updated_at'],_0x620c9f],_0xea24fe=>{const _0x358bb0=_0x4be95b;if(_0xea24fe)console[_0x358bb0(0xe5)](_0x358bb0(0xcb)+_0x620c9f+']:',_0xea24fe[_0x358bb0(0xce)]);});}for(const _0x39310f of _0x22692a){db[_0x4be95b(0xd4)]('INSERT\x20OR\x20IGNORE\x20INTO\x20'+_0x213a79+_0x4be95b(0xe3),[_0x39310f['id'],_0x39310f[_0x4be95b(0xfc)],_0x39310f[_0x4be95b(0xee)],_0x39310f[_0x4be95b(0xed)],_0x39310f['updated_at']],_0x5d2ea7=>{const _0x1de209=_0x4be95b;if(_0x5d2ea7)console[_0x1de209(0xe5)](_0x1de209(0xda)+_0x620c9f+']:',_0x5d2ea7[_0x1de209(0xce)]);});}for(const _0x3cd555 of _0x539e2d){db['run'](_0x4be95b(0xcf)+_0xa20a90+'\x20VALUES\x20(?,\x20?,\x20?,\x20?)',[_0x3cd555['id'],_0x3cd555[_0x4be95b(0xe0)],_0x3cd555[_0x4be95b(0xd5)],_0x3cd555[_0x4be95b(0xed)]],_0x3440f0=>{const _0x5a8488=_0x4be95b;if(_0x3440f0)console[_0x5a8488(0xe5)](_0x5a8488(0xd8)+_0x620c9f+']:',_0x3440f0[_0x5a8488(0xce)]);});}});for(const _0x301407 of _0x3a09fb){const _0x16881e='SensorData_'+_0x70d293+'_'+_0x620c9f+'_'+_0x301407;db[_0xd766f2(0xd4)]('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20'+_0x16881e+_0xd766f2(0xdc)+_0x213a79+_0xd766f2(0xf0),_0x4e098b=>{const _0x35849b=_0xd766f2;if(_0x4e098b)console['error']('❌\x20Failed\x20to\x20create\x20table\x20'+_0x16881e+':',_0x4e098b[_0x35849b(0xce)]);});}console[_0xd766f2(0xc5)](_0xd766f2(0xfd)+_0x620c9f+_0xd766f2(0xdf)+_0x433aad[_0xd766f2(0xfa)]+_0xd766f2(0xf1)+_0x22692a[_0xd766f2(0xfa)]+_0xd766f2(0xd3)+_0x539e2d[_0xd766f2(0xfa)]+')');}});}catch(_0x3d8beb){console['error']('❌\x20Sub-site\x20sync\x20failed:',_0x3d8beb[_0x2cb468(0xce)]);}};module[a0_0x59dcbd(0xd9)]={'syncAllSubSites':syncAllSubSites};