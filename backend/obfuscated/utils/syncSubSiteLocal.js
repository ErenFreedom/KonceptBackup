const a0_0x15e237=a0_0x34d5;(function(_0x4bb70d,_0x342908){const _0x3608e9=a0_0x34d5,_0x3ee212=_0x4bb70d();while(!![]){try{const _0x41903c=-parseInt(_0x3608e9(0xc9))/0x1+-parseInt(_0x3608e9(0xa6))/0x2*(parseInt(_0x3608e9(0xc5))/0x3)+-parseInt(_0x3608e9(0x9e))/0x4*(-parseInt(_0x3608e9(0xad))/0x5)+parseInt(_0x3608e9(0xa1))/0x6+-parseInt(_0x3608e9(0x94))/0x7+-parseInt(_0x3608e9(0x9d))/0x8*(-parseInt(_0x3608e9(0x9c))/0x9)+parseInt(_0x3608e9(0xc8))/0xa;if(_0x41903c===_0x342908)break;else _0x3ee212['push'](_0x3ee212['shift']());}catch(_0x117b99){_0x3ee212['push'](_0x3ee212['shift']());}}}(a0_0x459c,0xc72db));function a0_0x34d5(_0xbe7d9a,_0x2d82ee){const _0x459c54=a0_0x459c();return a0_0x34d5=function(_0x34d50d,_0x1e495c){_0x34d50d=_0x34d50d-0x94;let _0x201760=_0x459c54[_0x34d50d];return _0x201760;},a0_0x34d5(_0xbe7d9a,_0x2d82ee);}const axios=require(a0_0x15e237(0xa0)),jwt=require(a0_0x15e237(0xa7)),{db}=require(a0_0x15e237(0xd1));require('dotenv')[a0_0x15e237(0x96)]();function a0_0x459c(){const _0x4d6867=['6445755CRjrZE','8OAxOsb','12836FIrCDr','api_endpoint','axios','5772624AYdXsN','SensorBank_','\x20(SensorBank:\x20','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20bank_id\x20INTEGER\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20mode\x20TEXT\x20CHECK(\x20mode\x20IN\x20(\x27real_time\x27,\x20\x27manual\x27)\x20)\x20DEFAULT\x20\x27manual\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20interval_seconds\x20INTEGER\x20CHECK(\x20interval_seconds\x20>=\x205\x20AND\x20interval_seconds\x20<=\x20100\x20)\x20DEFAULT\x205,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20batch_size\x20INTEGER\x20DEFAULT\x205,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_active\x20BOOLEAN\x20DEFAULT\x201,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20TEXT\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20TEXT\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(bank_id)\x20REFERENCES\x20',',\x20APIs:\x20','2971438ZDuGcf','jsonwebtoken','room_id','(id)\x20ON\x20DELETE\x20CASCADE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','❌\x20Failed\x20to\x20create\x20table\x20','❌\x20Insert\x20failed\x20[SensorAPI\x20','length','835layJki','INSERT\x20OR\x20IGNORE\x20INTO\x20','\x20VALUES\x20(?,\x20?,\x20?,\x20?)','is_active','tnFyW','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(id,\x20bank_id,\x20is_active,\x20created_at,\x20updated_at)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20sensor_id\x20INTEGER\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_fetching\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_sending\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(sensor_id)\x20REFERENCES\x20','message','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20sensor_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20api_endpoint\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(sensor_id)\x20REFERENCES\x20','❌\x20Failed\x20to\x20create\x20','token','❌\x20Insert\x20failed\x20[SensorBank\x20','result','❌\x20Insert\x20failed\x20[Sensor\x20','log','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20','get','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20','✅\x20Synced\x20sub-site\x20','serialize','run','companyId',',\x20ActiveSensors:\x20','created_at','3XgQzda','(id)\x20ON\x20DELETE\x20CASCADE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);','updated_at','20560290JOdyrR','791173OKyFad','data_type','description','exports','/api/subsite/cloud/sync/subsite-db','(bank_id)\x20ON\x20DELETE\x20CASCADE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);','data','error','../db/sensorDB','SFfmi','8242528NtgffC','company_id','config','object_id','❌\x20Sub-site\x20sync\x20failed:','Sensor_','property_name','❌\x20JWT\x20verification\x20failed:'];a0_0x459c=function(){return _0x4d6867;};return a0_0x459c();}const CLOUD_API_URL=process['env']['CLOUD_API_URL'],syncAllSubSites=async()=>{const _0x4383fe=a0_0x15e237,_0xdd71be={'tnFyW':function(_0x13a3fc,_0xba1d37){return _0x13a3fc||_0xba1d37;},'bUboA':'❌\x20No\x20valid\x20token\x20found\x20in\x20AuthTokens','SFfmi':_0x4383fe(0x9b)};try{db[_0x4383fe(0xbd)]('SELECT\x20token\x20FROM\x20AuthTokens\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x201',async(_0xb0b45b,_0x511f7b)=>{const _0x45217d=_0x4383fe;if(_0xdd71be[_0x45217d(0xb1)](_0xb0b45b,!_0x511f7b)){console[_0x45217d(0xd0)](_0xdd71be['bUboA']);return;}const _0x8c43ea=_0x511f7b[_0x45217d(0xb7)];let _0x28118;try{_0x28118=jwt['verify'](_0x8c43ea,process['env']['JWT_SECRET_APP']);}catch(_0x26353c){console[_0x45217d(0xd0)](_0xdd71be[_0x45217d(0xd2)],_0x26353c['message']);return;}const _0x525557=_0x28118[_0x45217d(0xc2)]||_0x28118[_0x45217d(0x95)],_0x5a7442=await axios[_0x45217d(0xbd)](CLOUD_API_URL+_0x45217d(0xcd),{'headers':{'Authorization':'Bearer\x20'+_0x8c43ea}});for(const _0x18004d of _0x5a7442[_0x45217d(0xcf)][_0x45217d(0xb9)]){const {subsiteId:_0x356209,sensorBank:_0x585324,activeSensors:_0x4ede94,sensorApis:_0x212a72,sensorDataBankIds:_0x2b7e09}=_0x18004d,_0x496402=_0x45217d(0xa2)+_0x525557+'_'+_0x356209,_0x190267=_0x45217d(0x99)+_0x525557+'_'+_0x356209,_0x68de3f='SensorAPI_'+_0x525557+'_'+_0x356209;db[_0x45217d(0xc0)](()=>{const _0x212cd2=_0x45217d;db['run'](_0x212cd2(0xbc)+_0x496402+'\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20description\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20object_id\x20TEXT\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20property_name\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data_type\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_active\x20BOOLEAN,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20room_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20subsite_id\x20INTEGER\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);'),db[_0x212cd2(0xc1)](_0x212cd2(0xbc)+_0x190267+_0x212cd2(0xa4)+_0x496402+_0x212cd2(0xc6)),db[_0x212cd2(0xc1)]('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20'+_0x68de3f+_0x212cd2(0xb5)+_0x496402+_0x212cd2(0xc6));const _0x270399='IntervalControl_'+_0x525557+'_'+_0x356209;db[_0x212cd2(0xc1)](_0x212cd2(0xbe)+_0x270399+_0x212cd2(0xb3)+_0x190267+_0x212cd2(0xa9),_0x3cf2f4=>{const _0x8eb0e7=_0x212cd2;if(_0x3cf2f4)console[_0x8eb0e7(0xd0)](_0x8eb0e7(0xb6)+_0x270399+':',_0x3cf2f4['message']);});for(const _0x97b9b6 of _0x585324){db[_0x212cd2(0xc1)](_0x212cd2(0xae)+_0x496402+'\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)',[_0x97b9b6['id'],_0x97b9b6['name'],_0x97b9b6[_0x212cd2(0xcb)],_0x97b9b6[_0x212cd2(0x97)],_0x97b9b6[_0x212cd2(0x9a)],_0x97b9b6[_0x212cd2(0xca)],_0x97b9b6[_0x212cd2(0xb0)],_0x97b9b6[_0x212cd2(0xa8)],_0x97b9b6[_0x212cd2(0xc4)],_0x97b9b6[_0x212cd2(0xc7)],_0x356209],_0x256c47=>{const _0x59e82c=_0x212cd2;if(_0x256c47)console[_0x59e82c(0xd0)](_0x59e82c(0xb8)+_0x356209+']:',_0x256c47[_0x59e82c(0xb4)]);});}for(const _0x38b306 of _0x4ede94){db[_0x212cd2(0xc1)](_0x212cd2(0xae)+_0x190267+_0x212cd2(0xb2),[_0x38b306['id'],_0x38b306['bank_id'],_0x38b306[_0x212cd2(0xb0)],_0x38b306[_0x212cd2(0xc4)],_0x38b306[_0x212cd2(0xc7)]],_0x5a9d5f=>{const _0x333a81=_0x212cd2;if(_0x5a9d5f)console[_0x333a81(0xd0)](_0x333a81(0xba)+_0x356209+']:',_0x5a9d5f[_0x333a81(0xb4)]);});}for(const _0x270c56 of _0x212a72){db[_0x212cd2(0xc1)](_0x212cd2(0xae)+_0x68de3f+_0x212cd2(0xaf),[_0x270c56['id'],_0x270c56['sensor_id'],_0x270c56[_0x212cd2(0x9f)],_0x270c56['created_at']],_0x4e8151=>{const _0x3132a6=_0x212cd2;if(_0x4e8151)console[_0x3132a6(0xd0)](_0x3132a6(0xab)+_0x356209+']:',_0x4e8151[_0x3132a6(0xb4)]);});}});for(const _0x5df17e of _0x2b7e09){const _0x47a8d2='SensorData_'+_0x525557+'_'+_0x356209+'_'+_0x5df17e;db['run']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20'+_0x47a8d2+'\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20sensor_id\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20quality\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20quality_good\x20BOOLEAN,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20timestamp\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(sensor_id)\x20REFERENCES\x20'+_0x190267+_0x45217d(0xce),_0x44cc69=>{const _0x5df14f=_0x45217d;if(_0x44cc69)console[_0x5df14f(0xd0)](_0x5df14f(0xaa)+_0x47a8d2+':',_0x44cc69[_0x5df14f(0xb4)]);});}console[_0x45217d(0xbb)](_0x45217d(0xbf)+_0x356209+_0x45217d(0xa3)+_0x585324[_0x45217d(0xac)]+_0x45217d(0xc3)+_0x4ede94[_0x45217d(0xac)]+_0x45217d(0xa5)+_0x212a72[_0x45217d(0xac)]+')');}});}catch(_0x8fac53){console[_0x4383fe(0xd0)](_0x4383fe(0x98),_0x8fac53['message']);}};module[a0_0x15e237(0xcc)]={'syncAllSubSites':syncAllSubSites};