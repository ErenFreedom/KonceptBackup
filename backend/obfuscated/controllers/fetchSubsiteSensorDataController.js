const a0_0x56a4ab=a0_0x17b4;(function(_0x33bfd6,_0x448f46){const _0x40d33e=a0_0x17b4,_0x49d8b0=_0x33bfd6();while(!![]){try{const _0x5b0364=-parseInt(_0x40d33e(0x1bd))/0x1+-parseInt(_0x40d33e(0x1c0))/0x2*(-parseInt(_0x40d33e(0x1a3))/0x3)+-parseInt(_0x40d33e(0x186))/0x4+parseInt(_0x40d33e(0x1cd))/0x5+-parseInt(_0x40d33e(0x182))/0x6+parseInt(_0x40d33e(0x1d4))/0x7*(-parseInt(_0x40d33e(0x194))/0x8)+parseInt(_0x40d33e(0x1be))/0x9;if(_0x5b0364===_0x448f46)break;else _0x49d8b0['push'](_0x49d8b0['shift']());}catch(_0x18c602){_0x49d8b0['push'](_0x49d8b0['shift']());}}}(a0_0x4925,0x5c78a));const axios=require(a0_0x56a4ab(0x1b9)),jwt=require('jsonwebtoken'),https=require(a0_0x56a4ab(0x19b)),{db}=require(a0_0x56a4ab(0x1d3)),{insertLog}=require(a0_0x56a4ab(0x17d)),intervalManager=require(a0_0x56a4ab(0x1cf)),agent=new https['Agent']({'rejectUnauthorized':![]}),getStoredToken=()=>{const _0xd6f2d9={'aWoMy':function(_0x51ebdd,_0xd7eec8){return _0x51ebdd||_0xd7eec8;},'zRIZq':function(_0x356043,_0x10f9a0){return _0x356043(_0x10f9a0);},'FsiSS':'No\x20stored\x20token\x20found.','cPRBr':'SELECT\x20token\x20FROM\x20AuthTokens\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x201'};return new Promise((_0x22f2d9,_0x17597e)=>{const _0x578460=a0_0x17b4;db[_0x578460(0x18d)](_0xd6f2d9['cPRBr'],[],(_0x28ec31,_0x9b3d6b)=>{const _0x23da8d=_0x578460;if(_0xd6f2d9[_0x23da8d(0x1ca)](_0x28ec31,!_0x9b3d6b))_0xd6f2d9[_0x23da8d(0x19a)](_0x17597e,_0xd6f2d9[_0x23da8d(0x190)]);else _0x22f2d9(_0x9b3d6b[_0x23da8d(0x1c1)]);});});},getCompanyIdFromToken=async()=>{const _0x3447b9=a0_0x56a4ab,_0x504860={'pFEqx':function(_0x7526f1){return _0x7526f1();}},_0x33ac45=await _0x504860['pFEqx'](getStoredToken),_0x5642d5=jwt[_0x3447b9(0x18b)](_0x33ac45,process[_0x3447b9(0x1cb)][_0x3447b9(0x1c3)]);return _0x5642d5[_0x3447b9(0x1a6)];},fetchAndStoreSubSiteSensorData=async(_0x388a3c,_0x433238,_0x26584d,_0xa1d912)=>{const _0x394c72=a0_0x56a4ab,_0x6dc486={'xLoZr':function(_0x3300a0,_0x37ad87,_0x2df604){return _0x3300a0(_0x37ad87,_0x2df604);},'LONbZ':function(_0x846e84,_0x377f0c,_0x143644){return _0x846e84(_0x377f0c,_0x143644);}};try{const {sensor_id:_0x27fa73,api_endpoint:_0x53a369}=_0x388a3c,_0x181478=await axios['get'](_0x53a369,{'headers':{'Authorization':_0x394c72(0x196)+_0xa1d912},'httpsAgent':agent}),_0x4b266f=_0x181478[_0x394c72(0x1d1)]?.[0x0]?.['Value'];if(!_0x4b266f){_0x6dc486['LONbZ'](insertLog,_0x27fa73,'⚠️\x20No\x20data\x20returned\x20from\x20Desigo\x20endpoint\x20(sub-site\x20'+_0x26584d+')');return;}const {Value:_0x1c9f78,Quality:_0x49782b,QualityGood:_0x30397b,Timestamp:_0x5dedf1}=_0x4b266f,_0x36d6e5=_0x394c72(0x1b6)+_0x433238+'_'+_0x26584d+'_'+_0x27fa73,_0x208895='Sensor_'+_0x433238+'_'+_0x26584d;db[_0x394c72(0x18d)](_0x394c72(0x189)+_0x208895+'\x20WHERE\x20bank_id\x20=\x20?',[_0x27fa73],(_0x4ed59b,_0x159bda)=>{const _0x5acf4c=_0x394c72,_0x1a3f44={'CFZQO':function(_0x4f8900,_0x555909,_0x5675e2){const _0x2a298e=a0_0x17b4;return _0x6dc486[_0x2a298e(0x193)](_0x4f8900,_0x555909,_0x5675e2);},'Fepjs':function(_0x2d3aba,_0x5e54d6,_0x454c68){return _0x6dc486['xLoZr'](_0x2d3aba,_0x5e54d6,_0x454c68);}};if(_0x4ed59b||!_0x159bda){console[_0x5acf4c(0x1c2)](_0x5acf4c(0x17e)+_0x27fa73+_0x5acf4c(0x1c9)+_0x26584d),insertLog(_0x27fa73,'❌\x20No\x20matching\x20sensor_id\x20in\x20'+_0x208895);return;}const _0x5e6576=_0x159bda['id'];db['run'](_0x5acf4c(0x1ac)+_0x36d6e5+_0x5acf4c(0x1af),[_0x5e6576,_0x1c9f78,_0x49782b,_0x30397b,_0x5dedf1],_0x4cb560=>{const _0x572944=_0x5acf4c;_0x4cb560?(console['error'](_0x572944(0x1b4)+_0x36d6e5+':',_0x4cb560['message']),_0x1a3f44[_0x572944(0x1a5)](insertLog,_0x27fa73,_0x572944(0x1d6)+_0x4cb560[_0x572944(0x19c)])):_0x1a3f44[_0x572944(0x183)](insertLog,_0x27fa73,_0x572944(0x1c5)+_0x36d6e5);});});}catch(_0x25b6fe){console[_0x394c72(0x1c2)](_0x394c72(0x17c)+_0x26584d+_0x394c72(0x18c)+_0x388a3c['sensor_id']+':',_0x25b6fe[_0x394c72(0x19c)]),_0x6dc486['xLoZr'](insertLog,_0x388a3c[_0x394c72(0x18f)],_0x394c72(0x1a0)+_0x25b6fe[_0x394c72(0x19c)]);}},processSubSiteSensorByAPI=async(_0x5c7bd5,_0x194f58)=>{const _0x3cb141=a0_0x56a4ab,_0x17307d={'zknsu':function(_0x382a75,_0x534d28){return _0x382a75*_0x534d28;},'aVElY':function(_0x5c3aaa,_0x38f381,_0x5709c2){return _0x5c3aaa(_0x38f381,_0x5709c2);},'vyzhE':_0x3cb141(0x1d0),'tSHQh':function(_0xe1ca46,_0xa9d0df){return _0xe1ca46!==_0xa9d0df;},'hrYre':_0x3cb141(0x1b5),'HpJcG':function(_0x4c9b50,_0xd56b15,_0x28add5){return _0x4c9b50(_0xd56b15,_0x28add5);},'ytkPx':_0x3cb141(0x1bb),'zrYyQ':function(_0x1616ea,_0x4e4066){return _0x1616ea||_0x4e4066;},'BgfVB':_0x3cb141(0x1a8),'OfzFi':function(_0x4101e1,_0x5abf13){return _0x4101e1||_0x5abf13;},'NHOSL':function(_0x12078){return _0x12078();},'WAuRV':_0x3cb141(0x18e),'eTSLv':_0x3cb141(0x1c8)};try{const {api_endpoint:_0x1773e7,sensor_id:_0x3b61f8,subsite_id:_0x493824}=_0x5c7bd5[_0x3cb141(0x1b0)],_0x1506d5=_0x5c7bd5[_0x3cb141(0x1b1)][_0x17307d['BgfVB']];if(_0x17307d[_0x3cb141(0x1a7)](!_0x1773e7,!_0x3b61f8)||!_0x493824||!_0x1506d5)return _0x194f58[_0x3cb141(0x199)](0x190)[_0x3cb141(0x185)]({'message':_0x3cb141(0x1b7)});const _0x4e41cb=await _0x17307d[_0x3cb141(0x184)](getCompanyIdFromToken),_0x1b9396=_0x3cb141(0x180)+_0x4e41cb+'_'+_0x493824,_0x2f5185=_0x3cb141(0x1c7)+_0x4e41cb+'_'+_0x493824,_0x377d19=_0x3cb141(0x192)+_0x4e41cb+'_'+_0x493824;db[_0x3cb141(0x18d)]('SELECT\x20api_endpoint\x20FROM\x20'+_0x1b9396+_0x3cb141(0x188),[_0x1773e7],(_0x2be06b,_0x44b600)=>{const _0x44af7d=_0x3cb141,_0x5dde8f={'kVNAn':function(_0x502337,_0x1b7f50){const _0x267960=a0_0x17b4;return _0x17307d[_0x267960(0x1d7)](_0x502337,_0x1b7f50);},'louxx':function(_0x220d57,_0x290648,_0x28f486){const _0x5aab31=a0_0x17b4;return _0x17307d[_0x5aab31(0x195)](_0x220d57,_0x290648,_0x28f486);},'BjwPI':_0x17307d['vyzhE'],'JPBkM':function(_0x79b6fd,_0x286e57){const _0x2f98e2=a0_0x17b4;return _0x17307d[_0x2f98e2(0x181)](_0x79b6fd,_0x286e57);},'CJldK':function(_0x3f3bfa,_0x7ecf34){return _0x3f3bfa||_0x7ecf34;},'zdpNX':_0x17307d[_0x44af7d(0x1a2)],'jaaKv':function(_0x4ac31c,_0x48fc93,_0x2cd087){const _0x482f66=_0x44af7d;return _0x17307d[_0x482f66(0x19e)](_0x4ac31c,_0x48fc93,_0x2cd087);},'cpJWt':_0x17307d['ytkPx']};if(_0x17307d[_0x44af7d(0x1ab)](_0x2be06b,!_0x44b600))return insertLog(_0x3b61f8,'❌\x20API\x20not\x20found\x20in\x20'+_0x1b9396),_0x194f58[_0x44af7d(0x199)](0x194)['json']({'message':_0x44af7d(0x191)});db[_0x44af7d(0x18d)]('SELECT\x20bank_id,\x20interval_seconds\x20FROM\x20'+_0x2f5185+'\x20WHERE\x20bank_id\x20=\x20?\x20AND\x20is_active\x20=\x201',[_0x3b61f8],(_0x5b6bef,_0x23267d)=>{const _0x496661=_0x44af7d,_0x5a3632={'BxMhD':function(_0x28e3da,_0x42c426){const _0xf10766=a0_0x17b4;return _0x5dde8f[_0xf10766(0x1d5)](_0x28e3da,_0x42c426);},'wXMxK':function(_0x548a50,_0x47639f,_0x352390){return _0x5dde8f['louxx'](_0x548a50,_0x47639f,_0x352390);},'AxsaN':_0x5dde8f[_0x496661(0x1ad)],'pTrcs':function(_0x27d9ec,_0x540c85){return _0x5dde8f['JPBkM'](_0x27d9ec,_0x540c85);},'TtPHJ':function(_0x4d5d67,_0xe90ae5){const _0xdb2f62=_0x496661;return _0x5dde8f[_0xdb2f62(0x17f)](_0x4d5d67,_0xe90ae5);},'yPMem':_0x5dde8f[_0x496661(0x1bc)]};if(_0x5b6bef||!_0x23267d)return _0x5dde8f[_0x496661(0x1c6)](insertLog,_0x3b61f8,_0x496661(0x1cc)+_0x2f5185),_0x194f58[_0x496661(0x199)](0x194)[_0x496661(0x185)]({'message':_0x5dde8f['cpJWt']});const {bank_id:_0x4ff46b,interval_seconds:_0x301c20}=_0x23267d;db['get'](_0x496661(0x189)+_0x2f5185+_0x496661(0x1a9),[_0x4ff46b],(_0x7184ca,_0x259dfe)=>{const _0x572ca1=_0x496661,_0x46918b={'MZDly':function(_0x39cd62,_0x49f329){const _0x451c6c=a0_0x17b4;return _0x5a3632[_0x451c6c(0x19f)](_0x39cd62,_0x49f329);},'etzSi':function(_0x67bc43,_0x58f117,_0x4cf6f9){const _0x30f8a8=a0_0x17b4;return _0x5a3632[_0x30f8a8(0x1bf)](_0x67bc43,_0x58f117,_0x4cf6f9);}};if(_0x5a3632[_0x572ca1(0x1c4)](_0x7184ca,!_0x259dfe))return _0x5a3632[_0x572ca1(0x1bf)](insertLog,_0x4ff46b,'❌\x20Failed\x20to\x20map\x20bank_id\x20to\x20id\x20in\x20'+_0x2f5185),_0x194f58[_0x572ca1(0x199)](0x1f4)[_0x572ca1(0x185)]({'message':_0x5a3632[_0x572ca1(0x1aa)]});const _0x2268cf=_0x259dfe['id'];db[_0x572ca1(0x19d)](_0x572ca1(0x1ac)+_0x377d19+_0x572ca1(0x1ae),[_0x2268cf],_0x2d122a=>{const _0x3fade5=_0x572ca1;if(_0x2d122a)return insertLog(_0x4ff46b,'❌\x20IntervalControl\x20insert\x20failed\x20in\x20'+_0x377d19+':\x20'+_0x2d122a[_0x3fade5(0x19c)]),_0x194f58['status'](0x1f4)[_0x3fade5(0x185)]({'message':_0x3fade5(0x1a1)});return intervalManager['startFetch'](_0x4ff46b,async()=>{const _0x68f91a=_0x3fade5,_0x3f91eb={'CcDBj':function(_0x114cdc,_0x58ed34){return _0x114cdc||_0x58ed34;},'WHKYP':function(_0x9f578c,_0x167df0){const _0x4d1580=a0_0x17b4;return _0x46918b[_0x4d1580(0x1b2)](_0x9f578c,_0x167df0);}};try{db[_0x68f91a(0x18d)](_0x68f91a(0x1d2)+_0x377d19+'\x20WHERE\x20sensor_id\x20=\x20?',[_0x2268cf],(_0x118141,_0x571d4a)=>{const _0x3fc9df=_0x68f91a;if(_0x3f91eb[_0x3fc9df(0x1b8)](_0x118141,!_0x571d4a)||_0x3f91eb[_0x3fc9df(0x18a)](_0x571d4a[_0x3fc9df(0x1ce)],0x1))return;fetchAndStoreSubSiteSensorData({'sensor_id':_0x4ff46b,'api_endpoint':_0x1773e7,'interval_seconds':_0x301c20},_0x4e41cb,_0x493824,_0x1506d5);});}catch(_0x15500c){_0x46918b[_0x68f91a(0x187)](insertLog,_0x4ff46b,_0x68f91a(0x1b3)+_0x15500c[_0x68f91a(0x19c)]);}},_0x5a3632[_0x3fade5(0x17b)](_0x301c20,0x3e8)),_0x5a3632['wXMxK'](insertLog,_0x4ff46b,_0x3fade5(0x197)+_0x301c20+'s'),_0x194f58['status'](0xc8)[_0x3fade5(0x185)]({'message':_0x5a3632[_0x3fade5(0x1a4)],'sensor_id':_0x4ff46b,'companyId':_0x4e41cb,'subsiteId':_0x493824,'interval_seconds':_0x301c20});});});});});}catch(_0x40a67d){console[_0x3cb141(0x1c2)](_0x17307d['WAuRV'],_0x40a67d[_0x3cb141(0x19c)]),_0x194f58[_0x3cb141(0x199)](0x1f4)['json']({'message':_0x17307d[_0x3cb141(0x198)],'error':_0x40a67d['message']});}};function a0_0x4925(){const _0x23e42d=['277284Llwnwm','Fepjs','NHOSL','json','1192532lGgxck','etzSi','\x20WHERE\x20api_endpoint\x20=\x20?','SELECT\x20id\x20FROM\x20','WHKYP','verify','\x20sensor\x20','get','❌\x20Error\x20in\x20processSubSiteSensorByAPI:','sensor_id','FsiSS','API\x20not\x20registered\x20in\x20local\x20DB','IntervalControl_','xLoZr','5824eWwNtx','aVElY','Bearer\x20','🚀\x20Started\x20sub-site\x20fetch\x20every\x20','eTSLv','status','zRIZq','https','message','run','HpJcG','pTrcs','❌\x20Fetch\x20error:\x20','Failed\x20to\x20update\x20fetch\x20control','hrYre','3ZyYAxA','AxsaN','CFZQO','companyId','OfzFi','x-desigo-token','\x20WHERE\x20bank_id\x20=\x20?','yPMem','zrYyQ','INSERT\x20INTO\x20','BjwPI','\x20(sensor_id,\x20is_fetching)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(sensor_id)\x20DO\x20UPDATE\x20SET\x20is_fetching\x20=\x201','\x20(sensor_id,\x20value,\x20quality,\x20quality_good,\x20timestamp)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','query','headers','MZDly','❌\x20Interval\x20crash:\x20','❌\x20Insert\x20error\x20into\x20','Internal\x20ID\x20mapping\x20error','SensorData_','api_endpoint,\x20sensor_id,\x20subsite_id\x20and\x20token\x20required','CcDBj','axios','exports','Sensor\x20not\x20active\x20or\x20not\x20found','zdpNX','503200RupEtz','6533793mFOrNk','wXMxK','482738pMmikS','token','error','JWT_SECRET_APP','TtPHJ','✅\x20Data\x20inserted\x20into\x20','jaaKv','Sensor_','Internal\x20Server\x20Error','\x20in\x20sub-site\x20','aWoMy','env','❌\x20Sensor\x20not\x20active\x20in\x20','3165775PrOAOU','is_fetching','../utils/intervalManagerSubSite','Sub-site\x20fetch\x20started','data','SELECT\x20is_fetching\x20FROM\x20','../db/sensorDB','3598KyEPCl','kVNAn','❌\x20Insert\x20error:\x20','zknsu','BxMhD','❌\x20Fetch\x20error\x20for\x20sub-site\x20','../utils/logHelpersSubSite','❌\x20No\x20active\x20sensor\x20found\x20for\x20bank_id=','CJldK','SensorAPI_','tSHQh'];a0_0x4925=function(){return _0x23e42d;};return a0_0x4925();}function a0_0x17b4(_0xfe5bf9,_0x5e0e4d){const _0x49255d=a0_0x4925();return a0_0x17b4=function(_0x17b46a,_0xf32b1c){_0x17b46a=_0x17b46a-0x17b;let _0x3e33b5=_0x49255d[_0x17b46a];return _0x3e33b5;},a0_0x17b4(_0xfe5bf9,_0x5e0e4d);}module[a0_0x56a4ab(0x1ba)]={'processSubSiteSensorByAPI':processSubSiteSensorByAPI,'fetchAndStoreSubSiteSensorData':fetchAndStoreSubSiteSensorData};