function a0_0x41fc(_0xddd28a,_0xefdc0c){const _0x42091a=a0_0x4209();return a0_0x41fc=function(_0x41fc08,_0x36a3c6){_0x41fc08=_0x41fc08-0x148;let _0x5c8114=_0x42091a[_0x41fc08];return _0x5c8114;},a0_0x41fc(_0xddd28a,_0xefdc0c);}const a0_0x368a22=a0_0x41fc;function a0_0x4209(){const _0x52bc5c=['âŒ\x20No\x20active\x20sensor\x20found\x20for\x20bank_id=','7521408qBSfaI','headers','eiJDj','Sub-site\x20fetch\x20started','zTeqr','JWT_SECRET_APP','7792938tdYHCK','SensorAPI_','SensorData_','Internal\x20Server\x20Error','vsqjn','data','JlQLq','CcEXS','\x20(sensor_id,\x20value,\x20quality,\x20quality_good,\x20timestamp)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','SELECT\x20is_fetching\x20FROM\x20','startFetch','query','token','\x20WHERE\x20sensor_id\x20=\x20?','jsonwebtoken','dxvlM','interval_seconds','message','Bearer\x20','api_endpoint,\x20sensor_id,\x20subsite_id\x20and\x20token\x20required','INSERT\x20INTO\x20','\x20(sensor_id,\x20is_fetching)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(sensor_id)\x20DO\x20UPDATE\x20SET\x20is_fetching\x20=\x201','inMFB','âš ï¸\x20No\x20data\x20returned\x20from\x20Desigo\x20endpoint','SELECT\x20api_endpoint\x20FROM\x20','haGoi','Sensor_','VURnE','11026aSPTHW','Agent','AvLqt','get','NNXQD','https','SELECT\x20token\x20FROM\x20AuthTokens\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x201','esVpI','exports','âŒ\x20Error\x20in\x20processSubSiteSensorByAPI:','run','Yakua','json','40pzGwUr','âŒ\x20API\x20not\x20found\x20in\x20','ðŸš€\x20Started\x20sub-site\x20fetch\x20every\x20','15087807gEbCGy','IntervalControl_','kNbEa','sensor_id','Sensor\x20not\x20active\x20or\x20not\x20found','../utils/logHelpersSubSite','\x20WHERE\x20bank_id\x20=\x20?','âŒ\x20Insert\x20error\x20into\x20','../utils/intervalManagerSubSite','error','No\x20stored\x20token\x20found.','DicpY','UdaUl','âŒ\x20Insert\x20error:\x20','2490783SRfNEA','DkaUZ','bzeew','SELECT\x20id\x20FROM\x20','TcGtq','is_fetching','companyId','5586860IjQKVv','jARmy','Failed\x20to\x20update\x20fetch\x20control','âŒ\x20Interval\x20crash:\x20','2179856nhCdIT','x-desigo-token','327nqHzDY','âŒ\x20Fetch\x20error:','status','TXZUN'];a0_0x4209=function(){return _0x52bc5c;};return a0_0x4209();}(function(_0x47aacf,_0x58b0b9){const _0x449d6c=a0_0x41fc,_0x236c80=_0x47aacf();while(!![]){try{const _0x3b47ea=-parseInt(_0x449d6c(0x16c))/0x1*(parseInt(_0x449d6c(0x193))/0x2)+parseInt(_0x449d6c(0x15f))/0x3+parseInt(_0x449d6c(0x171))/0x4+-parseInt(_0x449d6c(0x166))/0x5+parseInt(_0x449d6c(0x177))/0x6+parseInt(_0x449d6c(0x16a))/0x7*(parseInt(_0x449d6c(0x14e))/0x8)+-parseInt(_0x449d6c(0x151))/0x9;if(_0x3b47ea===_0x58b0b9)break;else _0x236c80['push'](_0x236c80['shift']());}catch(_0x27d617){_0x236c80['push'](_0x236c80['shift']());}}}(a0_0x4209,0xeccca));const axios=require('axios'),jwt=require(a0_0x368a22(0x185)),https=require(a0_0x368a22(0x198)),{db}=require('../db/sensorDB'),{insertSubsiteLog}=require(a0_0x368a22(0x156)),intervalManager=require(a0_0x368a22(0x159)),agent=new https[(a0_0x368a22(0x194))]({'rejectUnauthorized':![]}),getStoredToken=()=>{const _0x1a5829=a0_0x368a22,_0x32db82={'TXZUN':function(_0x490b1a,_0x294b17){return _0x490b1a||_0x294b17;},'jARmy':function(_0x5deb9a,_0x11b6b8){return _0x5deb9a(_0x11b6b8);},'kNbEa':_0x1a5829(0x15b),'DicpY':function(_0x323d67,_0x1f0a96){return _0x323d67(_0x1f0a96);}};return new Promise((_0x1fa30e,_0x3520d8)=>{const _0x35ddc7=_0x1a5829;db[_0x35ddc7(0x196)](_0x35ddc7(0x199),[],(_0x5df13b,_0x4551bb)=>{const _0xa981e5=_0x35ddc7;if(_0x32db82[_0xa981e5(0x16f)](_0x5df13b,!_0x4551bb))_0x32db82[_0xa981e5(0x167)](_0x3520d8,_0x32db82[_0xa981e5(0x153)]);else _0x32db82[_0xa981e5(0x15c)](_0x1fa30e,_0x4551bb[_0xa981e5(0x183)]);});});},getCompanyIdFromToken=async()=>{const _0x41fa57=a0_0x368a22,_0x296f77={'Yakua':function(_0x454628){return _0x454628();}},_0x18510b=await _0x296f77[_0x41fa57(0x14c)](getStoredToken),_0x414004=jwt['verify'](_0x18510b,process['env'][_0x41fa57(0x176)]);return _0x414004[_0x41fa57(0x165)];},fetchAndStoreSubSiteSensorData=async(_0x5773fd,_0x2369a5,_0x4a69ff,_0x507ea5)=>{const _0x313d4a=a0_0x368a22,_0x273adf={'koJyq':function(_0x5c69a0,_0x2562f0,_0x2aafa1,_0x390c57,_0x306112){return _0x5c69a0(_0x2562f0,_0x2aafa1,_0x390c57,_0x306112);},'vsqjn':function(_0x29ffaa,_0x1cd7a2,_0x4d974,_0x30faa1,_0x1c9b6b){return _0x29ffaa(_0x1cd7a2,_0x4d974,_0x30faa1,_0x1c9b6b);},'WoGBC':function(_0x11b025,_0x295a8b){return _0x11b025||_0x295a8b;},'haGoi':function(_0x1e1a7f,_0x2e0e59,_0x555e7c,_0x458613,_0x1fe44b){return _0x1e1a7f(_0x2e0e59,_0x555e7c,_0x458613,_0x1fe44b);}};try{const {sensor_id:_0x3f9971,api_endpoint:_0x2139bf}=_0x5773fd,_0x3d5a5e=await axios[_0x313d4a(0x196)](_0x2139bf,{'headers':{'Authorization':_0x313d4a(0x189)+_0x507ea5},'httpsAgent':agent}),_0xbb4c68=_0x3d5a5e[_0x313d4a(0x17c)]?.[0x0]?.['Value'];if(!_0xbb4c68){_0x273adf[_0x313d4a(0x17b)](insertSubsiteLog,_0x3f9971,_0x313d4a(0x18e),_0x2369a5,_0x4a69ff);return;}const {Value:_0x1c786c,Quality:_0x29e8bf,QualityGood:_0x1f9b48,Timestamp:_0x379687}=_0xbb4c68,_0x272ad=_0x313d4a(0x179)+_0x2369a5+'_'+_0x4a69ff+'_'+_0x3f9971,_0x533510=_0x313d4a(0x191)+_0x2369a5+'_'+_0x4a69ff;db[_0x313d4a(0x196)](_0x313d4a(0x162)+_0x533510+_0x313d4a(0x157),[_0x3f9971],(_0x5814a1,_0x17d48a)=>{const _0x1afb23=_0x313d4a;if(_0x273adf['WoGBC'](_0x5814a1,!_0x17d48a)){console[_0x1afb23(0x15a)](_0x1afb23(0x170)+_0x3f9971),_0x273adf[_0x1afb23(0x190)](insertSubsiteLog,_0x3f9971,'âŒ\x20No\x20matching\x20sensor_id\x20in\x20'+_0x533510,_0x2369a5,_0x4a69ff);return;}const _0x5a45bd=_0x17d48a['id'];db[_0x1afb23(0x14b)](_0x1afb23(0x18b)+_0x272ad+_0x1afb23(0x17f),[_0x5a45bd,_0x1c786c,_0x29e8bf,_0x1f9b48,_0x379687],_0x161c1f=>{const _0x29aaa4=_0x1afb23;_0x161c1f?(console[_0x29aaa4(0x15a)](_0x29aaa4(0x158)+_0x272ad+':',_0x161c1f[_0x29aaa4(0x188)]),_0x273adf['koJyq'](insertSubsiteLog,_0x3f9971,_0x29aaa4(0x15e)+_0x161c1f[_0x29aaa4(0x188)],_0x2369a5,_0x4a69ff)):_0x273adf['vsqjn'](insertSubsiteLog,_0x3f9971,'âœ…\x20Data\x20inserted\x20into\x20'+_0x272ad,_0x2369a5,_0x4a69ff);});});}catch(_0x1345c5){console[_0x313d4a(0x15a)](_0x313d4a(0x16d),_0x1345c5['message']),_0x273adf[_0x313d4a(0x17b)](insertSubsiteLog,_0x5773fd[_0x313d4a(0x154)],'âŒ\x20Fetch\x20error:\x20'+_0x1345c5['message'],_0x2369a5,_0x4a69ff);}},processSubSiteSensorByAPI=async(_0x1f9295,_0x343ffa)=>{const _0x2a25cc=a0_0x368a22,_0x420bde={'eiJDj':function(_0x1216af,_0xd7ae84,_0x3c4689,_0x54fbf6,_0x1d48a6){return _0x1216af(_0xd7ae84,_0x3c4689,_0x54fbf6,_0x1d48a6);},'DkaUZ':function(_0xea51d8,_0x370ee3){return _0xea51d8||_0x370ee3;},'CcEXS':function(_0x298291,_0x45da69,_0x29900c,_0x2e159d,_0x596896){return _0x298291(_0x45da69,_0x29900c,_0x2e159d,_0x596896);},'JlQLq':_0x2a25cc(0x168),'UdaUl':_0x2a25cc(0x155),'AvLqt':function(_0xfa1bb9,_0x5e947a){return _0xfa1bb9||_0x5e947a;},'eHYvS':function(_0x228cce,_0x2c7a58,_0x4b9de8,_0x55f16f,_0x44ee20){return _0x228cce(_0x2c7a58,_0x4b9de8,_0x55f16f,_0x44ee20);},'dxvlM':_0x2a25cc(0x16b),'zTeqr':_0x2a25cc(0x18a),'TcGtq':_0x2a25cc(0x14a),'ubluZ':_0x2a25cc(0x17a)};try{const {api_endpoint:_0x17b027,sensor_id:_0x1d4ff2,subsite_id:_0x3a1318}=_0x1f9295[_0x2a25cc(0x182)],_0x3f2597=_0x1f9295[_0x2a25cc(0x172)][_0x420bde[_0x2a25cc(0x186)]];if(_0x420bde[_0x2a25cc(0x195)](!_0x17b027,!_0x1d4ff2)||!_0x3a1318||!_0x3f2597)return _0x343ffa[_0x2a25cc(0x16e)](0x190)[_0x2a25cc(0x14d)]({'message':_0x420bde[_0x2a25cc(0x175)]});const _0x4a05b4=await getCompanyIdFromToken(),_0x4f7b2c=_0x2a25cc(0x178)+_0x4a05b4+'_'+_0x3a1318,_0x17f722='Sensor_'+_0x4a05b4+'_'+_0x3a1318,_0x5b026d=_0x2a25cc(0x152)+_0x4a05b4+'_'+_0x3a1318;db[_0x2a25cc(0x196)](_0x2a25cc(0x18f)+_0x4f7b2c+'\x20WHERE\x20api_endpoint\x20=\x20?',[_0x17b027],(_0x560944,_0x1ad291)=>{const _0x16d8b7=_0x2a25cc;if(_0x420bde[_0x16d8b7(0x195)](_0x560944,!_0x1ad291))return _0x420bde['eHYvS'](insertSubsiteLog,_0x1d4ff2,_0x16d8b7(0x14f)+_0x4f7b2c,_0x4a05b4,_0x3a1318),_0x343ffa[_0x16d8b7(0x16e)](0x194)[_0x16d8b7(0x14d)]({'message':'API\x20not\x20registered\x20in\x20local\x20DB'});db[_0x16d8b7(0x196)]('SELECT\x20id,\x20interval_seconds\x20FROM\x20'+_0x17f722+'\x20WHERE\x20bank_id\x20=\x20?\x20AND\x20is_active\x20=\x201',[_0x1d4ff2],(_0x474d4a,_0x558459)=>{const _0x147586=_0x16d8b7,_0x1586b1={'inMFB':function(_0x2c9a0f,_0x432a1e,_0x1f42db,_0x128bd6,_0x115e16){const _0x846b2e=a0_0x41fc;return _0x420bde[_0x846b2e(0x173)](_0x2c9a0f,_0x432a1e,_0x1f42db,_0x128bd6,_0x115e16);},'VURnE':function(_0x58ccbc,_0x534aa5){return _0x420bde['DkaUZ'](_0x58ccbc,_0x534aa5);},'bzeew':function(_0x16e80e,_0x36792a,_0x312b81,_0x1b60da,_0x4a7368){const _0x77e654=a0_0x41fc;return _0x420bde[_0x77e654(0x17e)](_0x16e80e,_0x36792a,_0x312b81,_0x1b60da,_0x4a7368);},'NNXQD':_0x420bde[_0x147586(0x17d)],'ThPLc':_0x147586(0x174)};if(_0x420bde[_0x147586(0x160)](_0x474d4a,!_0x558459))return _0x420bde[_0x147586(0x17e)](insertSubsiteLog,_0x1d4ff2,'âŒ\x20Sensor\x20not\x20active\x20in\x20'+_0x17f722,_0x4a05b4,_0x3a1318),_0x343ffa[_0x147586(0x16e)](0x194)[_0x147586(0x14d)]({'message':_0x420bde[_0x147586(0x15d)]});const _0x1962df=_0x558459['id'],_0x4b0679=_0x1d4ff2;db['run']('INSERT\x20INTO\x20'+_0x5b026d+_0x147586(0x18c),[_0x1962df],_0xcbb063=>{const _0x73d753=_0x147586,_0x193b92={'esVpI':function(_0x16db73,_0xaf3854){const _0x399a5e=a0_0x41fc;return _0x1586b1[_0x399a5e(0x192)](_0x16db73,_0xaf3854);},'qoUGX':function(_0x3bff40,_0x29999d,_0x124612,_0x3370d5,_0x1829f5){const _0x1dc096=a0_0x41fc;return _0x1586b1[_0x1dc096(0x18d)](_0x3bff40,_0x29999d,_0x124612,_0x3370d5,_0x1829f5);}};if(_0xcbb063)return _0x1586b1[_0x73d753(0x161)](insertSubsiteLog,_0x4b0679,'âŒ\x20IntervalControl\x20insert\x20failed:\x20'+_0xcbb063[_0x73d753(0x188)],_0x4a05b4,_0x3a1318),_0x343ffa[_0x73d753(0x16e)](0x1f4)[_0x73d753(0x14d)]({'message':_0x1586b1[_0x73d753(0x197)]});return intervalManager[_0x73d753(0x181)](_0x4b0679,async()=>{const _0xe8d6ed=_0x73d753;try{db[_0xe8d6ed(0x196)](_0xe8d6ed(0x180)+_0x5b026d+_0xe8d6ed(0x184),[_0x1962df],(_0x314c47,_0x38b9b5)=>{const _0x51ee04=_0xe8d6ed;if(_0x193b92[_0x51ee04(0x148)](_0x314c47,!_0x38b9b5)||_0x38b9b5[_0x51ee04(0x164)]!==0x1)return;_0x193b92['qoUGX'](fetchAndStoreSubSiteSensorData,{'sensor_id':_0x4b0679,'api_endpoint':_0x17b027,'interval_seconds':_0x558459[_0x51ee04(0x187)]},_0x4a05b4,_0x3a1318,_0x3f2597);});}catch(_0x10cfed){_0x1586b1[_0xe8d6ed(0x18d)](insertSubsiteLog,_0x4b0679,_0xe8d6ed(0x169)+_0x10cfed[_0xe8d6ed(0x188)],_0x4a05b4,_0x3a1318);}},_0x558459[_0x73d753(0x187)]*0x3e8),_0x1586b1['inMFB'](insertSubsiteLog,_0x4b0679,_0x73d753(0x150)+_0x558459[_0x73d753(0x187)]+'s',_0x4a05b4,_0x3a1318),_0x343ffa[_0x73d753(0x16e)](0xc8)[_0x73d753(0x14d)]({'message':_0x1586b1['ThPLc'],'sensor_id':_0x4b0679,'companyId':_0x4a05b4,'subsiteId':_0x3a1318,'interval_seconds':_0x558459[_0x73d753(0x187)]});});});});}catch(_0x412c6e){console['error'](_0x420bde[_0x2a25cc(0x163)],_0x412c6e[_0x2a25cc(0x188)]),_0x343ffa[_0x2a25cc(0x16e)](0x1f4)[_0x2a25cc(0x14d)]({'message':_0x420bde['ubluZ'],'error':_0x412c6e[_0x2a25cc(0x188)]});}};module[a0_0x368a22(0x149)]={'processSubSiteSensorByAPI':processSubSiteSensorByAPI,'fetchAndStoreSubSiteSensorData':fetchAndStoreSubSiteSensorData};