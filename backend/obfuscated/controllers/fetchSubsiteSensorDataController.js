function a0_0x2ba4(_0x2f31aa,_0x4d408a){const _0x49d36f=a0_0x49d3();return a0_0x2ba4=function(_0x2ba484,_0xdcecc4){_0x2ba484=_0x2ba484-0x149;let _0x152743=_0x49d36f[_0x2ba484];return _0x152743;},a0_0x2ba4(_0x2f31aa,_0x4d408a);}const a0_0x10f5cd=a0_0x2ba4;(function(_0x32efda,_0xef2df4){const _0x173ff9=a0_0x2ba4,_0x2bb743=_0x32efda();while(!![]){try{const _0x3d6904=parseInt(_0x173ff9(0x175))/0x1+-parseInt(_0x173ff9(0x164))/0x2+parseInt(_0x173ff9(0x15d))/0x3+-parseInt(_0x173ff9(0x159))/0x4*(-parseInt(_0x173ff9(0x190))/0x5)+parseInt(_0x173ff9(0x14f))/0x6+parseInt(_0x173ff9(0x180))/0x7+-parseInt(_0x173ff9(0x169))/0x8*(parseInt(_0x173ff9(0x15b))/0x9);if(_0x3d6904===_0xef2df4)break;else _0x2bb743['push'](_0x2bb743['shift']());}catch(_0x41a70a){_0x2bb743['push'](_0x2bb743['shift']());}}}(a0_0x49d3,0xd84ef));const axios=require(a0_0x10f5cd(0x150)),jwt=require(a0_0x10f5cd(0x18b)),https=require(a0_0x10f5cd(0x16a)),{db}=require(a0_0x10f5cd(0x15a)),{insertSubsiteLog}=require('../utils/logHelpersSubSite'),intervalManager=require(a0_0x10f5cd(0x17b)),agent=new https['Agent']({'rejectUnauthorized':![]}),getStoredToken=()=>{const _0x27ecd5=a0_0x10f5cd,_0x1693e2={'qFMvO':function(_0x487841,_0x344541){return _0x487841||_0x344541;},'nvLpe':_0x27ecd5(0x14c)};return new Promise((_0x411d65,_0x2f3e54)=>{const _0x2b0a6c=_0x27ecd5,_0x53a29d={'RDccv':function(_0x1776e3,_0xcd5211){const _0x3aab0b=a0_0x2ba4;return _0x1693e2[_0x3aab0b(0x18e)](_0x1776e3,_0xcd5211);},'cJmkJ':_0x2b0a6c(0x173),'AHOQE':function(_0x166cfe,_0x10c589){return _0x166cfe(_0x10c589);}};db[_0x2b0a6c(0x179)](_0x1693e2[_0x2b0a6c(0x172)],[],(_0x59c7e6,_0x5222f4)=>{const _0x3f218a=_0x2b0a6c;if(_0x53a29d[_0x3f218a(0x188)](_0x59c7e6,!_0x5222f4))_0x2f3e54(_0x53a29d[_0x3f218a(0x15f)]);else _0x53a29d[_0x3f218a(0x194)](_0x411d65,_0x5222f4['token']);});});},getCompanyIdFromToken=async()=>{const _0x8cb34d=a0_0x10f5cd,_0x2e2ef8={'wYgVn':function(_0x1f5421){return _0x1f5421();}},_0x153eda=await _0x2e2ef8[_0x8cb34d(0x16d)](getStoredToken),_0x1d61bf=jwt['verify'](_0x153eda,process['env'][_0x8cb34d(0x189)]);return _0x1d61bf[_0x8cb34d(0x14e)];},fetchAndStoreSubSiteSensorData=async(_0x1db352,_0x1ca569,_0x246682,_0x5dc119)=>{const _0x5bc7c5=a0_0x10f5cd,_0x336175={'iuLHa':function(_0x15407e,_0x2c7b8d,_0x21e359,_0x512615,_0x3fc2a7){return _0x15407e(_0x2c7b8d,_0x21e359,_0x512615,_0x3fc2a7);},'eBtwR':function(_0x3d766a,_0x408b91,_0x585349,_0x2d5f8f,_0x540ffe){return _0x3d766a(_0x408b91,_0x585349,_0x2d5f8f,_0x540ffe);},'MhZYK':function(_0x5c7b66,_0x595596,_0x44a1e8,_0x3d1e09,_0x59675b){return _0x5c7b66(_0x595596,_0x44a1e8,_0x3d1e09,_0x59675b);}};try{const {sensor_id:_0x296da1,api_endpoint:_0x1f9c0d}=_0x1db352,_0x1dfaf8=await axios[_0x5bc7c5(0x179)](_0x1f9c0d,{'headers':{'Authorization':_0x5bc7c5(0x152)+_0x5dc119},'httpsAgent':agent}),_0x358198=_0x1dfaf8[_0x5bc7c5(0x196)]?.[0x0]?.['Value'];if(!_0x358198){_0x336175[_0x5bc7c5(0x16f)](insertSubsiteLog,_0x296da1,'‚ö†Ô∏è\x20No\x20data\x20returned\x20from\x20Desigo\x20endpoint',_0x1ca569,_0x246682);return;}const {Value:_0x114fe7,Quality:_0x1934ab,QualityGood:_0x1ad980,Timestamp:_0x36a8c0}=_0x358198,_0x17947e=_0x5bc7c5(0x151)+_0x1ca569+'_'+_0x246682+'_'+_0x296da1,_0x48f807='Sensor_'+_0x1ca569+'_'+_0x246682;db[_0x5bc7c5(0x179)](_0x5bc7c5(0x154)+_0x48f807+_0x5bc7c5(0x168),[_0x296da1],(_0x26d928,_0xc86538)=>{const _0x2e0d26=_0x5bc7c5;if(_0x26d928||!_0xc86538){console[_0x2e0d26(0x185)](_0x2e0d26(0x192)+_0x296da1),_0x336175['eBtwR'](insertSubsiteLog,_0x296da1,_0x2e0d26(0x163)+_0x48f807,_0x1ca569,_0x246682);return;}const _0x4f53f7=_0xc86538['id'];db[_0x2e0d26(0x156)](_0x2e0d26(0x167)+_0x17947e+_0x2e0d26(0x18c),[_0x4f53f7,_0x114fe7,_0x1934ab,_0x1ad980,_0x36a8c0],_0x4de11d=>{const _0x480471=_0x2e0d26;_0x4de11d?(console[_0x480471(0x185)](_0x480471(0x149)+_0x17947e+':',_0x4de11d[_0x480471(0x17e)]),_0x336175['iuLHa'](insertSubsiteLog,_0x296da1,'‚ùå\x20Insert\x20error:\x20'+_0x4de11d[_0x480471(0x17e)],_0x1ca569,_0x246682)):_0x336175['iuLHa'](insertSubsiteLog,_0x296da1,_0x480471(0x17f)+_0x17947e,_0x1ca569,_0x246682);});});}catch(_0x2f688c){console[_0x5bc7c5(0x185)](_0x5bc7c5(0x181),_0x2f688c['message']),_0x336175[_0x5bc7c5(0x17d)](insertSubsiteLog,_0x1db352['sensor_id'],_0x5bc7c5(0x15e)+_0x2f688c[_0x5bc7c5(0x17e)],_0x1ca569,_0x246682);}},processSubSiteSensorByAPI=async(_0x2d1a81,_0x34a43d)=>{const _0x254143=a0_0x10f5cd,_0x1899f5={'iPuYK':function(_0x46258f,_0x7b23a7){return _0x46258f||_0x7b23a7;},'gdczH':_0x254143(0x187),'zziRt':_0x254143(0x17a),'Yxbvq':function(_0x32ed4b,_0x15ba9c){return _0x32ed4b||_0x15ba9c;},'HxQtb':'Sensor\x20not\x20active\x20or\x20not\x20found','KZfYX':function(_0x2f6baa,_0x286793,_0x176c97,_0x1fc2aa,_0x46c1b1){return _0x2f6baa(_0x286793,_0x176c97,_0x1fc2aa,_0x46c1b1);},'DzErH':_0x254143(0x183),'fFMNv':_0x254143(0x18a),'UnBlF':function(_0x3f529f){return _0x3f529f();},'jHlKq':_0x254143(0x155)};try{const {api_endpoint:_0x3b79d1,sensor_id:_0x40edf5,subsite_id:_0x2381c6}=_0x2d1a81['body'],_0x37cf14=_0x2d1a81[_0x254143(0x191)]['x-desigo-token'];if(_0x1899f5[_0x254143(0x166)](!_0x3b79d1,!_0x40edf5)||!_0x2381c6||!_0x37cf14)return _0x34a43d[_0x254143(0x14a)](0x190)['json']({'message':_0x1899f5[_0x254143(0x157)]});const _0xf464bf=await _0x1899f5[_0x254143(0x171)](getCompanyIdFromToken),_0xc56adf=_0x254143(0x14b)+_0xf464bf+'_'+_0x2381c6,_0x3b4578=_0x254143(0x165)+_0xf464bf+'_'+_0x2381c6,_0x595570=_0x254143(0x16e)+_0xf464bf+'_'+_0x2381c6;db[_0x254143(0x179)](_0x254143(0x153)+_0xc56adf+_0x254143(0x193),[_0x3b79d1],(_0x3f73fb,_0x28b940)=>{const _0x36d2d7=_0x254143;if(_0x1899f5[_0x36d2d7(0x18d)](_0x3f73fb,!_0x28b940))return _0x1899f5[_0x36d2d7(0x16c)](insertSubsiteLog,_0x40edf5,_0x36d2d7(0x17c)+_0xc56adf,_0xf464bf,_0x2381c6),_0x34a43d[_0x36d2d7(0x14a)](0x194)[_0x36d2d7(0x160)]({'message':_0x1899f5[_0x36d2d7(0x178)]});db[_0x36d2d7(0x179)]('SELECT\x20id,\x20interval_seconds\x20FROM\x20'+_0x3b4578+_0x36d2d7(0x176),[_0x40edf5],(_0x4abf90,_0x127dd2)=>{const _0x47b3e5=_0x36d2d7,_0x13d6e6={'sXFhp':function(_0x575d18,_0x13aa0f){const _0x16aef5=a0_0x2ba4;return _0x1899f5[_0x16aef5(0x18d)](_0x575d18,_0x13aa0f);},'sWRJe':_0x1899f5['gdczH'],'jTaoH':_0x1899f5[_0x47b3e5(0x177)]};if(_0x1899f5[_0x47b3e5(0x166)](_0x4abf90,!_0x127dd2))return insertSubsiteLog(_0x40edf5,'‚ùå\x20Sensor\x20not\x20active\x20in\x20'+_0x3b4578,_0xf464bf,_0x2381c6),_0x34a43d['status'](0x194)[_0x47b3e5(0x160)]({'message':_0x1899f5['HxQtb']});const _0x1def16=_0x127dd2['id'],_0x6548b0=_0x40edf5;db[_0x47b3e5(0x156)](_0x47b3e5(0x167)+_0x595570+'\x20(sensor_id,\x20is_fetching)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(sensor_id)\x20DO\x20UPDATE\x20SET\x20is_fetching\x20=\x201',[_0x1def16],_0x365dae=>{const _0x1b8131=_0x47b3e5,_0x691720={'WCIrZ':function(_0x30cb32,_0x14abf0){const _0xdd465f=a0_0x2ba4;return _0x13d6e6[_0xdd465f(0x14d)](_0x30cb32,_0x14abf0);},'KuCou':function(_0x442ef0,_0x2a3fe4,_0x3ee56d,_0x83bda4,_0x34c53b){return _0x442ef0(_0x2a3fe4,_0x3ee56d,_0x83bda4,_0x34c53b);}};if(_0x365dae)return insertSubsiteLog(_0x6548b0,'‚ùå\x20IntervalControl\x20insert\x20failed:\x20'+_0x365dae[_0x1b8131(0x17e)],_0xf464bf,_0x2381c6),_0x34a43d[_0x1b8131(0x14a)](0x1f4)[_0x1b8131(0x160)]({'message':_0x13d6e6[_0x1b8131(0x186)]});return intervalManager[_0x1b8131(0x161)](_0x6548b0,async()=>{const _0x339a40=_0x1b8131;try{db[_0x339a40(0x179)](_0x339a40(0x182)+_0x595570+_0x339a40(0x158),[_0x1def16],(_0x1ff781,_0x2ce998)=>{const _0x156849=_0x339a40;if(_0x691720[_0x156849(0x174)](_0x1ff781,!_0x2ce998)||_0x2ce998[_0x156849(0x170)]!==0x1)return;_0x691720['KuCou'](fetchAndStoreSubSiteSensorData,{'sensor_id':_0x6548b0,'api_endpoint':_0x3b79d1,'interval_seconds':_0x127dd2['interval_seconds']},_0xf464bf,_0x2381c6,_0x37cf14);});}catch(_0x5a780d){insertSubsiteLog(_0x6548b0,_0x339a40(0x16b)+_0x5a780d[_0x339a40(0x17e)],_0xf464bf,_0x2381c6);}},_0x127dd2['interval_seconds']*0x3e8),insertSubsiteLog(_0x6548b0,_0x1b8131(0x162)+_0x127dd2[_0x1b8131(0x184)]+'s',_0xf464bf,_0x2381c6),_0x34a43d['status'](0xc8)['json']({'message':_0x13d6e6[_0x1b8131(0x15c)],'sensor_id':_0x6548b0,'companyId':_0xf464bf,'subsiteId':_0x2381c6,'interval_seconds':_0x127dd2[_0x1b8131(0x184)]});});});});}catch(_0x1aff65){console[_0x254143(0x185)](_0x1899f5['jHlKq'],_0x1aff65['message']),_0x34a43d[_0x254143(0x14a)](0x1f4)[_0x254143(0x160)]({'message':_0x254143(0x18f),'error':_0x1aff65[_0x254143(0x17e)]});}};function a0_0x49d3(){const _0x229857=['get','Sub-site\x20fetch\x20started','../utils/intervalManagerSubSite','‚ùå\x20API\x20not\x20found\x20in\x20','MhZYK','message','‚úÖ\x20Data\x20inserted\x20into\x20','424417ZoPWHR','‚ùå\x20Fetch\x20error:','SELECT\x20is_fetching\x20FROM\x20','API\x20not\x20registered\x20in\x20local\x20DB','interval_seconds','error','sWRJe','Failed\x20to\x20update\x20fetch\x20control','RDccv','JWT_SECRET_APP','api_endpoint,\x20sensor_id,\x20subsite_id\x20and\x20token\x20required','jsonwebtoken','\x20(sensor_id,\x20value,\x20quality,\x20quality_good,\x20timestamp)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','iPuYK','qFMvO','Internal\x20Server\x20Error','2885TCZFuA','headers','‚ùå\x20No\x20active\x20sensor\x20found\x20for\x20bank_id=','\x20WHERE\x20api_endpoint\x20=\x20?','AHOQE','exports','data','‚ùå\x20Insert\x20error\x20into\x20','status','SensorAPI_','SELECT\x20token\x20FROM\x20AuthTokens\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x201','sXFhp','companyId','9320718qwKSyO','axios','SensorData_','Bearer\x20','SELECT\x20api_endpoint\x20FROM\x20','SELECT\x20id\x20FROM\x20','‚ùå\x20Error\x20in\x20processSubSiteSensorByAPI:','run','fFMNv','\x20WHERE\x20sensor_id\x20=\x20?','8688dHxHak','../db/sensorDB','9FrcRIs','jTaoH','4907235rQXwJd','‚ùå\x20Fetch\x20error:\x20','cJmkJ','json','startFetch','üöÄ\x20Started\x20sub-site\x20fetch\x20every\x20','‚ùå\x20No\x20matching\x20sensor_id\x20in\x20','976194bTmyzi','Sensor_','Yxbvq','INSERT\x20INTO\x20','\x20WHERE\x20bank_id\x20=\x20?','32206232aiiQYQ','https','‚ùå\x20Interval\x20crash:\x20','KZfYX','wYgVn','IntervalControl_','eBtwR','is_fetching','UnBlF','nvLpe','No\x20stored\x20token\x20found.','WCIrZ','896802JrsmPX','\x20WHERE\x20bank_id\x20=\x20?\x20AND\x20is_active\x20=\x201','zziRt','DzErH'];a0_0x49d3=function(){return _0x229857;};return a0_0x49d3();}module[a0_0x10f5cd(0x195)]={'processSubSiteSensorByAPI':processSubSiteSensorByAPI,'fetchAndStoreSubSiteSensorData':fetchAndStoreSubSiteSensorData};