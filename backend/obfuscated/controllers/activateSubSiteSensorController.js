function a0_0x2459(_0x437f4e,_0x30c56b){const _0x5914dd=a0_0x5914();return a0_0x2459=function(_0x245943,_0x2206b9){_0x245943=_0x245943-0x119;let _0x1b0a6f=_0x5914dd[_0x245943];return _0x1b0a6f;},a0_0x2459(_0x437f4e,_0x30c56b);}const a0_0x57facf=a0_0x2459;(function(_0x565d87,_0x11079d){const _0x3e4a22=a0_0x2459,_0x2c7ba3=_0x565d87();while(!![]){try{const _0xb7f249=-parseInt(_0x3e4a22(0x157))/0x1*(-parseInt(_0x3e4a22(0x196))/0x2)+-parseInt(_0x3e4a22(0x15c))/0x3+parseInt(_0x3e4a22(0x154))/0x4+parseInt(_0x3e4a22(0x199))/0x5+-parseInt(_0x3e4a22(0x1b1))/0x6*(-parseInt(_0x3e4a22(0x14d))/0x7)+parseInt(_0x3e4a22(0x1a9))/0x8+-parseInt(_0x3e4a22(0x13a))/0x9;if(_0xb7f249===_0x11079d)break;else _0x2c7ba3['push'](_0x2c7ba3['shift']());}catch(_0x3ab201){_0x2c7ba3['push'](_0x2c7ba3['shift']());}}}(a0_0x5914,0xbe311));const axios=require(a0_0x57facf(0x153)),jwt=require(a0_0x57facf(0x176)),{db,createSensorDataTable}=require(a0_0x57facf(0x156));require(a0_0x57facf(0x1af))[a0_0x57facf(0x17d)]();function a0_0x5914(){const _0x5b9370=['response','YzXhx','utbGv','InRYA','pXLve','UPDATE\x20','Failed\x20to\x20reactivate\x20sensor','body','log','ILXiJ','❌\x20DB\x20update\x20failed:','changes','❌\x20Token\x20decoding\x20failed:','khUpz','map','authorization','Sensor\x20deactivated\x20successfully','jJasS','27905067TfNKTu','xibDs','INSERT\x20INTO\x20','batch_size','run','subSiteId','HtRbo','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20','✅\x20Sub-site\x20Sensor\x20','WRfke','AKMTd','/api/subsite/sensor/activation/reactivate','❌\x20Failed\x20to\x20drop\x20table\x20','SensorAPI_','❌\x20IntervalControl\x20check\x20failed:','Sensor\x20removed\x20and\x20table\x20dropped','❌\x20Error\x20updating\x20sensor\x20settings:','query','find','5441485FSIIGe','message','All\x20fields\x20are\x20required','QYIFF','Unauthorized:\x20Invalid\x20token','fBfGJ','axios','4913528RHKXkw','env','../db/sensorDB','597462KHfREL','❌\x20Error\x20removing\x20subsite\x20sensor:','\x20settings\x20updated','Database\x20error\x20while\x20checking\x20IntervalControl','\x20SET\x20is_active\x20=\x200\x20WHERE\x20bank_id\x20=\x20?','2557062FtCPam','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20(id,\x20bank_id,\x20mode,\x20interval_seconds,\x20batch_size,\x20is_active,\x20created_at,\x20updated_at)\x0a\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20\x27manual\x27,\x20?,\x20?,\x201,\x20datetime(\x27now\x27),\x20datetime(\x27now\x27))\x0a\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(id)\x20DO\x20UPDATE\x20SET\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20is_active\x20=\x201,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20interval_seconds\x20=\x20excluded.interval_seconds,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20batch_size\x20=\x20excluded.batch_size','Internal\x20Server\x20Error','/api/subsite/sensor/activation/deactivate','IntervalControl_','split','❌\x20Sensor\x20is\x20actively\x20fetching\x20or\x20sending.\x20Please\x20stop\x20it\x20first\x20before\x20deactivating.','Qtnol','iCBVT','OhMGK','startsWith','DROP\x20TABLE\x20IF\x20EXISTS\x20','\x20settings\x20updated\x20successfully','Fetched\x20sub-site\x20active\x20sensors\x20with\x20local\x20settings\x20and\x20API\x20endpoint','aCZZs','hYHMa','data','vSgNM','Sensor\x20must\x20be\x20deactivated\x20to\x20update\x20settings','✅\x20Sensor\x20','Bearer\x20','Failed\x20to\x20deactivate\x20sensor\x20in\x20Cloud','verify','❌\x20Failed\x20to\x20create\x20SensorData\x20table\x20','⚠️\x20No\x20IntervalControl\x20entry\x20found.\x20Proceeding\x20with\x20caution.','error','jsonwebtoken','AEwiH','Local\x20DB\x20insert\x20failed','Sensor\x20ID\x20and\x20sub-site\x20ID\x20are\x20required','all','PjDLh','get','config','token','Sensor_','UgyQt','/api/subsite/sensor/activation/activate','subsiteId','DRDGx','❌\x20Error\x20activating\x20sub-site\x20sensor:','CLOUD_API_URL','SensorData_','Removal\x20failed','Failed\x20to\x20fetch\x20local\x20sub-site\x20sensors','ATPdr','JWT_SECRET_APP','❌\x20DB\x20Insert\x20failed:','sAeyG','WaOUE','wzQkQ','tgjnR','❌\x20Error\x20in\x20getAllActiveSubSiteSensors:','zkIUv','\x20WHERE\x20bank_id\x20=\x20?','BXbAW','CKuLm','MJbFx','4kacXFt','api_endpoint','N/A','5919060BEmRUG','wOjwa','Sub-site\x20ID\x20is\x20required','Sensor\x20reactivated\x20successfully','\x20SET\x20is_active\x20=\x201\x20WHERE\x20bank_id\x20=\x20?','No\x20token\x20found','SELECT\x20is_fetching,\x20is_sending\x20FROM\x20','is_sending','KVvfS','exports','rRmmJ','HMENy','\x20deactivated\x20in\x20sub-site\x20','SWsYC','❌\x20Error\x20updating\x20sub-site\x20sensor\x20settings:','dpxKo','2779752lQWfYu','Deactivation\x20failed','(id)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','Sensor\x20','headers','Ebhoy','dotenv','AXnxX','6pJjLYA','adminId','subsite_id','post','Activation\x20failed','sensors','❌\x20Cloud\x20deactivation\x20failed:','Sensor\x20ID\x20and\x20Subsite\x20ID\x20required','warn','ZOJay','eHOCL','ZXGQh','MAqKa','XOtlC','status','nQlhb','PjtlN','❌\x20Failed\x20to\x20delete\x20from\x20','bank_id','gQoZj','is_fetching','vZaTh','Local\x20deactivation\x20failed','json','✅\x20Sub-site\x20sensor\x20reactivated\x20in\x20Cloud:','XImNE','❌\x20Error\x20updating\x20local\x20sub-site\x20DB:','❌\x20Error\x20deactivating\x20subsite\x20sensor:'];a0_0x5914=function(){return _0x5b9370;};return a0_0x5914();}const getStoredToken=()=>{const _0x1a2b3b=a0_0x57facf,_0x12d1e2={'jJasS':function(_0x1e4072,_0x3ce600){return _0x1e4072||_0x3ce600;},'HMENy':function(_0x47458c,_0x707119){return _0x47458c(_0x707119);},'dpxKo':_0x1a2b3b(0x19e),'PtunW':'SELECT\x20token\x20FROM\x20AuthTokens\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x201'};return new Promise((_0x31d65b,_0x5ab737)=>{const _0x4f1934=_0x1a2b3b;db[_0x4f1934(0x17c)](_0x12d1e2['PtunW'],[],(_0xda5b0f,_0x9a696)=>{const _0xd9be8=_0x4f1934;if(_0x12d1e2[_0xd9be8(0x139)](_0xda5b0f,!_0x9a696))return _0x12d1e2['HMENy'](_0x5ab737,_0x12d1e2[_0xd9be8(0x1a8)]);_0x12d1e2[_0xd9be8(0x1a4)](_0x31d65b,_0x9a696[_0xd9be8(0x17e)]);});});},getAdminDetailsFromToken=_0x131150=>{const _0x320ec5=a0_0x57facf;try{const _0x44b401=_0x131150[_0x320ec5(0x1ad)][_0x320ec5(0x137)];if(!_0x44b401||!_0x44b401[_0x320ec5(0x166)](_0x320ec5(0x170)))return null;const _0x261679=_0x44b401[_0x320ec5(0x161)]('\x20')[0x1],_0x4f0324=jwt[_0x320ec5(0x172)](_0x261679,process[_0x320ec5(0x155)][_0x320ec5(0x18a)]),_0x3dffa0=_0x4f0324['companyId'],_0x2bf654=_0x4f0324[_0x320ec5(0x1b2)],_0x585e81=_0x4f0324['subSites'];if(!_0x3dffa0)return null;return{'companyId':_0x3dffa0,'adminId':_0x2bf654,'subSites':_0x585e81};}catch(_0x12d111){return console[_0x320ec5(0x175)](_0x320ec5(0x134),_0x12d111[_0x320ec5(0x14e)]),null;}},activateSubSiteSensor=async(_0x249466,_0x2ce331)=>{const _0x44952f=a0_0x57facf,_0x203035={'AXnxX':'Table\x20creation\x20failed','qiouh':'Sensor\x20activated\x20successfully','rRmmJ':_0x44952f(0x18b),'zkIUv':_0x44952f(0x178),'wOjwa':function(_0x2801a6,_0x6057b6){return _0x2801a6||_0x6057b6;},'khUpz':_0x44952f(0x1b8),'AEwiH':function(_0x303750){return _0x303750();},'hYHMa':function(_0x46cd33,_0x291b34){return _0x46cd33??_0x291b34;},'DRDGx':_0x44952f(0x184),'XImNE':_0x44952f(0x1b5)};try{const {sensorId:_0x56f0f0,subsiteId:_0x13824c,interval_seconds:_0x5cb0cd,batch_size:_0x2420b7}=_0x249466[_0x44952f(0x12f)];if(_0x203035[_0x44952f(0x19a)](!_0x56f0f0,!_0x13824c))return _0x2ce331[_0x44952f(0x11a)](0x190)['json']({'message':_0x203035[_0x44952f(0x135)]});const {token:_0x3c655d,companyId:_0x3ebcde}=await _0x203035[_0x44952f(0x177)](getAdminDetailsFromToken),_0x301020=_0x203035[_0x44952f(0x16b)](_0x5cb0cd,0xa),_0x5dbe80=_0x2420b7??0x5,_0x338c5f=process[_0x44952f(0x155)][_0x44952f(0x185)]+_0x44952f(0x181);await axios[_0x44952f(0x1b4)](_0x338c5f,{'sensorId':_0x56f0f0,'subsiteId':_0x13824c,'companyId':_0x3ebcde},{'headers':{'Authorization':_0x44952f(0x170)+_0x3c655d}});const _0x9256aa='Sensor_'+_0x3ebcde+'_'+_0x13824c,_0x42f515=_0x44952f(0x186)+_0x3ebcde+'_'+_0x13824c+'_'+_0x56f0f0;db[_0x44952f(0x13e)](_0x44952f(0x13c)+_0x9256aa+_0x44952f(0x15d),[_0x56f0f0,_0x56f0f0,_0x301020,_0x5dbe80],_0x4e1c20=>{const _0x5ca373=_0x44952f;if(_0x4e1c20)return console[_0x5ca373(0x175)](_0x203035[_0x5ca373(0x1a3)],_0x4e1c20[_0x5ca373(0x14e)]),_0x2ce331[_0x5ca373(0x11a)](0x1f4)[_0x5ca373(0x123)]({'message':_0x203035[_0x5ca373(0x191)]});db['run'](_0x5ca373(0x141)+_0x42f515+'\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20sensor_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20quality\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20quality_good\x20BOOLEAN,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20timestamp\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY(sensor_id)\x20REFERENCES\x20SensorBank_'+_0x3ebcde+'_'+_0x13824c+_0x5ca373(0x1ab),_0x3412fe=>{const _0x492b53=_0x5ca373;if(_0x3412fe)return console[_0x492b53(0x175)](_0x492b53(0x173)+_0x42f515+':',_0x3412fe['message']),_0x2ce331[_0x492b53(0x11a)](0x1f4)[_0x492b53(0x123)]({'message':_0x203035[_0x492b53(0x1b0)]});_0x2ce331[_0x492b53(0x11a)](0xc8)[_0x492b53(0x123)]({'message':_0x203035['qiouh']});});});}catch(_0x56a24d){console[_0x44952f(0x175)](_0x203035[_0x44952f(0x183)],_0x56a24d[_0x44952f(0x14e)]),_0x2ce331[_0x44952f(0x11a)](0x1f4)['json']({'message':_0x203035[_0x44952f(0x125)],'error':_0x56a24d['message']});}},deactivateSubSiteSensor=async(_0x543a73,_0x53bea7)=>{const _0x2d8dc4=a0_0x57facf,_0x303a94={'XNkJG':_0x2d8dc4(0x132),'vZaTh':_0x2d8dc4(0x138),'KVvfS':_0x2d8dc4(0x148),'QYIFF':_0x2d8dc4(0x15a),'CKuLm':_0x2d8dc4(0x174),'HtRbo':function(_0x43c597,_0x3a9d32){return _0x43c597===_0x3a9d32;},'ckRmE':_0x2d8dc4(0x1b7),'InRYA':_0x2d8dc4(0x171),'clRzY':function(_0x42dc2f,_0x169160){return _0x42dc2f||_0x169160;},'iCBVT':'❌\x20Sensor\x20lookup\x20failed:','Ebhoy':'Sensor\x20ID\x20and\x20Subsite\x20ID\x20required','gFNtM':function(_0x55294d,_0x310c92){return _0x55294d(_0x310c92);},'SWsYC':_0x2d8dc4(0x127),'ZXGQh':_0x2d8dc4(0x1aa)};try{const {sensorId:_0x349cc6,subsiteId:_0x51ca4e}=_0x543a73[_0x2d8dc4(0x12f)];if(_0x303a94['clRzY'](!_0x349cc6,!_0x51ca4e))return _0x53bea7['status'](0x190)[_0x2d8dc4(0x123)]({'message':_0x303a94[_0x2d8dc4(0x1ae)]});const {token:_0x1f5dfe,companyId:_0x490b5b}=await _0x303a94['gFNtM'](getAdminDetailsFromToken,_0x543a73),_0x2acbae=_0x2d8dc4(0x160)+_0x490b5b+'_'+_0x51ca4e,_0x1b0c50=_0x2d8dc4(0x17f)+_0x490b5b+'_'+_0x51ca4e;db[_0x2d8dc4(0x17c)]('SELECT\x20id\x20FROM\x20'+_0x1b0c50+_0x2d8dc4(0x192),[_0x349cc6],(_0xf7b33e,_0x11a00f)=>{const _0x33adcd=_0x2d8dc4;if(_0x303a94['clRzY'](_0xf7b33e,!_0x11a00f))return console[_0x33adcd(0x175)](_0x303a94[_0x33adcd(0x164)],_0xf7b33e?.[_0x33adcd(0x14e)]),_0x53bea7[_0x33adcd(0x11a)](0x194)[_0x33adcd(0x123)]({'message':'Sensor\x20not\x20found\x20in\x20local\x20DB'});const _0x13ebaf=_0x11a00f['id'];db[_0x33adcd(0x17c)](_0x33adcd(0x19f)+_0x2acbae+'\x20WHERE\x20sensor_id\x20=\x20?',[_0x13ebaf],async(_0x2daa82,_0x27ba23)=>{const _0x2ffb59=_0x33adcd,_0x265063={'gQoZj':_0x303a94['XNkJG'],'WaOUE':_0x303a94[_0x2ffb59(0x121)]};if(_0x2daa82)return console['error'](_0x303a94[_0x2ffb59(0x1a1)],_0x2daa82[_0x2ffb59(0x14e)]),_0x53bea7[_0x2ffb59(0x11a)](0x1f4)['json']({'message':_0x303a94[_0x2ffb59(0x150)]});if(!_0x27ba23)console[_0x2ffb59(0x1b9)](_0x303a94[_0x2ffb59(0x194)]);else{if(_0x303a94[_0x2ffb59(0x140)](_0x27ba23[_0x2ffb59(0x120)],0x1)||_0x303a94[_0x2ffb59(0x140)](_0x27ba23['is_sending'],0x1))return _0x53bea7[_0x2ffb59(0x11a)](0x193)['json']({'message':_0x2ffb59(0x162),'is_fetching':_0x303a94['HtRbo'](_0x27ba23[_0x2ffb59(0x120)],0x1),'is_sending':_0x303a94[_0x2ffb59(0x140)](_0x27ba23[_0x2ffb59(0x1a0)],0x1)});}const _0x38e322=process['env']['CLOUD_API_URL']+_0x2ffb59(0x15f);try{await axios[_0x2ffb59(0x1b4)](_0x38e322,{'sensorId':_0x349cc6,'subsiteId':_0x51ca4e},{'headers':{'Authorization':_0x2ffb59(0x170)+_0x1f5dfe}}),db['run'](_0x2ffb59(0x12d)+_0x1b0c50+_0x2ffb59(0x15b),[_0x349cc6],_0x186292=>{const _0x1e793f=_0x2ffb59;if(_0x186292)return console[_0x1e793f(0x175)](_0x265063[_0x1e793f(0x11f)],_0x186292[_0x1e793f(0x14e)]),_0x53bea7[_0x1e793f(0x11a)](0x1f4)[_0x1e793f(0x123)]({'message':_0x1e793f(0x122)});return console['log'](_0x1e793f(0x16f)+_0x349cc6+_0x1e793f(0x1a5)+_0x51ca4e),_0x53bea7['status'](0xc8)[_0x1e793f(0x123)]({'message':_0x265063[_0x1e793f(0x18d)]});});}catch(_0x27c8a9){return console['error'](_0x303a94['ckRmE'],_0x27c8a9[_0x2ffb59(0x128)]?.[_0x2ffb59(0x16c)]||_0x27c8a9['message']),_0x53bea7[_0x2ffb59(0x11a)](0x1f4)['json']({'message':_0x303a94[_0x2ffb59(0x12b)],'error':_0x27c8a9[_0x2ffb59(0x128)]?.['data']||_0x27c8a9[_0x2ffb59(0x14e)]});}});});}catch(_0x359c79){console[_0x2d8dc4(0x175)](_0x303a94[_0x2d8dc4(0x1a6)],_0x359c79[_0x2d8dc4(0x14e)]),_0x53bea7[_0x2d8dc4(0x11a)](0x1f4)[_0x2d8dc4(0x123)]({'message':_0x303a94[_0x2d8dc4(0x1bc)],'error':_0x359c79[_0x2d8dc4(0x14e)]});}},removeSubSiteSensor=async(_0x311eba,_0x5116fa)=>{const _0x400adf=a0_0x57facf,_0xe305c5={'UgyQt':_0x400adf(0x149),'UGhQA':function(_0x3ab342,_0x15efab){return _0x3ab342||_0x15efab;},'eHOCL':_0x400adf(0x1b8),'ATPdr':_0x400adf(0x158),'MAqKa':_0x400adf(0x187)};try{const {sensorId:_0x40ecb5,subsiteId:_0x3d1e1a}=_0x311eba['body'];if(_0xe305c5['UGhQA'](!_0x40ecb5,!_0x3d1e1a))return _0x5116fa[_0x400adf(0x11a)](0x190)[_0x400adf(0x123)]({'message':_0xe305c5[_0x400adf(0x1bb)]});const {token:_0x2b2bce,companyId:_0x591115}=await getAdminDetailsFromToken(),_0x36b373=process[_0x400adf(0x155)]['CLOUD_API_URL']+'/api/subsite/sensor/activation/remove';await axios[_0x400adf(0x1b4)](_0x36b373,{'sensorId':_0x40ecb5,'subsiteId':_0x3d1e1a},{'headers':{'Authorization':_0x400adf(0x170)+_0x2b2bce}});const _0x22253e=_0x400adf(0x17f)+_0x591115+'_'+_0x3d1e1a,_0x5c3271='SensorData_'+_0x591115+'_'+_0x3d1e1a+'_'+_0x40ecb5;db['run']('DELETE\x20FROM\x20'+_0x22253e+_0x400adf(0x192),[_0x40ecb5],_0xb9c518=>{const _0x5691b7=_0x400adf,_0x2f77b4={'MJbFx':_0xe305c5[_0x5691b7(0x180)]};if(_0xb9c518)console['error'](_0x5691b7(0x11d)+_0x22253e+':',_0xb9c518[_0x5691b7(0x14e)]);else db[_0x5691b7(0x13e)](_0x5691b7(0x167)+_0x5c3271,async _0x4ddbd1=>{const _0x2c6565=_0x5691b7;if(_0x4ddbd1)console[_0x2c6565(0x175)](_0x2c6565(0x146)+_0x5c3271+':',_0x4ddbd1['message']);else _0x5116fa[_0x2c6565(0x11a)](0xc8)[_0x2c6565(0x123)]({'message':_0x2f77b4[_0x2c6565(0x195)]});});});}catch(_0x363dd7){console[_0x400adf(0x175)](_0xe305c5[_0x400adf(0x189)],_0x363dd7[_0x400adf(0x14e)]),_0x5116fa['status'](0x1f4)[_0x400adf(0x123)]({'message':_0xe305c5[_0x400adf(0x1bd)],'error':_0x363dd7[_0x400adf(0x14e)]});}},getAllActiveSubSiteSensors=async(_0x334686,_0x28fb06)=>{const _0x3fd84b=a0_0x57facf,_0x44780d={'PjDLh':'❌\x20Local\x20DB\x20error:','OhMGK':_0x3fd84b(0x188),'lVSqr':function(_0x5f4a4c,_0x379d65){return _0x5f4a4c(_0x379d65);},'msStk':_0x3fd84b(0x198),'AKMTd':_0x3fd84b(0x151),'aCZZs':_0x3fd84b(0x169),'xibDs':_0x3fd84b(0x15e)};try{const _0x105e76=_0x334686[_0x3fd84b(0x14b)][_0x3fd84b(0x182)]||_0x334686[_0x3fd84b(0x14b)][_0x3fd84b(0x1b3)]||_0x334686['query'][_0x3fd84b(0x13f)];if(!_0x105e76)return _0x28fb06[_0x3fd84b(0x11a)](0x190)[_0x3fd84b(0x123)]({'message':_0x3fd84b(0x19b)});const _0x5c39ce=getAdminDetailsFromToken(_0x334686);if(!_0x5c39ce)return _0x28fb06[_0x3fd84b(0x11a)](0x191)[_0x3fd84b(0x123)]({'message':_0x44780d[_0x3fd84b(0x144)]});const {companyId:_0xfcc0e9}=_0x5c39ce,_0x1786c3=_0x334686[_0x3fd84b(0x1ad)][_0x3fd84b(0x137)],_0x2a9170=process[_0x3fd84b(0x155)][_0x3fd84b(0x185)]+'/api/subsite/sensor/activation/active?subsite_id='+_0x105e76,_0x4d6290=await axios[_0x3fd84b(0x17c)](_0x2a9170,{'headers':{'Authorization':_0x1786c3}}),_0x5bf32b=_0x4d6290['data']?.[_0x3fd84b(0x1b6)]||[],_0x5958ff='Sensor_'+_0xfcc0e9+'_'+_0x105e76,_0x5792ab=_0x3fd84b(0x147)+_0xfcc0e9+'_'+_0x105e76,_0x4f38d8=await new Promise((_0x4af93a,_0x51d6fe)=>{const _0x2a9c56=_0x3fd84b;db[_0x2a9c56(0x17a)]('SELECT\x20s.bank_id,\x20s.interval_seconds,\x20s.batch_size,\x20a.api_endpoint\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20'+_0x5958ff+'\x20s\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20'+_0x5792ab+'\x20a\x20ON\x20s.bank_id\x20=\x20a.sensor_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20s.is_active\x20=\x201',[],(_0x18a4ca,_0x10af5c)=>{const _0x257031=_0x2a9c56;if(_0x18a4ca)return console[_0x257031(0x175)](_0x44780d[_0x257031(0x17b)],_0x18a4ca[_0x257031(0x14e)]),_0x51d6fe(_0x44780d[_0x257031(0x165)]);_0x44780d['lVSqr'](_0x4af93a,_0x10af5c);});}),_0x3d38a9=_0x5bf32b[_0x3fd84b(0x136)](_0x27043f=>{const _0x541a73=_0x3fd84b,_0x4acf0d=_0x4f38d8[_0x541a73(0x14c)](_0x36f0b8=>Number(_0x36f0b8['bank_id'])===Number(_0x27043f[_0x541a73(0x11e)]));return{..._0x27043f,'interval_seconds':_0x4acf0d?.['interval_seconds']||0xa,'batch_size':_0x4acf0d?.[_0x541a73(0x13d)]||0x1,'api_endpoint':_0x4acf0d?.[_0x541a73(0x197)]||_0x44780d['msStk']};});_0x28fb06[_0x3fd84b(0x11a)](0xc8)['json']({'message':_0x44780d[_0x3fd84b(0x16a)],'sensors':_0x3d38a9});}catch(_0x3253ab){console['error'](_0x3fd84b(0x190),_0x3253ab),_0x28fb06[_0x3fd84b(0x11a)](0x1f4)[_0x3fd84b(0x123)]({'message':_0x44780d[_0x3fd84b(0x13b)],'error':_0x3253ab[_0x3fd84b(0x14e)]});}},reactivateSubSiteSensor=async(_0xd039d0,_0x1856c7)=>{const _0x2268b7=a0_0x57facf,_0x3ecfa3={'ZOJay':function(_0x1b7289,_0x59021c){return _0x1b7289||_0x59021c;},'pXLve':_0x2268b7(0x179),'sAeyG':function(_0x1dd962){return _0x1dd962();},'utbGv':function(_0x275f0f){return _0x275f0f();},'vSgNM':_0x2268b7(0x124),'XOtlC':_0x2268b7(0x19c),'YzXhx':_0x2268b7(0x12e)};try{const {sensorId:_0x878e99,subsiteId:_0xa07961}=_0xd039d0[_0x2268b7(0x12f)];if(_0x3ecfa3[_0x2268b7(0x1ba)](!_0x878e99,!_0xa07961))return _0x1856c7[_0x2268b7(0x11a)](0x190)['json']({'message':_0x3ecfa3[_0x2268b7(0x12c)]});const _0x5d6cc1=await _0x3ecfa3[_0x2268b7(0x18c)](getStoredToken),_0x9f60f7=await _0x3ecfa3[_0x2268b7(0x12a)](getAdminDetailsFromToken),_0x11cb8b=process['env'][_0x2268b7(0x185)]+_0x2268b7(0x145),_0x6d71d4=await axios[_0x2268b7(0x1b4)](_0x11cb8b,{'sensorId':_0x878e99,'subsiteId':_0xa07961},{'headers':{'Authorization':_0x2268b7(0x170)+_0x5d6cc1}});console['log'](_0x3ecfa3[_0x2268b7(0x16d)],_0x6d71d4[_0x2268b7(0x16c)]);const _0x581691=_0x2268b7(0x17f)+_0x9f60f7+'_'+_0xa07961;db[_0x2268b7(0x13e)](_0x2268b7(0x12d)+_0x581691+_0x2268b7(0x19d),[_0x878e99],_0x29353d=>{const _0xadc93d=_0x2268b7;_0x29353d?console[_0xadc93d(0x175)](_0xadc93d(0x126),_0x29353d[_0xadc93d(0x14e)]):console[_0xadc93d(0x130)](_0xadc93d(0x142)+_0x878e99+'\x20reactivated\x20locally.');}),_0x1856c7['status'](0xc8)['json']({'message':_0x3ecfa3[_0x2268b7(0x119)],'cloudResponse':_0x6d71d4['data']});}catch(_0x4ede95){console['error']('❌\x20Failed\x20to\x20reactivate\x20sub-site\x20sensor:',_0x4ede95['response']?.['data']||_0x4ede95[_0x2268b7(0x14e)]),_0x1856c7[_0x2268b7(0x11a)](0x1f4)[_0x2268b7(0x123)]({'message':_0x3ecfa3[_0x2268b7(0x129)],'error':_0x4ede95[_0x2268b7(0x14e)]});}},updateSubSiteSensorSettings=async(_0x140452,_0xbe5e03)=>{const _0x2c51ef=a0_0x57facf,_0x3b4690={'WRfke':_0x2c51ef(0x14a),'nQlhb':'Update\x20failed','ILXiJ':function(_0x15e733,_0xeefebe){return _0x15e733===_0xeefebe;},'fBfGJ':_0x2c51ef(0x16e),'Qtnol':function(_0x1e7e84,_0x4cc0bd){return _0x1e7e84||_0x4cc0bd;},'wzQkQ':function(_0x14755a,_0x2f740){return _0x14755a==_0x2f740;},'bLmtM':function(_0x5e1e58,_0x3a418f){return _0x5e1e58==_0x3a418f;},'PjtlN':_0x2c51ef(0x14f),'BXbAW':function(_0x2b329c){return _0x2b329c();},'tgjnR':_0x2c51ef(0x1a7),'wiZTR':_0x2c51ef(0x15e)};try{const {sensorId:_0x630411,subsiteId:_0x57c3a4,interval_seconds:_0x3765bd,batch_size:_0x4885ba}=_0x140452[_0x2c51ef(0x12f)];if(_0x3b4690[_0x2c51ef(0x163)](!_0x630411,!_0x57c3a4)||_0x3b4690[_0x2c51ef(0x18e)](_0x3765bd,null)||_0x3b4690['bLmtM'](_0x4885ba,null))return _0xbe5e03['status'](0x190)[_0x2c51ef(0x123)]({'message':_0x3b4690[_0x2c51ef(0x11c)]});const {companyId:_0x1e894e}=await _0x3b4690[_0x2c51ef(0x193)](getAdminDetailsFromToken),_0xfde3bd=_0x2c51ef(0x17f)+_0x1e894e+'_'+_0x57c3a4;db['run'](_0x2c51ef(0x12d)+_0xfde3bd+'\x0a\x20\x20\x20\x20\x20\x20\x20SET\x20interval_seconds\x20=\x20?,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20batch_size\x20=\x20?,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20=\x20CURRENT_TIMESTAMP\x20\x0a\x20\x20\x20\x20\x20\x20\x20WHERE\x20bank_id\x20=\x20?\x20AND\x20is_active\x20=\x200',[_0x3765bd,_0x4885ba,_0x630411],function(_0x1706b8){const _0x40ab0a=_0x2c51ef;if(_0x1706b8)return console['error'](_0x3b4690[_0x40ab0a(0x143)],_0x1706b8[_0x40ab0a(0x14e)]),_0xbe5e03[_0x40ab0a(0x11a)](0x1f4)[_0x40ab0a(0x123)]({'message':_0x3b4690[_0x40ab0a(0x11b)],'error':_0x1706b8[_0x40ab0a(0x14e)]});if(_0x3b4690[_0x40ab0a(0x131)](this[_0x40ab0a(0x133)],0x0))return _0xbe5e03[_0x40ab0a(0x11a)](0x190)['json']({'message':_0x3b4690[_0x40ab0a(0x152)]});console[_0x40ab0a(0x130)]('✅\x20Sensor\x20'+_0x630411+_0x40ab0a(0x159)),_0xbe5e03[_0x40ab0a(0x11a)](0xc8)['json']({'message':_0x40ab0a(0x1ac)+_0x630411+_0x40ab0a(0x168)});});}catch(_0x4af397){console[_0x2c51ef(0x175)](_0x3b4690[_0x2c51ef(0x18f)],_0x4af397[_0x2c51ef(0x14e)]),_0xbe5e03[_0x2c51ef(0x11a)](0x1f4)[_0x2c51ef(0x123)]({'message':_0x3b4690['wiZTR'],'error':_0x4af397[_0x2c51ef(0x14e)]});}};module[a0_0x57facf(0x1a2)]={'activateSubSiteSensor':activateSubSiteSensor,'deactivateSubSiteSensor':deactivateSubSiteSensor,'removeSubSiteSensor':removeSubSiteSensor,'getAllActiveSubSiteSensors':getAllActiveSubSiteSensors,'reactivateSubSiteSensor':reactivateSubSiteSensor,'updateSubSiteSensorSettings':updateSubSiteSensorSettings};