const a0_0xbf726b=a0_0x17cf;(function(_0x67d526,_0x33093c){const _0xfce383=a0_0x17cf,_0x4c86d2=_0x67d526();while(!![]){try{const _0x48e3e3=-parseInt(_0xfce383(0x1dc))/0x1+parseInt(_0xfce383(0x209))/0x2+parseInt(_0xfce383(0x205))/0x3+parseInt(_0xfce383(0x231))/0x4*(parseInt(_0xfce383(0x1d5))/0x5)+parseInt(_0xfce383(0x1b6))/0x6*(parseInt(_0xfce383(0x234))/0x7)+parseInt(_0xfce383(0x22a))/0x8*(parseInt(_0xfce383(0x1e4))/0x9)+parseInt(_0xfce383(0x212))/0xa*(-parseInt(_0xfce383(0x1c4))/0xb);if(_0x48e3e3===_0x33093c)break;else _0x4c86d2['push'](_0x4c86d2['shift']());}catch(_0x286941){_0x4c86d2['push'](_0x4c86d2['shift']());}}}(a0_0x4ace,0x4674b));const axios=require(a0_0xbf726b(0x1c5)),jwt=require('jsonwebtoken'),{db,createSensorDataTable}=require(a0_0xbf726b(0x1e6));function a0_0x4ace(){const _0x498693=['✅\x20Sensor\x20','all','\x20WHERE\x20bank_id\x20=\x20?','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20(id,\x20bank_id,\x20mode,\x20interval_seconds,\x20batch_size,\x20is_active,\x20created_at,\x20updated_at)\x0a\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20\x27manual\x27,\x20?,\x20?,\x201,\x20datetime(\x27now\x27),\x20datetime(\x27now\x27))\x0a\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(id)\x20DO\x20UPDATE\x20SET\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20is_active\x20=\x201,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20interval_seconds\x20=\x20excluded.interval_seconds,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20batch_size\x20=\x20excluded.batch_size','env','❌\x20Cloud\x20deactivation\x20failed:','iHMCI','⚠️\x20No\x20IntervalControl\x20entry\x20found.\x20Proceeding\x20with\x20caution.','eeFjh','Local\x20DB\x20insert\x20failed','All\x20fields\x20are\x20required','❌\x20Sensor\x20lookup\x20failed:','Removal\x20failed','xYWoE','8gfatuv','DROP\x20TABLE\x20IF\x20EXISTS\x20','❌\x20Error\x20updating\x20local\x20sub-site\x20DB:','interval_seconds','SELECT\x20id\x20FROM\x20','GKsdT','rbgSs','8wkOwWF','jmsYU','✅\x20Sub-site\x20Sensor\x20','1624MQRcuU','Sensor\x20ID\x20and\x20Subsite\x20ID\x20required','GXdxK','PAzBt','batch_size','RcEct','warn','tPcmE','GjUpi','query','fPZdj','JWT_SECRET_APP','Failed\x20to\x20reactivate\x20sensor','get','vkhJC','DHgzI','❌\x20IntervalControl\x20check\x20failed:','body','bkxHQ','CNUpK','yXsTN','eJMgB','JXjnY','❌\x20Sensor\x20is\x20actively\x20fetching\x20or\x20sending.\x20Please\x20stop\x20it\x20first\x20before\x20deactivating.','6852RTyeWn','companyId','IvMvR','Sensor\x20ID\x20and\x20sub-site\x20ID\x20are\x20required','RRooh','status','❌\x20Error\x20deactivating\x20subsite\x20sensor:','Sub-site\x20ID\x20is\x20required','✅\x20Sub-site\x20sensor\x20reactivated\x20in\x20Cloud:','UPDATE\x20','NtTQb','map','FbcSs','Sensor\x20removed\x20and\x20table\x20dropped','121wtNtcN','axios','❌\x20Error\x20updating\x20sub-site\x20sensor\x20settings:','SELECT\x20token\x20FROM\x20AuthTokens\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x201','MIcoc','JnfPE','find','data','\x20reactivated\x20locally.','\x20SET\x20is_active\x20=\x200\x20WHERE\x20bank_id\x20=\x20?','dotenv','lkSqh','❌\x20Error\x20activating\x20sub-site\x20sensor:','IntervalControl_','❌\x20Error\x20updating\x20sensor\x20settings:','Internal\x20Server\x20Error','CLOUD_API_URL','177695MDjGbe','❌\x20DB\x20update\x20failed:','GmTOe','❌\x20Failed\x20to\x20reactivate\x20sub-site\x20sensor:','LFyEv','Failed\x20to\x20fetch\x20local\x20sub-site\x20sensors','Sensor\x20reactivated\x20successfully','261495tStwYB','eeAkd','ahzVM','DELETE\x20FROM\x20','SsOMF','Sensor\x20','INSERT\x20INTO\x20','/api/subsite/sensor/activation/reactivate','5152257fERvyx','Table\x20creation\x20failed','../db/sensorDB','vmziI','nNQGQ','Sensor\x20must\x20be\x20deactivated\x20to\x20update\x20settings','wDoCj','Failed\x20to\x20deactivate\x20sensor\x20in\x20Cloud','HodXz','\x20settings\x20updated','❌\x20Failed\x20to\x20drop\x20table\x20','gznCG','response','Sensor\x20activated\x20successfully','kBcAu','log','UYBSr','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20sensor_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20quality\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20quality_good\x20BOOLEAN,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20timestamp\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY(sensor_id)\x20REFERENCES\x20SensorBank_','Sensor\x20not\x20found\x20in\x20local\x20DB','lZCNZ','SensorData_','Tivzq','Bearer\x20','Update\x20failed','Activation\x20failed','bank_id','pjAzg','/api/subsite/sensor/activation/remove','is_fetching','error','json','oGiyn','wqWZV','363717GIbCQb','ZxDcp','Local\x20deactivation\x20failed','\x20deactivated\x20in\x20sub-site\x20','1103130tvfROz','LaWcG','TOEkT','run','post','\x20WHERE\x20sensor_id\x20=\x20?','message','❌\x20DB\x20Insert\x20failed:','Uccbg','937470sNXCrH','\x0a\x20\x20\x20\x20\x20\x20\x20SET\x20interval_seconds\x20=\x20?,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20batch_size\x20=\x20?,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20=\x20CURRENT_TIMESTAMP\x20\x0a\x20\x20\x20\x20\x20\x20\x20WHERE\x20bank_id\x20=\x20?\x20AND\x20is_active\x20=\x200','sensors','/api/subsite/sensor/activation/activate','changes','(id)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','Sensor_','aVLQd','gVADV'];a0_0x4ace=function(){return _0x498693;};return a0_0x4ace();}require(a0_0xbf726b(0x1ce))['config']();const getStoredToken=()=>{const _0x2ce151=a0_0xbf726b,_0x32b7d9={'lZCNZ':function(_0x446483,_0x3638d1){return _0x446483||_0x3638d1;},'TOEkT':function(_0x13b65e,_0x192f05){return _0x13b65e(_0x192f05);},'LaWcG':'No\x20token\x20found','RRooh':_0x2ce151(0x1c7)};return new Promise((_0x145d83,_0x11d594)=>{const _0x361a7f=_0x2ce151,_0x60f811={'nNQGQ':function(_0x2d5a0f,_0x488c70){const _0x545c22=a0_0x17cf;return _0x32b7d9[_0x545c22(0x1f7)](_0x2d5a0f,_0x488c70);},'tCJXP':function(_0x164b48,_0x41bc74){const _0x80e2b6=a0_0x17cf;return _0x32b7d9[_0x80e2b6(0x20b)](_0x164b48,_0x41bc74);},'RcEct':_0x32b7d9[_0x361a7f(0x20a)]};db[_0x361a7f(0x1ab)](_0x32b7d9[_0x361a7f(0x1ba)],[],(_0x14830b,_0x3b27d6)=>{const _0x582451=_0x361a7f;if(_0x60f811[_0x582451(0x1e8)](_0x14830b,!_0x3b27d6))return _0x60f811['tCJXP'](_0x11d594,_0x60f811[_0x582451(0x1a3)]);_0x60f811['tCJXP'](_0x145d83,_0x3b27d6['token']);});});},getAdminDetailsFromToken=async()=>{const _0x23ccd5=a0_0xbf726b,_0x3b318b={'oGiyn':function(_0x4c0f1f){return _0x4c0f1f();}},_0x2aef36=await _0x3b318b[_0x23ccd5(0x203)](getStoredToken),_0x4c7f53=jwt['verify'](_0x2aef36,process[_0x23ccd5(0x220)][_0x23ccd5(0x1a9)]);return{'token':_0x2aef36,'companyId':_0x4c7f53[_0x23ccd5(0x1b7)]};},activateSubSiteSensor=async(_0x324f5d,_0x3282e7)=>{const _0x5b9ccc=a0_0xbf726b,_0x113dba={'SsOMF':_0x5b9ccc(0x1e5),'pjAzg':_0x5b9ccc(0x1f1),'ahzVM':_0x5b9ccc(0x225),'ZxDcp':function(_0x1bca13,_0x49abbe){return _0x1bca13||_0x49abbe;},'jmsYU':_0x5b9ccc(0x19f),'wqWZV':function(_0x559f00){return _0x559f00();},'BhbOs':function(_0x4557a4,_0x2775cd){return _0x4557a4??_0x2775cd;},'CEYSL':_0x5b9ccc(0x1fc)};try{const {sensorId:_0x65a653,subsiteId:_0x2fbe00,interval_seconds:_0x5c6d8d,batch_size:_0x35265d}=_0x324f5d[_0x5b9ccc(0x1af)];if(_0x113dba[_0x5b9ccc(0x206)](!_0x65a653,!_0x2fbe00))return _0x3282e7[_0x5b9ccc(0x1bb)](0x190)[_0x5b9ccc(0x202)]({'message':_0x113dba[_0x5b9ccc(0x232)]});const {token:_0x42816f,companyId:_0x447338}=await _0x113dba[_0x5b9ccc(0x204)](getAdminDetailsFromToken),_0x28a000=_0x113dba['BhbOs'](_0x5c6d8d,0xa),_0x12c209=_0x35265d??0x5,_0x4657bc=process[_0x5b9ccc(0x220)][_0x5b9ccc(0x1d4)]+_0x5b9ccc(0x215);await axios['post'](_0x4657bc,{'sensorId':_0x65a653,'subsiteId':_0x2fbe00,'companyId':_0x447338},{'headers':{'Authorization':_0x5b9ccc(0x1fa)+_0x42816f}});const _0x1be4dc=_0x5b9ccc(0x218)+_0x447338+'_'+_0x2fbe00,_0x5137b1=_0x5b9ccc(0x1f8)+_0x447338+'_'+_0x2fbe00+'_'+_0x65a653;db[_0x5b9ccc(0x20c)](_0x5b9ccc(0x1e2)+_0x1be4dc+_0x5b9ccc(0x21f),[_0x65a653,_0x65a653,_0x28a000,_0x12c209],_0x49b83b=>{const _0x4eab1b=_0x5b9ccc;if(_0x49b83b)return console[_0x4eab1b(0x201)](_0x4eab1b(0x210),_0x49b83b[_0x4eab1b(0x20f)]),_0x3282e7[_0x4eab1b(0x1bb)](0x1f4)['json']({'message':_0x113dba[_0x4eab1b(0x1de)]});db['run'](_0x4eab1b(0x21e)+_0x5137b1+_0x4eab1b(0x1f5)+_0x447338+'_'+_0x2fbe00+_0x4eab1b(0x217),_0x4baffc=>{const _0xa0356e=_0x4eab1b;if(_0x4baffc)return console['error']('❌\x20Failed\x20to\x20create\x20SensorData\x20table\x20'+_0x5137b1+':',_0x4baffc[_0xa0356e(0x20f)]),_0x3282e7[_0xa0356e(0x1bb)](0x1f4)['json']({'message':_0x113dba[_0xa0356e(0x1e0)]});_0x3282e7['status'](0xc8)['json']({'message':_0x113dba[_0xa0356e(0x1fe)]});});});}catch(_0x4cb914){console[_0x5b9ccc(0x201)](_0x5b9ccc(0x1d0),_0x4cb914[_0x5b9ccc(0x20f)]),_0x3282e7[_0x5b9ccc(0x1bb)](0x1f4)[_0x5b9ccc(0x202)]({'message':_0x113dba['CEYSL'],'error':_0x4cb914[_0x5b9ccc(0x20f)]});}},deactivateSubSiteSensor=async(_0x3d81b5,_0x5996d1)=>{const _0x598344=a0_0xbf726b,_0x5cf958={'YNzHG':'Sensor\x20deactivated\x20successfully','bkxHQ':_0x598344(0x1ae),'IvMvR':function(_0x349a6d,_0x345e27){return _0x349a6d===_0x345e27;},'czBBy':_0x598344(0x221),'GmTOe':_0x598344(0x1eb),'cnzQF':function(_0xdb0dff,_0x2f0663){return _0xdb0dff||_0x2f0663;},'UYBSr':_0x598344(0x227),'DHgzI':function(_0x37a597,_0x26ffef){return _0x37a597||_0x26ffef;},'wDoCj':'Sensor\x20ID\x20and\x20Subsite\x20ID\x20required','eJMgB':function(_0x69f0c8,_0x2e607f){return _0x69f0c8(_0x2e607f);},'CNUpK':_0x598344(0x1bc)};try{const {sensorId:_0x2d469c,subsiteId:_0x5ba1ab}=_0x3d81b5['body'];if(_0x5cf958[_0x598344(0x1ad)](!_0x2d469c,!_0x5ba1ab))return _0x5996d1[_0x598344(0x1bb)](0x190)[_0x598344(0x202)]({'message':_0x5cf958[_0x598344(0x1ea)]});const {token:_0x57b744,companyId:_0x4eed3e}=await _0x5cf958[_0x598344(0x1b3)](getAdminDetailsFromToken,_0x3d81b5),_0x571768=_0x598344(0x1d1)+_0x4eed3e+'_'+_0x5ba1ab,_0x5a5d0c=_0x598344(0x218)+_0x4eed3e+'_'+_0x5ba1ab;db['get'](_0x598344(0x22e)+_0x5a5d0c+_0x598344(0x21d),[_0x2d469c],(_0x4b50fc,_0x2aa51f)=>{const _0xa8b56f=_0x598344,_0x6a3460={'PAzBt':_0x5cf958['YNzHG'],'Uccbg':_0x5cf958[_0xa8b56f(0x1b0)],'GjUpi':'Database\x20error\x20while\x20checking\x20IntervalControl','qfanF':_0xa8b56f(0x223),'kBcAu':function(_0x34faa7,_0x2c8230){const _0x5b8951=_0xa8b56f;return _0x5cf958[_0x5b8951(0x1b8)](_0x34faa7,_0x2c8230);},'JXjnY':_0x5cf958['czBBy'],'FQgtj':_0x5cf958[_0xa8b56f(0x1d7)]};if(_0x5cf958['cnzQF'](_0x4b50fc,!_0x2aa51f))return console[_0xa8b56f(0x201)](_0x5cf958[_0xa8b56f(0x1f4)],_0x4b50fc?.[_0xa8b56f(0x20f)]),_0x5996d1['status'](0x194)['json']({'message':_0xa8b56f(0x1f6)});const _0x4e8549=_0x2aa51f['id'];db[_0xa8b56f(0x1ab)]('SELECT\x20is_fetching,\x20is_sending\x20FROM\x20'+_0x571768+_0xa8b56f(0x20e),[_0x4e8549],async(_0x381233,_0x12155c)=>{const _0x41bbc2=_0xa8b56f,_0x5c85b9={'FbcSs':_0x6a3460[_0x41bbc2(0x1a1)]};if(_0x381233)return console[_0x41bbc2(0x201)](_0x6a3460[_0x41bbc2(0x211)],_0x381233[_0x41bbc2(0x20f)]),_0x5996d1[_0x41bbc2(0x1bb)](0x1f4)['json']({'message':_0x6a3460[_0x41bbc2(0x1a6)]});if(!_0x12155c)console[_0x41bbc2(0x1a4)](_0x6a3460['qfanF']);else{if(_0x12155c[_0x41bbc2(0x200)]===0x1||_0x6a3460[_0x41bbc2(0x1f2)](_0x12155c['is_sending'],0x1))return _0x5996d1[_0x41bbc2(0x1bb)](0x193)[_0x41bbc2(0x202)]({'message':_0x41bbc2(0x1b5),'is_fetching':_0x6a3460[_0x41bbc2(0x1f2)](_0x12155c['is_fetching'],0x1),'is_sending':_0x12155c['is_sending']===0x1});}const _0x48bbf0=process['env'][_0x41bbc2(0x1d4)]+'/api/subsite/sensor/activation/deactivate';try{await axios[_0x41bbc2(0x20d)](_0x48bbf0,{'sensorId':_0x2d469c,'subsiteId':_0x5ba1ab},{'headers':{'Authorization':_0x41bbc2(0x1fa)+_0x57b744}}),db[_0x41bbc2(0x20c)](_0x41bbc2(0x1bf)+_0x5a5d0c+_0x41bbc2(0x1cd),[_0x2d469c],_0x3ab3a5=>{const _0x1b7d8a=_0x41bbc2;if(_0x3ab3a5)return console[_0x1b7d8a(0x201)](_0x1b7d8a(0x1d6),_0x3ab3a5[_0x1b7d8a(0x20f)]),_0x5996d1[_0x1b7d8a(0x1bb)](0x1f4)[_0x1b7d8a(0x202)]({'message':_0x1b7d8a(0x207)});return console['log']('✅\x20Sensor\x20'+_0x2d469c+_0x1b7d8a(0x208)+_0x5ba1ab),_0x5996d1[_0x1b7d8a(0x1bb)](0xc8)[_0x1b7d8a(0x202)]({'message':_0x5c85b9[_0x1b7d8a(0x1c2)]});});}catch(_0x7c6aa9){return console[_0x41bbc2(0x201)](_0x6a3460[_0x41bbc2(0x1b4)],_0x7c6aa9[_0x41bbc2(0x1f0)]?.['data']||_0x7c6aa9['message']),_0x5996d1['status'](0x1f4)[_0x41bbc2(0x202)]({'message':_0x6a3460['FQgtj'],'error':_0x7c6aa9[_0x41bbc2(0x1f0)]?.['data']||_0x7c6aa9[_0x41bbc2(0x20f)]});}});});}catch(_0x599715){console[_0x598344(0x201)](_0x5cf958[_0x598344(0x1b1)],_0x599715[_0x598344(0x20f)]),_0x5996d1[_0x598344(0x1bb)](0x1f4)[_0x598344(0x202)]({'message':'Deactivation\x20failed','error':_0x599715[_0x598344(0x20f)]});}},removeSubSiteSensor=async(_0x5f5088,_0x31e3d7)=>{const _0x12ee09=a0_0xbf726b,_0x231a9d={'GXdxK':_0x12ee09(0x1c3),'vkhJC':function(_0x20c8ed,_0x2636e0){return _0x20c8ed||_0x2636e0;},'lkSqh':_0x12ee09(0x19f),'eeFjh':'❌\x20Error\x20removing\x20subsite\x20sensor:','Tivzq':_0x12ee09(0x228)};try{const {sensorId:_0xef4229,subsiteId:_0x1a79dd}=_0x5f5088[_0x12ee09(0x1af)];if(_0x231a9d[_0x12ee09(0x1ac)](!_0xef4229,!_0x1a79dd))return _0x31e3d7[_0x12ee09(0x1bb)](0x190)[_0x12ee09(0x202)]({'message':_0x231a9d[_0x12ee09(0x1cf)]});const {token:_0x53db86,companyId:_0x38a92a}=await getAdminDetailsFromToken(),_0x3ebcd4=process[_0x12ee09(0x220)][_0x12ee09(0x1d4)]+_0x12ee09(0x1ff);await axios[_0x12ee09(0x20d)](_0x3ebcd4,{'sensorId':_0xef4229,'subsiteId':_0x1a79dd},{'headers':{'Authorization':'Bearer\x20'+_0x53db86}});const _0x5ea8de=_0x12ee09(0x218)+_0x38a92a+'_'+_0x1a79dd,_0x32d9bc='SensorData_'+_0x38a92a+'_'+_0x1a79dd+'_'+_0xef4229;db['run'](_0x12ee09(0x1df)+_0x5ea8de+_0x12ee09(0x21d),[_0xef4229],_0x3f2301=>{const _0x3198e2=_0x12ee09,_0x51f71d={'xYWoE':_0x231a9d[_0x3198e2(0x1a0)]};if(_0x3f2301)console[_0x3198e2(0x201)]('❌\x20Failed\x20to\x20delete\x20from\x20'+_0x5ea8de+':',_0x3f2301[_0x3198e2(0x20f)]);else db[_0x3198e2(0x20c)](_0x3198e2(0x22b)+_0x32d9bc,async _0x277a73=>{const _0xffbafe=_0x3198e2;if(_0x277a73)console[_0xffbafe(0x201)](_0xffbafe(0x1ee)+_0x32d9bc+':',_0x277a73['message']);else _0x31e3d7[_0xffbafe(0x1bb)](0xc8)['json']({'message':_0x51f71d[_0xffbafe(0x229)]});});});}catch(_0x1d7c30){console[_0x12ee09(0x201)](_0x231a9d[_0x12ee09(0x224)],_0x1d7c30[_0x12ee09(0x20f)]),_0x31e3d7['status'](0x1f4)[_0x12ee09(0x202)]({'message':_0x231a9d[_0x12ee09(0x1f9)],'error':_0x1d7c30['message']});}},getAllActiveSubSiteSensors=async(_0x51e3be,_0x44f3cc)=>{const _0x3021b0=a0_0xbf726b,_0x182f73={'eeAkd':function(_0x500850,_0x439060){return _0x500850(_0x439060);},'JnfPE':_0x3021b0(0x1da),'aVLQd':function(_0x18bbb7){return _0x18bbb7();},'HodXz':'Fetched\x20sub-site\x20active\x20sensors\x20with\x20local\x20settings','CycIW':'❌\x20Error\x20in\x20getAllActiveSubSiteSensors:','iHMCI':_0x3021b0(0x1d3)};try{const {subsiteId:_0x3614d8}=_0x51e3be[_0x3021b0(0x1a7)];if(!_0x3614d8)return _0x44f3cc[_0x3021b0(0x1bb)](0x190)[_0x3021b0(0x202)]({'message':_0x3021b0(0x1bd)});const _0x2c1873=await _0x182f73[_0x3021b0(0x219)](getStoredToken),_0x4f1fbf=await _0x182f73[_0x3021b0(0x219)](getAdminDetailsFromToken),_0x885d5=process[_0x3021b0(0x220)][_0x3021b0(0x1d4)]+'/api/subsite/sensor/activation/active?subsite_id='+_0x3614d8,_0x35cdff=await axios[_0x3021b0(0x1ab)](_0x885d5,{'headers':{'Authorization':'Bearer\x20'+_0x2c1873}}),_0xa24038=_0x35cdff['data']?.[_0x3021b0(0x214)]||[],_0x78644e='Sensor_'+_0x4f1fbf+'_'+_0x3614d8,_0x5a39de=await new Promise((_0x4e45b9,_0x391eb1)=>{const _0x128d80=_0x3021b0;db[_0x128d80(0x21c)]('SELECT\x20bank_id,\x20interval_seconds,\x20batch_size\x20FROM\x20'+_0x78644e+'\x20WHERE\x20is_active\x20=\x201',[],(_0x2081e4,_0x2440a5)=>{const _0x5e417a=_0x128d80;if(_0x2081e4)return console['error']('❌\x20Error\x20fetching\x20from\x20Local\x20DB:',_0x2081e4[_0x5e417a(0x20f)]),_0x182f73[_0x5e417a(0x1dd)](_0x391eb1,_0x182f73[_0x5e417a(0x1c9)]);_0x182f73[_0x5e417a(0x1dd)](_0x4e45b9,_0x2440a5);});}),_0x19613a=_0xa24038[_0x3021b0(0x1c1)](_0x54f77b=>{const _0x5b83f6=_0x3021b0,_0x4050e1=_0x5a39de[_0x5b83f6(0x1ca)](_0x2a3125=>Number(_0x2a3125[_0x5b83f6(0x1fd)])===Number(_0x54f77b['bank_id']));return{..._0x54f77b,'interval_seconds':_0x4050e1?.[_0x5b83f6(0x22d)]||0xa,'batch_size':_0x4050e1?.[_0x5b83f6(0x1a2)]||0x1};});_0x44f3cc['status'](0xc8)['json']({'message':_0x182f73[_0x3021b0(0x1ec)],'sensors':_0x19613a});}catch(_0x452ce7){console['error'](_0x182f73['CycIW'],_0x452ce7),_0x44f3cc[_0x3021b0(0x1bb)](0x1f4)[_0x3021b0(0x202)]({'message':_0x182f73[_0x3021b0(0x222)],'error':_0x452ce7[_0x3021b0(0x20f)]});}},reactivateSubSiteSensor=async(_0x5aab01,_0x20b867)=>{const _0x10b264=a0_0xbf726b,_0x580781={'MIcoc':_0x10b264(0x22c),'gVADV':function(_0x1574ad,_0x42e837){return _0x1574ad||_0x42e837;},'GKsdT':function(_0x4b8957){return _0x4b8957();},'fPZdj':_0x10b264(0x1be),'YhybA':_0x10b264(0x1db),'PUPQn':_0x10b264(0x1d8),'vmziI':_0x10b264(0x1aa)};try{const {sensorId:_0x31467e,subsiteId:_0x12c4fc}=_0x5aab01['body'];if(_0x580781[_0x10b264(0x21a)](!_0x31467e,!_0x12c4fc))return _0x20b867['status'](0x190)['json']({'message':_0x10b264(0x1b9)});const _0x36cf77=await _0x580781[_0x10b264(0x22f)](getStoredToken),_0x4efac2=await _0x580781[_0x10b264(0x22f)](getAdminDetailsFromToken),_0xcd5d3b=process[_0x10b264(0x220)]['CLOUD_API_URL']+_0x10b264(0x1e3),_0x1c758f=await axios[_0x10b264(0x20d)](_0xcd5d3b,{'sensorId':_0x31467e,'subsiteId':_0x12c4fc},{'headers':{'Authorization':_0x10b264(0x1fa)+_0x36cf77}});console[_0x10b264(0x1f3)](_0x580781[_0x10b264(0x1a8)],_0x1c758f[_0x10b264(0x1cb)]);const _0x5f51cf=_0x10b264(0x218)+_0x4efac2+'_'+_0x12c4fc;db[_0x10b264(0x20c)](_0x10b264(0x1bf)+_0x5f51cf+'\x20SET\x20is_active\x20=\x201\x20WHERE\x20bank_id\x20=\x20?',[_0x31467e],_0xf5e7e5=>{const _0x4c12ab=_0x10b264;_0xf5e7e5?console['error'](_0x580781[_0x4c12ab(0x1c8)],_0xf5e7e5[_0x4c12ab(0x20f)]):console[_0x4c12ab(0x1f3)](_0x4c12ab(0x233)+_0x31467e+_0x4c12ab(0x1cc));}),_0x20b867[_0x10b264(0x1bb)](0xc8)[_0x10b264(0x202)]({'message':_0x580781['YhybA'],'cloudResponse':_0x1c758f['data']});}catch(_0x4f155a){console[_0x10b264(0x201)](_0x580781['PUPQn'],_0x4f155a[_0x10b264(0x1f0)]?.[_0x10b264(0x1cb)]||_0x4f155a[_0x10b264(0x20f)]),_0x20b867[_0x10b264(0x1bb)](0x1f4)[_0x10b264(0x202)]({'message':_0x580781[_0x10b264(0x1e7)],'error':_0x4f155a[_0x10b264(0x20f)]});}},updateSubSiteSensorSettings=async(_0x36b267,_0x1dd0ce)=>{const _0x49c2e9=a0_0xbf726b,_0xbfa6aa={'NtTQb':_0x49c2e9(0x1d2),'rbgSs':_0x49c2e9(0x1fb),'WIWSN':function(_0x345ebb,_0x446632){return _0x345ebb===_0x446632;},'gznCG':_0x49c2e9(0x1e9),'qYpck':function(_0x366191,_0x480a9c){return _0x366191||_0x480a9c;},'tPcmE':function(_0xb86501,_0x1b709b){return _0xb86501==_0x1b709b;},'ATtbi':function(_0xcbe263,_0x1c5d56){return _0xcbe263==_0x1c5d56;},'fTxgV':_0x49c2e9(0x226),'MaVGF':function(_0x3cbc7e){return _0x3cbc7e();},'LFyEv':_0x49c2e9(0x1c6),'yXsTN':_0x49c2e9(0x1d3)};try{const {sensorId:_0x41b9ac,subsiteId:_0x274419,interval_seconds:_0x295db1,batch_size:_0x5cd315}=_0x36b267[_0x49c2e9(0x1af)];if(_0xbfa6aa['qYpck'](!_0x41b9ac,!_0x274419)||_0xbfa6aa[_0x49c2e9(0x1a5)](_0x295db1,null)||_0xbfa6aa['ATtbi'](_0x5cd315,null))return _0x1dd0ce[_0x49c2e9(0x1bb)](0x190)[_0x49c2e9(0x202)]({'message':_0xbfa6aa['fTxgV']});const {companyId:_0x4a7c28}=await _0xbfa6aa['MaVGF'](getAdminDetailsFromToken),_0x148c9f=_0x49c2e9(0x218)+_0x4a7c28+'_'+_0x274419;db[_0x49c2e9(0x20c)](_0x49c2e9(0x1bf)+_0x148c9f+_0x49c2e9(0x213),[_0x295db1,_0x5cd315,_0x41b9ac],function(_0x369440){const _0x4a3c52=_0x49c2e9;if(_0x369440)return console[_0x4a3c52(0x201)](_0xbfa6aa[_0x4a3c52(0x1c0)],_0x369440[_0x4a3c52(0x20f)]),_0x1dd0ce[_0x4a3c52(0x1bb)](0x1f4)[_0x4a3c52(0x202)]({'message':_0xbfa6aa[_0x4a3c52(0x230)],'error':_0x369440[_0x4a3c52(0x20f)]});if(_0xbfa6aa['WIWSN'](this[_0x4a3c52(0x216)],0x0))return _0x1dd0ce[_0x4a3c52(0x1bb)](0x190)[_0x4a3c52(0x202)]({'message':_0xbfa6aa[_0x4a3c52(0x1ef)]});console[_0x4a3c52(0x1f3)](_0x4a3c52(0x21b)+_0x41b9ac+_0x4a3c52(0x1ed)),_0x1dd0ce[_0x4a3c52(0x1bb)](0xc8)[_0x4a3c52(0x202)]({'message':_0x4a3c52(0x1e1)+_0x41b9ac+'\x20settings\x20updated\x20successfully'});});}catch(_0x1f7d38){console[_0x49c2e9(0x201)](_0xbfa6aa[_0x49c2e9(0x1d9)],_0x1f7d38['message']),_0x1dd0ce['status'](0x1f4)[_0x49c2e9(0x202)]({'message':_0xbfa6aa[_0x49c2e9(0x1b2)],'error':_0x1f7d38[_0x49c2e9(0x20f)]});}};function a0_0x17cf(_0x52ee8c,_0x42441a){const _0x4acef=a0_0x4ace();return a0_0x17cf=function(_0x17cf33,_0x90fb9f){_0x17cf33=_0x17cf33-0x19f;let _0x44167a=_0x4acef[_0x17cf33];return _0x44167a;},a0_0x17cf(_0x52ee8c,_0x42441a);}module['exports']={'activateSubSiteSensor':activateSubSiteSensor,'deactivateSubSiteSensor':deactivateSubSiteSensor,'removeSubSiteSensor':removeSubSiteSensor,'getAllActiveSubSiteSensors':getAllActiveSubSiteSensors,'reactivateSubSiteSensor':reactivateSubSiteSensor,'updateSubSiteSensorSettings':updateSubSiteSensorSettings};