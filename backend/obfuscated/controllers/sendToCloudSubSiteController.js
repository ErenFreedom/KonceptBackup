function a0_0x1541(){const _0x2fbf50=['3073420HCrtsv','iKtns','lUyFC','cGPtA','üöÄ\x20Started\x20cloud\x20send\x20for\x20sub-site\x20sensor\x20every\x20','/api/subsite/sensor-data/receive-data','CASMr','is_sending','SELECT\x20*\x20FROM\x20','\x20not\x20found\x20or\x20inactive\x20in\x20sub-site','body','oYnyl','Hjxwy','5836850xkleKA','EwwCQ','10893099aMxEtc','‚è≥\x20Waiting\x20for\x20batch.\x20Needed:\x20','run','companyId','laGAA','stringify','frbws','CLOUD_API_URL','SensorData_','‚ùå\x20Stop\x20failed:\x20','yltoE','‚ùå\x20Sensor\x20','üõë\x20Jobs\x20stopped\x20for\x20sub-site\x20sensor.','Sensor\x20not\x20found\x20in\x20sub-site','../db/sensorDB','exports','LPaSs','YtkHa','axios','../utils/intervalManagerSubSite','1296652ZnbsCV','SELECT\x20token\x20FROM\x20AuthTokens\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x201','‚ùå\x20Cloud\x20error:','\x20WHERE\x20sensor_id\x20=\x20?','Failed\x20to\x20stop\x20jobs.','0|3|2|4|1','dKwRV','Sjxty','PLhSE','data','yWKPo','Dtoda','all','hNAyr','error','\x20SET\x20is_sending\x20=\x200,\x20is_fetching\x20=\x200\x20WHERE\x20sensor_id\x20=\x20?','.\x20Response:\x20','‚ùå\x20sendSubsiteDataToCloud\x20outer\x20error:\x20','hjWxN','Started\x20sending\x20for\x20sensor\x20','response','stopFetch','2zhGRfq','map','length','qbWaJ','4752795surCLJ','verify','token','VcKqk','dNlgK','Bearer\x20','config','atXKE','UPDATE\x20','get','dotenv','split','subsite_id\x20and\x20sensor_id\x20are\x20required\x20to\x20stop','1224330YmIeEb','8iiAwBX','message','env','‚ùå\x20Cloud\x20error:\x20','‚ùå\x20sendSubsiteDataToCloud\x20outer\x20error:','buyyX','6GBqJED','SLqtX','JWT_SECRET_APP','SHVNH','nhnUw','‚ùå\x20Failed\x20to\x20update\x20IntervalControl:','SELECT\x20id\x20FROM\x20Sensor_','veHox','12325536BOBISv','json','BbrPR','NXHSH','zcmdI','rBqpb','status','‚ùå\x20Failed\x20IntervalControl\x20update:\x20','MTWdq','SELECT\x20id,\x20interval_seconds,\x20batch_size\x20FROM\x20Sensor_','MKFVq','stopSend','log','AOKIS','‚úÖ\x20Sub-site\x20batch\x20sent.\x20Count:\x20','\x20WHERE\x20sent_to_cloud\x20=\x200\x20ORDER\x20BY\x20timestamp\x20ASC\x20LIMIT\x20?','No\x20valid\x20token\x20found.','\x20not\x20active\x20in\x20Sensor_','RiWUI'];a0_0x1541=function(){return _0x2fbf50;};return a0_0x1541();}const a0_0x51944e=a0_0x4569;(function(_0x394403,_0x7a9cef){const _0x2469a4=a0_0x4569,_0x5cad1f=_0x394403();while(!![]){try{const _0x34a19e=parseInt(_0x2469a4(0x131))/0x1+parseInt(_0x2469a4(0x147))/0x2*(-parseInt(_0x2469a4(0x14b))/0x3)+-parseInt(_0x2469a4(0x10e))/0x4+parseInt(_0x2469a4(0x11b))/0x5*(-parseInt(_0x2469a4(0xf3))/0x6)+parseInt(_0x2469a4(0x11d))/0x7*(parseInt(_0x2469a4(0x159))/0x8)+parseInt(_0x2469a4(0xfb))/0x9+parseInt(_0x2469a4(0x158))/0xa;if(_0x34a19e===_0x7a9cef)break;else _0x5cad1f['push'](_0x5cad1f['shift']());}catch(_0x559e26){_0x5cad1f['push'](_0x5cad1f['shift']());}}}(a0_0x1541,0xc95b4));const axios=require(a0_0x51944e(0x12f)),jwt=require('jsonwebtoken'),{insertSubsiteLog}=require('../utils/logHelpersSubSite'),intervalManager=require(a0_0x51944e(0x130)),{db}=require(a0_0x51944e(0x12b));require(a0_0x51944e(0x155))[a0_0x51944e(0x151)]();const getStoredToken=()=>{const _0x3c31a4=a0_0x51944e,_0x5f2cf1={'VcKqk':function(_0x36f048,_0x21337a){return _0x36f048(_0x21337a);},'veHox':_0x3c31a4(0x10b),'BbrPR':_0x3c31a4(0x132)};return new Promise((_0x4746e3,_0x29096f)=>{const _0x4b7ba7=_0x3c31a4,_0xfbd429={'qbWaJ':function(_0x59084a,_0x549943){const _0xce5b6d=a0_0x4569;return _0x5f2cf1[_0xce5b6d(0x14e)](_0x59084a,_0x549943);},'NXHSH':_0x5f2cf1[_0x4b7ba7(0xfa)]};db[_0x4b7ba7(0x154)](_0x5f2cf1[_0x4b7ba7(0xfd)],[],(_0x24b244,_0x796ad8)=>{const _0x39f65d=_0x4b7ba7;if(_0x24b244||!_0x796ad8)return _0xfbd429[_0x39f65d(0x14a)](_0x29096f,_0xfbd429[_0x39f65d(0xfe)]);_0xfbd429['qbWaJ'](_0x4746e3,_0x796ad8[_0x39f65d(0x14d)]);});});},getCompanyIdFromToken=async()=>{const _0x50b8c7=a0_0x51944e,_0x37119c={'frbws':function(_0x350e25){return _0x350e25();}},_0x21e469=await _0x37119c[_0x50b8c7(0x123)](getStoredToken),_0x58e3af=jwt[_0x50b8c7(0x14c)](_0x21e469,process[_0x50b8c7(0x15b)][_0x50b8c7(0xf5)]);return _0x58e3af[_0x50b8c7(0x120)];},sendSubsiteDataToCloud=async(_0x49d61f,_0x4be308)=>{const _0x46ddaa=a0_0x51944e,_0x5a7ac5={'hjWxN':function(_0xac4b6,_0x1a95f6,_0x3dcc81,_0x4af16c,_0x460e9a){return _0xac4b6(_0x1a95f6,_0x3dcc81,_0x4af16c,_0x460e9a);},'yltoE':function(_0x732bee,_0x300be0){return _0x732bee<_0x300be0;},'MTWdq':_0x46ddaa(0x133),'SLqtX':function(_0x288a75,_0x44e515){return _0x288a75!==_0x44e515;},'iKtns':_0x46ddaa(0xf8),'CASMr':function(_0x143de1,_0x387bcc){return _0x143de1*_0x387bcc;},'EwwCQ':function(_0x26d57c,_0x4247eb){return _0x26d57c||_0x4247eb;},'LAsQU':function(_0x4708f4){return _0x4708f4();},'dKwRV':_0x46ddaa(0xf1),'xgzKE':function(_0x1ad1b4,_0x50e9e2,_0x4491b2,_0x4b8366,_0x34b592){return _0x1ad1b4(_0x50e9e2,_0x4491b2,_0x4b8366,_0x34b592);}};try{const _0x3064be=await _0x5a7ac5['LAsQU'](getCompanyIdFromToken),_0xd1556d=_0x46ddaa(0x125)+_0x3064be+'_'+_0x49d61f+'_'+_0x4be308;db[_0x46ddaa(0x154)](_0x46ddaa(0x104)+_0x3064be+'_'+_0x49d61f+'\x20WHERE\x20bank_id\x20=\x20?\x20AND\x20is_active\x20=\x201',[_0x4be308],(_0x1dd802,_0xb3fb11)=>{const _0x16b6bd=_0x46ddaa;if(_0x5a7ac5[_0x16b6bd(0x11c)](_0x1dd802,!_0xb3fb11)){console[_0x16b6bd(0x13f)](_0x16b6bd(0x128)+_0x4be308+_0x16b6bd(0x117),_0x1dd802?.['message']),_0x5a7ac5[_0x16b6bd(0x143)](insertSubsiteLog,_0x4be308,_0x16b6bd(0x128)+_0x4be308+_0x16b6bd(0x10c)+_0x3064be+'_'+_0x49d61f,_0x3064be,_0x49d61f);return;}const {id:_0x521de7,interval_seconds:_0x39a0dc,batch_size:_0x50ea0a}=_0xb3fb11;db[_0x16b6bd(0x11f)]('INSERT\x20INTO\x20IntervalControl_'+_0x3064be+'_'+_0x49d61f+'\x20(sensor_id,\x20is_sending)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(sensor_id)\x20DO\x20UPDATE\x20SET\x20is_sending\x20=\x201',[_0x521de7],_0x2d4ed4=>{const _0x167912=_0x16b6bd,_0x1c9338={'Jufnk':function(_0x2cb6cf,_0x3ba035,_0x2fecbf,_0x101c1e,_0x5f0841){const _0x47278e=a0_0x4569;return _0x5a7ac5[_0x47278e(0x143)](_0x2cb6cf,_0x3ba035,_0x2fecbf,_0x101c1e,_0x5f0841);},'buyyX':function(_0x332f8d,_0x468cf5){const _0x54df2f=a0_0x4569;return _0x5a7ac5[_0x54df2f(0x127)](_0x332f8d,_0x468cf5);},'rBqpb':_0x5a7ac5[_0x167912(0x103)],'yWKPo':function(_0xff762d,_0x476c3b){const _0x140226=_0x167912;return _0x5a7ac5[_0x140226(0xf4)](_0xff762d,_0x476c3b);}};if(_0x2d4ed4){console[_0x167912(0x13f)](_0x5a7ac5[_0x167912(0x10f)],_0x2d4ed4['message']),insertSubsiteLog(_0x4be308,_0x167912(0x102)+_0x2d4ed4[_0x167912(0x15a)],_0x3064be,_0x49d61f);return;}intervalManager['startSend'](_0x4be308,async()=>{const _0x40415b=_0x167912,_0x3d42e6={'cGPtA':function(_0x26366c,_0x2f20ed,_0x3ff267,_0x3f9e85,_0x1063d0){return _0x1c9338['Jufnk'](_0x26366c,_0x2f20ed,_0x3ff267,_0x3f9e85,_0x1063d0);},'PLhSE':function(_0x2a60c8,_0x585f34){const _0x20fc86=a0_0x4569;return _0x1c9338[_0x20fc86(0xf2)](_0x2a60c8,_0x585f34);},'AOKIS':'üåê\x20Cloud\x20Response:','RiWUI':_0x1c9338[_0x40415b(0x100)],'Hjxwy':function(_0x47a413,_0x3a2c66){return _0x47a413||_0x3a2c66;},'dNlgK':function(_0x1278f0,_0x3b638a){const _0x1dee41=_0x40415b;return _0x1c9338[_0x1dee41(0x13b)](_0x1278f0,_0x3b638a);}};try{db[_0x40415b(0x154)]('SELECT\x20is_sending\x20FROM\x20IntervalControl_'+_0x3064be+'_'+_0x49d61f+_0x40415b(0x134),[_0x521de7],async(_0x54319b,_0x47051a)=>{const _0x141876=_0x40415b;if(_0x3d42e6[_0x141876(0x11a)](_0x54319b,!_0x47051a)||_0x3d42e6[_0x141876(0x14f)](_0x47051a[_0x141876(0x115)],0x1))return;db[_0x141876(0x13d)](_0x141876(0x116)+_0xd1556d+_0x141876(0x10a),[_0x50ea0a],async(_0x29d02f,_0x403e59)=>{const _0x5be6b6=_0x141876;if(_0x29d02f){_0x3d42e6['cGPtA'](insertSubsiteLog,_0x4be308,'‚ùå\x20Fetch\x20error:\x20'+_0x29d02f[_0x5be6b6(0x15a)],_0x3064be,_0x49d61f);return;}if(_0x3d42e6[_0x5be6b6(0x139)](_0x403e59[_0x5be6b6(0x149)],_0x50ea0a)){_0x3d42e6[_0x5be6b6(0x111)](insertSubsiteLog,_0x4be308,_0x5be6b6(0x11e)+_0x50ea0a+',\x20Found:\x20'+_0x403e59[_0x5be6b6(0x149)],_0x3064be,_0x49d61f);return;}const _0x2d275e=_0x403e59['map'](_0x3c9c2b=>({..._0x3c9c2b,'sensor_id':_0x4be308}));try{const _0x484f07=await axios['post'](process[_0x5be6b6(0x15b)][_0x5be6b6(0x124)]+_0x5be6b6(0x113),{'companyId':_0x3064be,'subsiteId':_0x49d61f,'sensorId':_0x4be308,'batch':_0x2d275e},{'headers':{'Authorization':_0x5be6b6(0x150)+await getStoredToken()}});console[_0x5be6b6(0x107)](_0x3d42e6[_0x5be6b6(0x108)],_0x484f07[_0x5be6b6(0x13a)]),_0x3d42e6[_0x5be6b6(0x111)](insertSubsiteLog,_0x4be308,_0x5be6b6(0x109)+_0x403e59[_0x5be6b6(0x149)]+_0x5be6b6(0x141)+JSON[_0x5be6b6(0x122)](_0x484f07['data']),_0x3064be,_0x49d61f);const _0xed1b1c=_0x403e59[_0x5be6b6(0x148)](_0x50e7da=>_0x50e7da['id'])['join'](',');db['run'](_0x5be6b6(0x153)+_0xd1556d+'\x20SET\x20sent_to_cloud\x20=\x201\x20WHERE\x20id\x20IN\x20('+_0xed1b1c+')');}catch(_0x913863){console[_0x5be6b6(0x13f)](_0x3d42e6[_0x5be6b6(0x10d)],_0x913863[_0x5be6b6(0x145)]?.[_0x5be6b6(0x13a)]||_0x913863['message']),_0x3d42e6[_0x5be6b6(0x111)](insertSubsiteLog,_0x4be308,_0x5be6b6(0xf0)+(_0x913863['response']?.[_0x5be6b6(0x13a)]?.[_0x5be6b6(0x15a)]||_0x913863['message']),_0x3064be,_0x49d61f);}});});}catch(_0x1f20d5){insertSubsiteLog(_0x4be308,'‚ùå\x20Send\x20interval\x20crash:\x20'+_0x1f20d5[_0x40415b(0x15a)],_0x3064be,_0x49d61f);}},_0x5a7ac5[_0x167912(0x114)](_0x39a0dc,0x3e8)),insertSubsiteLog(_0x4be308,_0x167912(0x112)+_0x39a0dc+'s',_0x3064be,_0x49d61f);});});}catch(_0x458a03){console[_0x46ddaa(0x13f)](_0x5a7ac5[_0x46ddaa(0x137)],_0x458a03[_0x46ddaa(0x15a)]),_0x5a7ac5['xgzKE'](insertSubsiteLog,undefined,_0x46ddaa(0x142)+_0x458a03[_0x46ddaa(0x15a)],companyId,_0x49d61f);}},triggerSendSubsiteData=async(_0x3793ae,_0x41f851)=>{const _0x4af622=a0_0x51944e,_0xe52383={'lUyFC':'subsite_id\x20and\x20sensor_id\x20are\x20required','laGAA':function(_0x276d57,_0x2d049c,_0x53f4ae){return _0x276d57(_0x2d049c,_0x53f4ae);}},{subsite_id:_0x54c47e,sensor_id:_0x710d49}=_0x3793ae[_0x4af622(0x118)];if(!_0x54c47e||!_0x710d49)return _0x41f851[_0x4af622(0x101)](0x190)[_0x4af622(0xfc)]({'message':_0xe52383[_0x4af622(0x110)]});return await _0xe52383[_0x4af622(0x121)](sendSubsiteDataToCloud,_0x54c47e,_0x710d49),_0x41f851[_0x4af622(0x101)](0xc8)[_0x4af622(0xfc)]({'message':_0x4af622(0x144)+_0x710d49+'\x20in\x20sub-site\x20'+_0x54c47e});},stopSubsiteJobs=(_0x60581b,_0x175f70)=>{const _0xcc90e4=a0_0x51944e,_0x1e8703={'MKFVq':_0xcc90e4(0x136),'nhnUw':function(_0x118444,_0x3d3995,_0x4b2bb4,_0x4fd181,_0xc903db){return _0x118444(_0x3d3995,_0x4b2bb4,_0x4fd181,_0xc903db);},'hmjfn':function(_0x534084,_0x3408a0){return _0x534084||_0x3408a0;},'LPaSs':function(_0x4f8433,_0x54a589,_0x1f559d,_0x475429,_0x31c7c8){return _0x4f8433(_0x54a589,_0x1f559d,_0x475429,_0x31c7c8);},'YtkHa':function(_0x4a8704,_0x4ef89e){return _0x4a8704||_0x4ef89e;},'atXKE':_0xcc90e4(0x157),'oYnyl':function(_0x2a9b80){return _0x2a9b80();}},{subsite_id:_0x5804e0,sensor_id:_0x48e0e2}=_0x60581b[_0xcc90e4(0x118)];if(_0x1e8703[_0xcc90e4(0x12e)](!_0x5804e0,!_0x48e0e2))return _0x175f70['status'](0x190)[_0xcc90e4(0xfc)]({'message':_0x1e8703[_0xcc90e4(0x152)]});_0x1e8703[_0xcc90e4(0x119)](getCompanyIdFromToken)['then'](_0x515700=>{const _0x200773=_0xcc90e4,_0x3ca754={'Sjxty':_0x1e8703[_0x200773(0x105)],'LgYSd':function(_0x3ba48d,_0x14a8a6,_0xf5f572,_0x30c340,_0x52eda1){const _0x4535fe=_0x200773;return _0x1e8703[_0x4535fe(0xf7)](_0x3ba48d,_0x14a8a6,_0xf5f572,_0x30c340,_0x52eda1);},'hNAyr':function(_0x5df7ae,_0x862599,_0x528b23,_0x17f850,_0x7b6317){return _0x5df7ae(_0x862599,_0x528b23,_0x17f850,_0x7b6317);},'SHVNH':function(_0x11885a,_0x3940b1){return _0x1e8703['hmjfn'](_0x11885a,_0x3940b1);},'zcmdI':function(_0x231f2f,_0x47ae99,_0x248ba5,_0x2c4637,_0x17af1d){const _0x3d35dd=_0x200773;return _0x1e8703[_0x3d35dd(0x12d)](_0x231f2f,_0x47ae99,_0x248ba5,_0x2c4637,_0x17af1d);}};db['get'](_0x200773(0xf9)+_0x515700+'_'+_0x5804e0+'\x20WHERE\x20bank_id\x20=\x20?',[_0x48e0e2],(_0x436c78,_0x483d05)=>{const _0x1a7ea1=_0x200773,_0x132059={'Dtoda':_0x3ca754[_0x1a7ea1(0x138)],'pOvLr':function(_0x457248,_0x39ef19,_0x4c1a8a,_0x188334,_0xb414c8){return _0x3ca754['LgYSd'](_0x457248,_0x39ef19,_0x4c1a8a,_0x188334,_0xb414c8);},'MXLYG':_0x1a7ea1(0x135),'qlLdp':function(_0x4bd799,_0x248026,_0x17337a,_0x44b1b5,_0x2506ed){const _0x4fe89c=_0x1a7ea1;return _0x3ca754[_0x4fe89c(0x13e)](_0x4bd799,_0x248026,_0x17337a,_0x44b1b5,_0x2506ed);}};if(_0x3ca754[_0x1a7ea1(0xf6)](_0x436c78,!_0x483d05))return _0x3ca754[_0x1a7ea1(0xff)](insertSubsiteLog,_0x48e0e2,'‚ùå\x20Cannot\x20stop:\x20not\x20found\x20in\x20Sensor_'+_0x515700+'_'+_0x5804e0,_0x515700,_0x5804e0),_0x175f70[_0x1a7ea1(0x101)](0x194)[_0x1a7ea1(0xfc)]({'message':_0x1a7ea1(0x12a)});const _0x4a941f=_0x483d05['id'];db[_0x1a7ea1(0x11f)]('UPDATE\x20IntervalControl_'+_0x515700+'_'+_0x5804e0+_0x1a7ea1(0x140),[_0x4a941f],function(_0x5c270c){const _0xdceec8=_0x1a7ea1,_0x1222ba=_0x132059[_0xdceec8(0x13c)][_0xdceec8(0x156)]('|');let _0x8fe4c3=0x0;while(!![]){switch(_0x1222ba[_0x8fe4c3++]){case'0':if(_0x5c270c)return _0x132059['pOvLr'](insertSubsiteLog,_0x48e0e2,_0xdceec8(0x126)+_0x5c270c[_0xdceec8(0x15a)],_0x515700,_0x5804e0),_0x175f70[_0xdceec8(0x101)](0x1f4)[_0xdceec8(0xfc)]({'message':_0x132059['MXLYG']});continue;case'1':return _0x175f70[_0xdceec8(0x101)](0xc8)[_0xdceec8(0xfc)]({'message':'Stopped\x20jobs\x20for\x20sensor\x20'+_0x48e0e2});case'2':intervalManager[_0xdceec8(0x146)](_0x48e0e2);continue;case'3':intervalManager[_0xdceec8(0x106)](_0x48e0e2);continue;case'4':_0x132059['qlLdp'](insertSubsiteLog,_0x48e0e2,_0xdceec8(0x129),_0x515700,_0x5804e0);continue;}break;}});});});};function a0_0x4569(_0x1519ce,_0xb5902b){const _0x154119=a0_0x1541();return a0_0x4569=function(_0x456993,_0x1b2e5a){_0x456993=_0x456993-0xf0;let _0x5d9fac=_0x154119[_0x456993];return _0x5d9fac;},a0_0x4569(_0x1519ce,_0xb5902b);}module[a0_0x51944e(0x12c)]={'triggerSendSubsiteData':triggerSendSubsiteData,'stopSubsiteJobs':stopSubsiteJobs,'sendSubsiteDataToCloud':sendSubsiteDataToCloud};