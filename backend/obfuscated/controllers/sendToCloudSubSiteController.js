function a0_0x15db(_0x1e76e9,_0x1bc988){const _0x2fa865=a0_0x2fa8();return a0_0x15db=function(_0x15dbf1,_0x463a21){_0x15dbf1=_0x15dbf1-0x124;let _0x50a11c=_0x2fa865[_0x15dbf1];return _0x50a11c;},a0_0x15db(_0x1e76e9,_0x1bc988);}const a0_0x9754b0=a0_0x15db;(function(_0x4d7472,_0x4ebe06){const _0x4312f6=a0_0x15db,_0x21e676=_0x4d7472();while(!![]){try{const _0x183374=parseInt(_0x4312f6(0x156))/0x1+-parseInt(_0x4312f6(0x17e))/0x2+-parseInt(_0x4312f6(0x178))/0x3*(parseInt(_0x4312f6(0x14c))/0x4)+-parseInt(_0x4312f6(0x13d))/0x5+-parseInt(_0x4312f6(0x180))/0x6*(parseInt(_0x4312f6(0x166))/0x7)+-parseInt(_0x4312f6(0x15d))/0x8*(-parseInt(_0x4312f6(0x12e))/0x9)+-parseInt(_0x4312f6(0x144))/0xa*(-parseInt(_0x4312f6(0x177))/0xb);if(_0x183374===_0x4ebe06)break;else _0x21e676['push'](_0x21e676['shift']());}catch(_0x10b711){_0x21e676['push'](_0x21e676['shift']());}}}(a0_0x2fa8,0x2e03e));const axios=require(a0_0x9754b0(0x127)),jwt=require('jsonwebtoken'),{insertSubsiteLog}=require(a0_0x9754b0(0x150)),intervalManager=require(a0_0x9754b0(0x15c)),{db}=require(a0_0x9754b0(0x163));require(a0_0x9754b0(0x12f))['config']();function a0_0x2fa8(){const _0x226998=['startSend','❌\x20Cannot\x20stop:\x20not\x20found\x20in\x20Sensor_','oTgsq','response','❌\x20Send\x20interval\x20crash:\x20','❌\x20Cloud\x20error:\x20','SLEYC','Failed\x20to\x20stop\x20jobs.','\x20WHERE\x20bank_id\x20=\x20?','Sensor\x20not\x20found\x20in\x20sub-site','env','JKXgY','✅\x20Sub-site\x20batch\x20sent.\x20Count:\x20','1042805aiJtev','UPDATE\x20IntervalControl_',',\x20Found:\x20','join','RuEdY','stopSend','LUSte','510wlWOJp','is_sending','then','dMSJo','error','gSyHP','UXkGv','Started\x20sending\x20for\x20sensor\x20','1450796VbSUpd','split','json','No\x20valid\x20token\x20found.','../utils/logHelpersSubSite','all','NMlcV','CLOUD_API_URL','Bearer\x20','sxTRQ','67816CaxCFR','\x20SET\x20sent_to_cloud\x20=\x201\x20WHERE\x20id\x20IN\x20(','\x20(sensor_id,\x20is_sending)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(sensor_id)\x20DO\x20UPDATE\x20SET\x20is_sending\x20=\x201','JWT_SECRET_APP','SELECT\x20id\x20FROM\x20Sensor_','tQyqp','../utils/intervalManagerSubSite','21176CKpGie','SELECT\x20id,\x20interval_seconds,\x20batch_size\x20FROM\x20Sensor_','CbWal','map','data','run','../db/sensorDB','/api/subsite/sensor-data/receive-data','\x20WHERE\x20bank_id\x20=\x20?\x20AND\x20is_active\x20=\x201','92141VBmfZG','subsite_id\x20and\x20sensor_id\x20are\x20required','status','\x20not\x20active\x20in\x20Sensor_','exports','subsite_id\x20and\x20sensor_id\x20are\x20required\x20to\x20stop','stringify','❌\x20sendSubsiteDataToCloud\x20outer\x20error:','❌\x20Stop\x20failed:\x20','post','XDxak','message','❌\x20Failed\x20IntervalControl\x20update:\x20','token','0|3|2|4|1','query','❌\x20Fetch\x20error:\x20','173272kRyzof','3BcwJmn','length','borlA','nmXUT','ZTlOk','nBgfk','334610LylMoe','cegeS','24PPtyye','hGWen','qPwgs','mRHrZ','axios','\x20WHERE\x20sensor_id\x20=\x20?','sKAZY','🌐\x20Cloud\x20Response:','❌\x20Sensor\x20','🛑\x20Jobs\x20stopped\x20for\x20sub-site\x20sensor.','get','369MRsEiY','dotenv'];a0_0x2fa8=function(){return _0x226998;};return a0_0x2fa8();}const getStoredToken=()=>{const _0x449b14={'mRHrZ':function(_0x3e0788,_0x45edfd){return _0x3e0788||_0x45edfd;},'sKAZY':function(_0x5e0c6a,_0x3197b0){return _0x5e0c6a(_0x3197b0);},'nmXUT':function(_0x418e62,_0x40c049){return _0x418e62(_0x40c049);},'tQyqp':'SELECT\x20token\x20FROM\x20AuthTokens\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x201'};return new Promise((_0xbc2d40,_0x246b45)=>{const _0x8668b8=a0_0x15db;db[_0x8668b8(0x12d)](_0x449b14[_0x8668b8(0x15b)],[],(_0x4a7ef4,_0x5a39d5)=>{const _0x49cdfa=_0x8668b8;if(_0x449b14[_0x49cdfa(0x126)](_0x4a7ef4,!_0x5a39d5))return _0x449b14[_0x49cdfa(0x129)](_0x246b45,_0x49cdfa(0x14f));_0x449b14[_0x49cdfa(0x17b)](_0xbc2d40,_0x5a39d5[_0x49cdfa(0x173)]);});});},getCompanyIdFromToken=async()=>{const _0x3d6c16=a0_0x9754b0,_0x10646f=await getStoredToken(),_0x44e840=jwt['verify'](_0x10646f,process[_0x3d6c16(0x13a)][_0x3d6c16(0x159)]);return _0x44e840['companyId'];},sendSubsiteDataToCloud=async(_0x559fce,_0x4fef28)=>{const _0x2a9177=a0_0x9754b0,_0x149af7={'gHiej':function(_0x2068d,_0x3efa1b){return _0x2068d!==_0x3efa1b;},'dMSJo':function(_0x67fb82,_0x3268bb,_0xf5babd,_0x5bfe03,_0x230e23){return _0x67fb82(_0x3268bb,_0xf5babd,_0x5bfe03,_0x230e23);},'JKXgY':function(_0x418463){return _0x418463();},'EXhqF':'❌\x20Cloud\x20error:','RuEdY':'❌\x20Failed\x20to\x20update\x20IntervalControl:','sxTRQ':function(_0x37e79c,_0x58e6ba){return _0x37e79c*_0x58e6ba;},'aUiBm':function(_0x5a0bfc){return _0x5a0bfc();},'WBXop':function(_0x16f140,_0x3b0edb,_0x5bcb3b,_0x185d1e,_0x421c26){return _0x16f140(_0x3b0edb,_0x5bcb3b,_0x185d1e,_0x421c26);}};try{const _0x346e78=await _0x149af7['aUiBm'](getCompanyIdFromToken),_0x409e20='SensorData_'+_0x346e78+'_'+_0x559fce+'_'+_0x4fef28;db[_0x2a9177(0x12d)](_0x2a9177(0x15e)+_0x346e78+'_'+_0x559fce+_0x2a9177(0x165),[_0x4fef28],(_0x2d3bf6,_0x4e4d44)=>{const _0x45922d=_0x2a9177;if(_0x2d3bf6||!_0x4e4d44){console[_0x45922d(0x148)](_0x45922d(0x12b)+_0x4fef28+'\x20not\x20found\x20or\x20inactive\x20in\x20sub-site',_0x2d3bf6?.[_0x45922d(0x171)]),insertSubsiteLog(_0x4fef28,'❌\x20Sensor\x20'+_0x4fef28+_0x45922d(0x169)+_0x346e78+'_'+_0x559fce,_0x346e78,_0x559fce);return;}const {id:_0x465721,interval_seconds:_0x3708b8,batch_size:_0x2ef859}=_0x4e4d44;db[_0x45922d(0x162)]('INSERT\x20INTO\x20IntervalControl_'+_0x346e78+'_'+_0x559fce+_0x45922d(0x158),[_0x465721],_0x17d9b4=>{const _0x1bbeb6=_0x45922d,_0x7b3ec9={'SLEYC':function(_0x21acdb,_0x3d3260){return _0x21acdb||_0x3d3260;},'LUSte':function(_0x16e014,_0x2f1d9c){return _0x149af7['gHiej'](_0x16e014,_0x2f1d9c);},'qPwgs':function(_0x229201,_0x490516,_0x2714de,_0xe3da7b,_0x24845a){const _0x1b3e40=a0_0x15db;return _0x149af7[_0x1b3e40(0x147)](_0x229201,_0x490516,_0x2714de,_0xe3da7b,_0x24845a);},'XDxak':function(_0x4cf907){const _0x2d120f=a0_0x15db;return _0x149af7[_0x2d120f(0x13b)](_0x4cf907);},'qSKcp':function(_0x35f9d9,_0x4ece72,_0x2bf5d3,_0x2049b2,_0x21c735){return _0x35f9d9(_0x4ece72,_0x2bf5d3,_0x2049b2,_0x21c735);},'bghcc':_0x149af7['EXhqF'],'JmRhA':function(_0x266897,_0x231e4a,_0x875f11,_0x512286,_0x592f81){const _0x59db71=a0_0x15db;return _0x149af7[_0x59db71(0x147)](_0x266897,_0x231e4a,_0x875f11,_0x512286,_0x592f81);}};if(_0x17d9b4){console[_0x1bbeb6(0x148)](_0x149af7[_0x1bbeb6(0x141)],_0x17d9b4[_0x1bbeb6(0x171)]),_0x149af7[_0x1bbeb6(0x147)](insertSubsiteLog,_0x4fef28,_0x1bbeb6(0x172)+_0x17d9b4['message'],_0x346e78,_0x559fce);return;}intervalManager[_0x1bbeb6(0x130)](_0x4fef28,async()=>{const _0x22d351=_0x1bbeb6,_0x42d249={'CbWal':function(_0x32a1e9,_0x4f5686,_0x167deb,_0x34ba0e,_0x1fd890){const _0x3f8687=a0_0x15db;return _0x7b3ec9[_0x3f8687(0x125)](_0x32a1e9,_0x4f5686,_0x167deb,_0x34ba0e,_0x1fd890);},'WmCFX':function(_0x3eef40,_0x27374f){return _0x3eef40<_0x27374f;},'EyLSA':function(_0x55c477,_0x1a2db6,_0x26eb6e,_0x24018d,_0x556fa6){const _0x45c0bc=a0_0x15db;return _0x7b3ec9[_0x45c0bc(0x125)](_0x55c477,_0x1a2db6,_0x26eb6e,_0x24018d,_0x556fa6);},'jUpjA':function(_0x50401f){const _0x2571f2=a0_0x15db;return _0x7b3ec9[_0x2571f2(0x170)](_0x50401f);},'NMlcV':_0x22d351(0x12a),'ZTlOk':function(_0x2233c6,_0x2f06b6,_0x4deb76,_0x58d7d0,_0x207d6f){return _0x7b3ec9['qSKcp'](_0x2233c6,_0x2f06b6,_0x4deb76,_0x58d7d0,_0x207d6f);},'nBgfk':_0x7b3ec9['bghcc'],'borlA':function(_0x3b234d,_0x5ad129,_0xa3d3d2,_0x2280f9,_0x232764){const _0x148413=_0x22d351;return _0x7b3ec9[_0x148413(0x125)](_0x3b234d,_0x5ad129,_0xa3d3d2,_0x2280f9,_0x232764);}};try{db[_0x22d351(0x12d)]('SELECT\x20is_sending\x20FROM\x20IntervalControl_'+_0x346e78+'_'+_0x559fce+_0x22d351(0x128),[_0x465721],async(_0x36c813,_0x5cb948)=>{const _0x5378ce=_0x22d351;if(_0x7b3ec9[_0x5378ce(0x136)](_0x36c813,!_0x5cb948)||_0x7b3ec9[_0x5378ce(0x143)](_0x5cb948[_0x5378ce(0x145)],0x1))return;db[_0x5378ce(0x151)]('SELECT\x20*\x20FROM\x20'+_0x409e20+'\x20WHERE\x20sent_to_cloud\x20=\x200\x20ORDER\x20BY\x20timestamp\x20ASC\x20LIMIT\x20?',[_0x2ef859],async(_0x3da2fb,_0x35097a)=>{const _0x193f20=_0x5378ce;if(_0x3da2fb){_0x42d249[_0x193f20(0x15f)](insertSubsiteLog,_0x4fef28,_0x193f20(0x176)+_0x3da2fb[_0x193f20(0x171)],_0x346e78,_0x559fce);return;}if(_0x42d249['WmCFX'](_0x35097a['length'],_0x2ef859)){_0x42d249['EyLSA'](insertSubsiteLog,_0x4fef28,'⏳\x20Waiting\x20for\x20batch.\x20Needed:\x20'+_0x2ef859+_0x193f20(0x13f)+_0x35097a[_0x193f20(0x179)],_0x346e78,_0x559fce);return;}const _0x1512ec=_0x35097a[_0x193f20(0x160)](_0x4ce526=>({..._0x4ce526,'sensor_id':_0x4fef28}));try{const _0x51b84d=await axios[_0x193f20(0x16f)](process['env'][_0x193f20(0x153)]+_0x193f20(0x164),{'companyId':_0x346e78,'subsiteId':_0x559fce,'sensorId':_0x4fef28,'batch':_0x1512ec},{'headers':{'Authorization':_0x193f20(0x154)+await _0x42d249['jUpjA'](getStoredToken)}});console['log'](_0x42d249[_0x193f20(0x152)],_0x51b84d[_0x193f20(0x161)]),_0x42d249[_0x193f20(0x17c)](insertSubsiteLog,_0x4fef28,_0x193f20(0x13c)+_0x35097a[_0x193f20(0x179)]+'.\x20Response:\x20'+JSON[_0x193f20(0x16c)](_0x51b84d[_0x193f20(0x161)]),_0x346e78,_0x559fce);const _0x5862f2=_0x35097a['map'](_0x501769=>_0x501769['id'])[_0x193f20(0x140)](',');db['run']('UPDATE\x20'+_0x409e20+_0x193f20(0x157)+_0x5862f2+')');}catch(_0x395d2b){console['error'](_0x42d249[_0x193f20(0x17d)],_0x395d2b[_0x193f20(0x133)]?.[_0x193f20(0x161)]||_0x395d2b[_0x193f20(0x171)]),_0x42d249[_0x193f20(0x17a)](insertSubsiteLog,_0x4fef28,_0x193f20(0x135)+(_0x395d2b['response']?.[_0x193f20(0x161)]?.[_0x193f20(0x171)]||_0x395d2b[_0x193f20(0x171)]),_0x346e78,_0x559fce);}});});}catch(_0x1251bd){_0x7b3ec9['JmRhA'](insertSubsiteLog,_0x4fef28,_0x22d351(0x134)+_0x1251bd[_0x22d351(0x171)],_0x346e78,_0x559fce);}},_0x149af7[_0x1bbeb6(0x155)](_0x3708b8,0x3e8)),insertSubsiteLog(_0x4fef28,'🚀\x20Started\x20cloud\x20send\x20for\x20sub-site\x20sensor\x20every\x20'+_0x3708b8+'s',_0x346e78,_0x559fce);});});}catch(_0x38267d){console[_0x2a9177(0x148)](_0x2a9177(0x16d),_0x38267d[_0x2a9177(0x171)]),_0x149af7['WBXop'](insertSubsiteLog,undefined,'❌\x20sendSubsiteDataToCloud\x20outer\x20error:\x20'+_0x38267d[_0x2a9177(0x171)],companyId,_0x559fce);}},triggerSendSubsiteData=async(_0x1ce563,_0x751825)=>{const _0x562d89=a0_0x9754b0,_0x2cda62={'xMiQh':function(_0x1f7867,_0x5bf099){return _0x1f7867||_0x5bf099;},'gSyHP':_0x562d89(0x167)},{subsite_id:_0x3d7d12,sensor_id:_0x2d5b77}=_0x1ce563[_0x562d89(0x175)];if(_0x2cda62['xMiQh'](!_0x3d7d12,!_0x2d5b77))return _0x751825['status'](0x190)[_0x562d89(0x14e)]({'message':_0x2cda62[_0x562d89(0x149)]});return await sendSubsiteDataToCloud(_0x3d7d12,_0x2d5b77),_0x751825[_0x562d89(0x168)](0xc8)[_0x562d89(0x14e)]({'message':_0x562d89(0x14b)+_0x2d5b77+'\x20in\x20sub-site\x20'+_0x3d7d12});},stopSubsiteJobs=(_0x4c8057,_0x428885)=>{const _0x534713=a0_0x9754b0,_0x38b337={'MsJhr':_0x534713(0x174),'FesOC':function(_0x2aec0a,_0x3fdc2d,_0x5ea28b,_0x35fa6d,_0x4e31b1){return _0x2aec0a(_0x3fdc2d,_0x5ea28b,_0x35fa6d,_0x4e31b1);},'ROyuH':function(_0x143375,_0x5e77b8){return _0x143375||_0x5e77b8;},'RpnNj':function(_0x9bdbd4,_0x3146bf){return _0x9bdbd4||_0x3146bf;}},{subsite_id:_0x34709b,sensor_id:_0x2505f}=_0x4c8057['query'];if(_0x38b337['RpnNj'](!_0x34709b,!_0x2505f))return _0x428885[_0x534713(0x168)](0x190)[_0x534713(0x14e)]({'message':_0x534713(0x16b)});getCompanyIdFromToken()[_0x534713(0x146)](_0x37533b=>{const _0x2f06f4=_0x534713,_0x57a774={'UXkGv':_0x38b337['MsJhr'],'cegeS':function(_0x1ab2c0,_0x4f4d8f,_0x1f0432,_0x2fcbe8,_0x367961){return _0x38b337['FesOC'](_0x1ab2c0,_0x4f4d8f,_0x1f0432,_0x2fcbe8,_0x367961);},'SAsNv':function(_0x49d47b,_0x5356b0,_0x391b5d,_0xa4c31d,_0x1d4173){return _0x38b337['FesOC'](_0x49d47b,_0x5356b0,_0x391b5d,_0xa4c31d,_0x1d4173);},'BfIJQ':function(_0x1d60e1,_0x4bdf0a){return _0x38b337['ROyuH'](_0x1d60e1,_0x4bdf0a);}};db[_0x2f06f4(0x12d)](_0x2f06f4(0x15a)+_0x37533b+'_'+_0x34709b+_0x2f06f4(0x138),[_0x2505f],(_0x28a50c,_0x322207)=>{const _0x4cd732=_0x2f06f4,_0x4917bd={'hGWen':_0x57a774[_0x4cd732(0x14a)],'oTgsq':function(_0x11b8a0,_0x5e6482,_0x155157,_0x537f7c,_0x4f3150){const _0x1bb37f=_0x4cd732;return _0x57a774[_0x1bb37f(0x17f)](_0x11b8a0,_0x5e6482,_0x155157,_0x537f7c,_0x4f3150);},'XmwDO':function(_0x31fea1,_0x24b764,_0x5cf0bc,_0x484f02,_0x3e5772){return _0x57a774['SAsNv'](_0x31fea1,_0x24b764,_0x5cf0bc,_0x484f02,_0x3e5772);}};if(_0x57a774['BfIJQ'](_0x28a50c,!_0x322207))return insertSubsiteLog(_0x2505f,_0x4cd732(0x131)+_0x37533b+'_'+_0x34709b,_0x37533b,_0x34709b),_0x428885['status'](0x194)['json']({'message':_0x4cd732(0x139)});const _0x6b2841=_0x322207['id'];db['run'](_0x4cd732(0x13e)+_0x37533b+'_'+_0x34709b+'\x20SET\x20is_sending\x20=\x200,\x20is_fetching\x20=\x200\x20WHERE\x20sensor_id\x20=\x20?',[_0x6b2841],function(_0x344f3d){const _0x19bdd7=_0x4cd732,_0x1b462f=_0x4917bd[_0x19bdd7(0x124)][_0x19bdd7(0x14d)]('|');let _0x4bd393=0x0;while(!![]){switch(_0x1b462f[_0x4bd393++]){case'0':if(_0x344f3d)return _0x4917bd[_0x19bdd7(0x132)](insertSubsiteLog,_0x2505f,_0x19bdd7(0x16e)+_0x344f3d[_0x19bdd7(0x171)],_0x37533b,_0x34709b),_0x428885[_0x19bdd7(0x168)](0x1f4)[_0x19bdd7(0x14e)]({'message':_0x19bdd7(0x137)});continue;case'1':return _0x428885[_0x19bdd7(0x168)](0xc8)['json']({'message':'Stopped\x20jobs\x20for\x20sensor\x20'+_0x2505f});case'2':intervalManager['stopFetch'](_0x2505f);continue;case'3':intervalManager[_0x19bdd7(0x142)](_0x2505f);continue;case'4':_0x4917bd['XmwDO'](insertSubsiteLog,_0x2505f,_0x19bdd7(0x12c),_0x37533b,_0x34709b);continue;}break;}});});});};module[a0_0x9754b0(0x16a)]={'triggerSendSubsiteData':triggerSendSubsiteData,'stopSubsiteJobs':stopSubsiteJobs,'sendSubsiteDataToCloud':sendSubsiteDataToCloud};