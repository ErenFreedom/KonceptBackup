const a0_0x6f535b=a0_0x2df3;(function(_0x3b4e13,_0x5224ba){const _0x384484=a0_0x2df3,_0xf9fe3=_0x3b4e13();while(!![]){try{const _0x4acece=-parseInt(_0x384484(0xa8))/0x1*(-parseInt(_0x384484(0xa2))/0x2)+parseInt(_0x384484(0x91))/0x3+parseInt(_0x384484(0xa3))/0x4+-parseInt(_0x384484(0x88))/0x5*(parseInt(_0x384484(0x8a))/0x6)+-parseInt(_0x384484(0x86))/0x7+parseInt(_0x384484(0x9d))/0x8+-parseInt(_0x384484(0x8d))/0x9*(parseInt(_0x384484(0xa9))/0xa);if(_0x4acece===_0x5224ba)break;else _0xf9fe3['push'](_0xf9fe3['shift']());}catch(_0x3c0607){_0xf9fe3['push'](_0xf9fe3['shift']());}}}(a0_0x4d1b,0x61916));function a0_0x2df3(_0x58e378,_0x5b71ef){const _0x4d1b72=a0_0x4d1b();return a0_0x2df3=function(_0x2df313,_0xb162ed){_0x2df313=_0x2df313-0x77;let _0x129f72=_0x4d1b72[_0x2df313];return _0x129f72;},a0_0x2df3(_0x58e378,_0x5b71ef);}const {db}=require(a0_0x6f535b(0x80)),jwt=require(a0_0x6f535b(0x99));require(a0_0x6f535b(0x9e))['config']();const getAdminDetailsFromToken=_0x2d55d8=>{const _0x3deece=a0_0x6f535b,_0x18958c={'xrsJG':_0x3deece(0x95),'VrULa':_0x3deece(0x97),'looTr':_0x3deece(0x7d)};try{const _0x6a7aa2=_0x2d55d8[_0x3deece(0xa5)]['authorization'];if(!_0x6a7aa2||!_0x6a7aa2[_0x3deece(0xaf)](_0x18958c[_0x3deece(0x7b)]))return console[_0x3deece(0x98)](_0x3deece(0xa7)),null;const _0x3e0f16=_0x6a7aa2['split']('\x20')[0x1],_0x1921c8=jwt['verify'](_0x3e0f16,process[_0x3deece(0x77)]['JWT_SECRET_APP']);if(!_0x1921c8[_0x3deece(0xab)])return console[_0x3deece(0x98)](_0x18958c[_0x3deece(0x9c)],_0x1921c8),null;return{'companyId':_0x1921c8['companyId'],'adminId':_0x1921c8[_0x3deece(0x92)],'subSites':_0x1921c8[_0x3deece(0x83)]};}catch(_0x502db3){return console[_0x3deece(0x98)](_0x18958c[_0x3deece(0x8e)],_0x502db3[_0x3deece(0x7f)]),null;}},getSubsiteSensorJobStatus=(_0x510400,_0x3b4159)=>{const _0x35d79b=a0_0x6f535b,_0x41e15b={'ZoXcB':'DB\x20error','tNLrp':_0x35d79b(0x82),'hZvHD':function(_0x4e4db5,_0x9f1863){return _0x4e4db5(_0x9f1863);}},_0xf55aab=_0x510400[_0x35d79b(0x93)]['bank_id'],_0x40e9d2=_0x510400[_0x35d79b(0x93)][_0x35d79b(0xb1)],{companyId:_0x53f1d3}=_0x41e15b[_0x35d79b(0xa1)](getAdminDetailsFromToken,_0x510400)||{};if(!_0xf55aab||!_0x40e9d2||!_0x53f1d3)return _0x3b4159[_0x35d79b(0x9f)](0x190)['json']({'message':_0x35d79b(0x8b)});const _0x2ed9f7='Sensor_'+_0x53f1d3+'_'+_0x40e9d2,_0x138c7b='IntervalControl_'+_0x53f1d3+'_'+_0x40e9d2,_0x281cdc=_0x35d79b(0xac)+_0x138c7b+'.is_fetching,\x20'+_0x138c7b+_0x35d79b(0x84)+_0x138c7b+'\x0a\x20\x20\x20\x20JOIN\x20'+_0x2ed9f7+_0x35d79b(0x7c)+_0x138c7b+'.sensor_id\x20=\x20'+_0x2ed9f7+'.id\x0a\x20\x20\x20\x20WHERE\x20'+_0x2ed9f7+_0x35d79b(0xad);db[_0x35d79b(0x8f)](_0x281cdc,[_0xf55aab],(_0xe0fef,_0x4af53a)=>{const _0x5e4ce0=_0x35d79b;if(_0xe0fef)return console[_0x5e4ce0(0x98)](_0x5e4ce0(0x87),_0xe0fef[_0x5e4ce0(0x7f)]),_0x3b4159[_0x5e4ce0(0x9f)](0x1f4)[_0x5e4ce0(0x94)]({'message':_0x41e15b[_0x5e4ce0(0x8c)]});if(!_0x4af53a)return _0x3b4159[_0x5e4ce0(0x9f)](0x194)[_0x5e4ce0(0x94)]({'message':_0x41e15b[_0x5e4ce0(0x79)]});return _0x3b4159[_0x5e4ce0(0x9f)](0xc8)[_0x5e4ce0(0x94)]({'is_fetching':!!_0x4af53a[_0x5e4ce0(0x96)],'is_sending':!!_0x4af53a[_0x5e4ce0(0x9b)]});});},getAllSubsiteSensorJobStatuses=(_0x1aa494,_0x4d2e54)=>{const _0x3dffaf=a0_0x6f535b,_0x32fb4f={'qkbxz':_0x3dffaf(0x78),'ubZsV':function(_0x126e8c,_0x3c8f6f){return _0x126e8c||_0x3c8f6f;},'tHdsk':_0x3dffaf(0xb0)},_0x5231b6=_0x1aa494[_0x3dffaf(0x93)]['subsite_id'],{companyId:_0x4be47b}=getAdminDetailsFromToken(_0x1aa494)||{};if(_0x32fb4f[_0x3dffaf(0xaa)](!_0x5231b6,!_0x4be47b))return _0x4d2e54[_0x3dffaf(0x9f)](0x190)['json']({'message':_0x32fb4f['tHdsk']});const _0x269215=_0x3dffaf(0x81)+_0x4be47b+'_'+_0x5231b6,_0x567415=_0x3dffaf(0xa0)+_0x4be47b+'_'+_0x5231b6,_0x3de463=_0x3dffaf(0xb2)+_0x567415+_0x3dffaf(0xa4)+_0x269215+_0x3dffaf(0x85)+_0x567415+_0x3dffaf(0x90)+_0x567415+_0x3dffaf(0x84)+_0x567415+_0x3dffaf(0x9a)+_0x269215+'\x20ON\x20'+_0x567415+_0x3dffaf(0x89)+_0x269215+_0x3dffaf(0xae);db['all'](_0x3de463,[],(_0x135376,_0x76b254)=>{const _0x46ac0d=_0x3dffaf;if(_0x135376)return console[_0x46ac0d(0x98)](_0x32fb4f['qkbxz'],_0x135376[_0x46ac0d(0x7f)]),_0x4d2e54['status'](0x1f4)[_0x46ac0d(0x94)]({'message':_0x46ac0d(0x7e)});const _0xbaff66={};return _0x76b254[_0x46ac0d(0xa6)](_0x47d402=>{const _0x3e3b78=_0x46ac0d;_0xbaff66[_0x47d402['bank_id']]={'is_fetching':!!_0x47d402[_0x3e3b78(0x96)],'is_sending':!!_0x47d402[_0x3e3b78(0x9b)]};}),_0x4d2e54[_0x46ac0d(0x9f)](0xc8)[_0x46ac0d(0x94)](_0xbaff66);});};module[a0_0x6f535b(0x7a)]={'getSubsiteSensorJobStatus':getSubsiteSensorJobStatus,'getAllSubsiteSensorJobStatuses':getAllSubsiteSensorJobStatuses};function a0_0x4d1b(){const _0x48fd2d=['error','jsonwebtoken','\x0a\x20\x20\x20\x20JOIN\x20','is_sending','VrULa','2868112OLFmzu','dotenv','status','IntervalControl_','hZvHD','38398cdtRlo','2990504Wbvauh','.sensor_id\x20AS\x20local_id,\x0a\x20\x20\x20\x20\x20\x20','headers','forEach','❌\x20Missing\x20or\x20malformed\x20Authorization\x20header','39eBajDW','2430CJKQHj','ubZsV','companyId','\x0a\x20\x20\x20\x20SELECT\x20','.bank_id\x20=\x20?\x0a\x20\x20','.id\x0a\x20\x20','startsWith','Missing\x20subsite_id\x20or\x20token','subsite_id','\x0a\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20','env','❌\x20DB\x20error\x20in\x20sub-site\x20job\x20status\x20fetch\x20all:','tNLrp','exports','xrsJG','\x20ON\x20','❌\x20Token\x20decoding\x20failed:','DB\x20error','message','../db/sensorDB','Sensor_','Sensor\x20not\x20found\x20in\x20IntervalControl','subSites','.is_sending\x0a\x20\x20\x20\x20FROM\x20','.bank_id\x20AS\x20bank_id,\x0a\x20\x20\x20\x20\x20\x20','2912077TEIXTq','❌\x20DB\x20error\x20in\x20sub-site\x20job\x20status\x20fetch:','1431225TXAqfZ','.sensor_id\x20=\x20','6xwIGAN','Missing\x20bank_id\x20or\x20subsite_id\x20or\x20token','ZoXcB','52182NmOhpQ','looTr','get','.is_fetching,\x0a\x20\x20\x20\x20\x20\x20','1967721WQnTEg','adminId','query','json','Bearer\x20','is_fetching','❌\x20companyId\x20missing\x20in\x20JWT\x20payload:'];a0_0x4d1b=function(){return _0x48fd2d;};return a0_0x4d1b();}