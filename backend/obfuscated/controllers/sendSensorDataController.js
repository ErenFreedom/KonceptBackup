function a7_0x5c09(_0x40f5e4,_0x5ad378){const _0x33a88e=a7_0x33a8();return a7_0x5c09=function(_0x5c0944,_0x1bc7ea){_0x5c0944=_0x5c0944-0x16e;let _0x1667d5=_0x33a88e[_0x5c0944];return _0x1667d5;},a7_0x5c09(_0x40f5e4,_0x5ad378);}const a7_0x3545ef=a7_0x5c09;(function(_0x47448e,_0x5cdebf){const _0x366044=a7_0x5c09,_0xdc6cd0=_0x47448e();while(!![]){try{const _0x7ee5ef=-parseInt(_0x366044(0x1c2))/0x1*(parseInt(_0x366044(0x1b8))/0x2)+-parseInt(_0x366044(0x18f))/0x3*(parseInt(_0x366044(0x1c7))/0x4)+-parseInt(_0x366044(0x1b7))/0x5+-parseInt(_0x366044(0x1c4))/0x6+parseInt(_0x366044(0x18e))/0x7*(-parseInt(_0x366044(0x1b9))/0x8)+parseInt(_0x366044(0x1a8))/0x9*(-parseInt(_0x366044(0x1c5))/0xa)+parseInt(_0x366044(0x1a0))/0xb;if(_0x7ee5ef===_0x5cdebf)break;else _0xdc6cd0['push'](_0xdc6cd0['shift']());}catch(_0x4a1f86){_0xdc6cd0['push'](_0xdc6cd0['shift']());}}}(a7_0x33a8,0xf2b4e));const axios=require(a7_0x3545ef(0x1a7)),jwt=require('jsonwebtoken'),{insertLog}=require(a7_0x3545ef(0x179));require(a7_0x3545ef(0x1c6))[a7_0x3545ef(0x192)]();const {db}=require('../db/sensorDB');db['run']('\x0a\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20IntervalControl\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20sensor_id\x20INTEGER\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20is_fetching\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20is_sending\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(sensor_id)\x20REFERENCES\x20LocalActiveSensors(id)\x20ON\x20DELETE\x20CASCADE\x0a\x20\x20\x20\x20)\x0a');const getStoredToken=()=>{const _0x2c0f4b=a7_0x3545ef,_0x324e5b={'CydkW':function(_0x5d14c3,_0x1310ac){return _0x5d14c3||_0x1310ac;},'CDSIu':_0x2c0f4b(0x18c),'alXPY':_0x2c0f4b(0x173)};return new Promise((_0x10b6b8,_0x31295f)=>{db['get'](_0x324e5b['alXPY'],[],(_0x3c9ba4,_0x44afee)=>{const _0x3cf73f=a7_0x5c09;if(_0x324e5b['CydkW'](_0x3c9ba4,!_0x44afee))return _0x31295f(_0x324e5b['CDSIu']);_0x10b6b8(_0x44afee[_0x3cf73f(0x1a9)]);});});},getCompanyIdFromToken=async()=>{const _0x46ec24=a7_0x3545ef,_0xa3bbe6={'GLOvk':function(_0x5500b5){return _0x5500b5();},'aOXEL':'❌\x20JWT\x20decode\x20failed:','eqvYt':'Invalid\x20token'};try{const _0x5bb10e=await _0xa3bbe6[_0x46ec24(0x17e)](getStoredToken),_0x8177bc=jwt[_0x46ec24(0x17b)](_0x5bb10e,process[_0x46ec24(0x194)]['JWT_SECRET_APP']);return console['log'](_0x46ec24(0x1a6)+_0x8177bc['companyId']),_0x8177bc[_0x46ec24(0x1b1)];}catch(_0x469e10){console['error'](_0xa3bbe6[_0x46ec24(0x19e)],_0x469e10['message']);throw new Error(_0xa3bbe6[_0x46ec24(0x1ad)]);}},sendDataToCloud=async _0x2e36e6=>{const _0x5bae1e=a7_0x3545ef,_0xef90e2={'tVIRl':function(_0x4d8da1,_0x59b62a){return _0x4d8da1<_0x59b62a;},'IWxNU':function(_0x130a06){return _0x130a06();},'AhDjy':function(_0xc890ad,_0x4ec690,_0xf8fb16){return _0xc890ad(_0x4ec690,_0xf8fb16);},'aWhHC':_0x5bae1e(0x170),'VdFvF':function(_0x21954b,_0x10b614){return _0x21954b*_0x10b614;},'YhYpV':function(_0x2430d2,_0x907947,_0x250a90){return _0x2430d2(_0x907947,_0x250a90);},'fPsyX':function(_0x49a964,_0x53bed5){return _0x49a964||_0x53bed5;},'IAuah':function(_0x1d2be0,_0x3971b3,_0x2169d1){return _0x1d2be0(_0x3971b3,_0x2169d1);}};try{const _0x284753=await _0xef90e2[_0x5bae1e(0x1af)](getCompanyIdFromToken),_0xdb2316='SensorData_'+_0x284753+'_'+_0x2e36e6;db[_0x5bae1e(0x1c1)](_0x5bae1e(0x17d),[_0x2e36e6],(_0x34e8e3,_0x5f02d6)=>{const _0x1193fb=_0x5bae1e;if(_0xef90e2[_0x1193fb(0x190)](_0x34e8e3,!_0x5f02d6)){console[_0x1193fb(0x199)](_0x1193fb(0x188)+_0x2e36e6+'\x20not\x20found\x20or\x20inactive.',_0x34e8e3?.[_0x1193fb(0x19a)]),_0xef90e2[_0x1193fb(0x186)](insertLog,_0x2e36e6,_0x1193fb(0x188)+_0x2e36e6+_0x1193fb(0x16f));return;}const {id:_0x1895f2,interval_seconds:_0x95ba83,batch_size:_0x56af5d}=_0x5f02d6;db[_0x1193fb(0x1bd)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INSERT\x20INTO\x20IntervalControl\x20(sensor_id,\x20is_sending)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(sensor_id)\x20DO\x20UPDATE\x20SET\x20is_sending\x20=\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',[_0x1895f2],_0x4529f1=>{const _0x243624=_0x1193fb,_0x3b077c={'YoRjg':function(_0x25fd46,_0x13849b,_0x5b59be){return _0x25fd46(_0x13849b,_0x5b59be);},'inEif':function(_0x478144,_0x15e5eb){return _0xef90e2['tVIRl'](_0x478144,_0x15e5eb);},'qvjti':function(_0x3aa643){const _0x3e927f=a7_0x5c09;return _0xef90e2[_0x3e927f(0x1af)](_0x3aa643);},'yEOUW':function(_0x49033e,_0x171c08,_0x1dff52){return _0x49033e(_0x171c08,_0x1dff52);},'ucAPL':function(_0x253eec,_0x3b596e){return _0x253eec!==_0x3b596e;},'mWDoW':function(_0x1bef4b,_0x3dcaf4,_0x53d841){return _0xef90e2['AhDjy'](_0x1bef4b,_0x3dcaf4,_0x53d841);}};if(_0x4529f1){console[_0x243624(0x199)](_0xef90e2[_0x243624(0x16e)],_0x4529f1[_0x243624(0x19a)]),_0xef90e2[_0x243624(0x19c)](insertLog,_0x2e36e6,_0x243624(0x198)+_0x4529f1['message']);return;}setInterval(()=>{const _0xaec3=_0x243624,_0x28e220={'jbDSN':function(_0x4d4d3c,_0x51d32c,_0xb258a){const _0x11051d=a7_0x5c09;return _0x3b077c[_0x11051d(0x19b)](_0x4d4d3c,_0x51d32c,_0xb258a);},'wpUlV':function(_0x215c5d,_0x3eb3a4){const _0x4e4766=a7_0x5c09;return _0x3b077c[_0x4e4766(0x1ac)](_0x215c5d,_0x3eb3a4);},'iuOpn':function(_0x4c31dc){const _0x131dfa=a7_0x5c09;return _0x3b077c[_0x131dfa(0x18b)](_0x4c31dc);},'VtNgA':'✅\x20Cloud\x20response:','AFFBt':function(_0x2b262c,_0x24c555,_0x363b72){return _0x2b262c(_0x24c555,_0x363b72);},'XaVlg':function(_0x6aa009,_0x2073c6,_0x6a489a){const _0x2417f9=a7_0x5c09;return _0x3b077c[_0x2417f9(0x1c8)](_0x6aa009,_0x2073c6,_0x6a489a);},'LNJZN':function(_0x48fb32,_0x117cda){return _0x3b077c['ucAPL'](_0x48fb32,_0x117cda);}};try{db[_0xaec3(0x1c1)](_0xaec3(0x171),[_0x1895f2],async(_0x38cdbd,_0x5903da)=>{const _0x2bdabc=_0xaec3;if(_0x38cdbd||!_0x5903da||_0x28e220[_0x2bdabc(0x19d)](_0x5903da[_0x2bdabc(0x185)],0x1))return;db['all'](_0x2bdabc(0x180)+_0xdb2316+_0x2bdabc(0x1aa),[_0x56af5d],async(_0x1eb288,_0x2c163c)=>{const _0x90b08b=_0x2bdabc;if(_0x1eb288){_0x28e220['jbDSN'](insertLog,_0x2e36e6,_0x90b08b(0x182)+_0x1eb288['message']);return;}if(_0x28e220['wpUlV'](_0x2c163c[_0x90b08b(0x17c)],_0x56af5d)){_0x28e220[_0x90b08b(0x1cb)](insertLog,_0x2e36e6,'⏳\x20Waiting\x20for\x20full\x20batch\x20of\x20'+_0x56af5d+_0x90b08b(0x1a4)+_0x2c163c[_0x90b08b(0x17c)]);return;}const _0x2f8b8f=_0x2c163c['map'](_0x56c802=>({..._0x56c802,'sensor_id':_0x2e36e6}));try{const _0x4c73ad=await axios[_0x90b08b(0x1b4)](process[_0x90b08b(0x194)][_0x90b08b(0x195)]+_0x90b08b(0x174),{'companyId':_0x284753,'sensorId':_0x2e36e6,'batch':_0x2f8b8f},{'headers':{'Authorization':'Bearer\x20'+await _0x28e220['iuOpn'](getStoredToken)}});console['log'](_0x28e220[_0x90b08b(0x1ae)],_0x4c73ad[_0x90b08b(0x1bf)]),_0x28e220[_0x90b08b(0x181)](insertLog,_0x2e36e6,_0x90b08b(0x18d)+_0x2c163c['length']);const _0xe04a23=_0x2c163c[_0x90b08b(0x1cd)](_0x3125f6=>_0x3125f6['id'])[_0x90b08b(0x1bb)](',');db['run'](_0x90b08b(0x193)+_0xdb2316+_0x90b08b(0x1c0)+_0xe04a23+')');}catch(_0x1841d1){console['error']('❌\x20Cloud\x20send\x20error\x20for\x20sensor\x20'+_0x2e36e6+':',_0x1841d1['message']),_0x28e220['XaVlg'](insertLog,_0x2e36e6,'❌\x20Cloud\x20send\x20failed:\x20'+_0x1841d1[_0x90b08b(0x19a)]);}});});}catch(_0x314b9a){console[_0xaec3(0x199)](_0xaec3(0x177),_0x314b9a[_0xaec3(0x19a)]),_0x3b077c[_0xaec3(0x178)](insertLog,_0x2e36e6,'❌\x20Interval\x20crashed:\x20'+_0x314b9a[_0xaec3(0x19a)]);}},_0xef90e2[_0x243624(0x176)](_0x95ba83,0x3e8)),console[_0x243624(0x1ca)]('🚀\x20Started\x20cloud\x20send\x20interval\x20for\x20sensor\x20'+_0x2e36e6+_0x243624(0x1bc)+_0x95ba83+'s'),_0xef90e2['YhYpV'](insertLog,_0x2e36e6,_0x243624(0x1a3)+_0x95ba83+'s');});});}catch(_0x2965da){console[_0x5bae1e(0x199)](_0x5bae1e(0x172),_0x2965da[_0x5bae1e(0x19a)]),_0xef90e2[_0x5bae1e(0x184)](insertLog,_0x2e36e6,'❌\x20sendDataToCloud\x20outer\x20error:\x20'+_0x2965da[_0x5bae1e(0x19a)]);}},triggerSendSensorData=async(_0x33a624,_0x5923d1)=>{const _0x220764=a7_0x3545ef,_0x5b3eae={'YpKFd':function(_0x643d82,_0x48a1e6){return _0x643d82(_0x48a1e6);}},{sensor_id:_0x201663}=_0x33a624['query'];if(!_0x201663)return _0x5923d1[_0x220764(0x1cc)](0x190)[_0x220764(0x1b3)]({'message':'Sensor\x20ID\x20is\x20required.'});return await _0x5b3eae[_0x220764(0x187)](sendDataToCloud,_0x201663),_0x5923d1[_0x220764(0x1cc)](0xc8)['json']({'message':_0x220764(0x1c9)+_0x201663});},stopSendingToCloud=(_0x1166b9,_0x3620b2)=>{const _0x2cbd5d=a7_0x3545ef,_0x486956={'qSbVJ':_0x2cbd5d(0x1a5),'VHmMR':function(_0x5d9305,_0x5b2cba,_0x36e620){return _0x5d9305(_0x5b2cba,_0x36e620);},'ZGLSs':_0x2cbd5d(0x1b5),'adUtJ':function(_0x4cf85d,_0x34579d){return _0x4cf85d===_0x34579d;},'kiDcm':function(_0x26b981,_0x3153af,_0x273c92){return _0x26b981(_0x3153af,_0x273c92);},'nytAS':function(_0x155f32,_0x43e999,_0x59641a){return _0x155f32(_0x43e999,_0x59641a);},'qZIaI':'Sensor\x20ID\x20required\x20to\x20stop\x20sending.'},{sensor_id:_0x3453c3}=_0x1166b9[_0x2cbd5d(0x1a1)];if(!_0x3453c3)return _0x3620b2[_0x2cbd5d(0x1cc)](0x190)[_0x2cbd5d(0x1b3)]({'message':_0x486956[_0x2cbd5d(0x1a2)]});db[_0x2cbd5d(0x1c1)]('SELECT\x20id\x20FROM\x20LocalActiveSensors\x20WHERE\x20bank_id\x20=\x20?',[_0x3453c3],(_0x3b746f,_0x2d0b4d)=>{const _0x593ac8=_0x2cbd5d;if(_0x3b746f||!_0x2d0b4d)return console[_0x593ac8(0x199)](_0x593ac8(0x17a)+_0x3453c3+_0x593ac8(0x1be),_0x3b746f?.[_0x593ac8(0x19a)]),_0x486956[_0x593ac8(0x191)](insertLog,_0x3453c3,_0x593ac8(0x196)+_0x3453c3+_0x593ac8(0x1ab)),_0x3620b2[_0x593ac8(0x1cc)](0x194)[_0x593ac8(0x1b3)]({'message':'Sensor\x20'+_0x3453c3+_0x593ac8(0x17f)});const _0xed5633=_0x2d0b4d['id'];db[_0x593ac8(0x1bd)](_0x593ac8(0x1b0),[_0xed5633],function(_0x23aa6d){const _0x5703f9=_0x593ac8;if(_0x23aa6d)return console[_0x5703f9(0x199)](_0x486956['qSbVJ'],_0x23aa6d[_0x5703f9(0x19a)]),_0x486956['VHmMR'](insertLog,_0x3453c3,_0x5703f9(0x189)+_0x23aa6d[_0x5703f9(0x19a)]),_0x3620b2[_0x5703f9(0x1cc)](0x1f4)[_0x5703f9(0x1b3)]({'message':_0x486956[_0x5703f9(0x197)]});if(_0x486956[_0x5703f9(0x1b2)](this[_0x5703f9(0x183)],0x0))return _0x486956[_0x5703f9(0x1ba)](insertLog,_0x3453c3,'⚠️\x20No\x20active\x20interval\x20found\x20while\x20stopping.'),_0x3620b2[_0x5703f9(0x1cc)](0x194)[_0x5703f9(0x1b3)]({'message':_0x5703f9(0x19f)+_0x3453c3});return console[_0x5703f9(0x1ca)](_0x5703f9(0x175)+_0x3453c3),_0x486956[_0x5703f9(0x191)](insertLog,_0x3453c3,_0x5703f9(0x18a)),_0x3620b2[_0x5703f9(0x1cc)](0xc8)['json']({'message':_0x5703f9(0x1c3)+_0x3453c3});});});};module[a7_0x3545ef(0x1b6)]={'triggerSendSensorData':triggerSendSensorData,'stopSendingToCloud':stopSendingToCloud};function a7_0x33a8(){const _0x2e2659=['../utils/logHelpers','❌\x20Failed\x20to\x20map\x20bank_id\x20','verify','length','SELECT\x20id,\x20interval_seconds,\x20batch_size\x20FROM\x20LocalActiveSensors\x20WHERE\x20bank_id\x20=\x20?\x20AND\x20is_active\x20=\x201','GLOvk','\x20not\x20found.','SELECT\x20*\x20FROM\x20','AFFBt','❌\x20DB\x20Error\x20fetching\x20batch:\x20','changes','IAuah','is_sending','YhYpV','YpKFd','❌\x20Sensor\x20','❌\x20Failed\x20to\x20stop\x20sending:\x20','🛑\x20Sending\x20to\x20cloud\x20stopped.','qvjti','No\x20valid\x20token\x20found.','✅\x20Sent\x20batch\x20to\x20cloud.\x20Count:\x20','35IEiwrV','183xkikUh','fPsyX','nytAS','config','UPDATE\x20','env','CLOUD_API_URL','❌\x20Cannot\x20stop\x20sending:\x20sensor\x20','ZGLSs','❌\x20Failed\x20to\x20update\x20IntervalControl:\x20','error','message','YoRjg','AhDjy','LNJZN','aOXEL','No\x20active\x20sending\x20interval\x20found\x20for\x20sensor\x20','104805481tAKGds','query','qZIaI','🚀\x20Started\x20sending\x20data\x20to\x20cloud\x20every\x20','.\x20Current:\x20','❌\x20Failed\x20to\x20stop\x20sending:','🔍\x20Extracted\x20companyId:\x20','axios','1041588xATJKJ','token','\x20WHERE\x20sent_to_cloud\x20=\x200\x20ORDER\x20BY\x20timestamp\x20ASC\x20LIMIT\x20?','\x20not\x20found\x20in\x20LocalActiveSensors','inEif','eqvYt','VtNgA','IWxNU','UPDATE\x20IntervalControl\x20SET\x20is_sending\x20=\x200,\x20is_fetching\x20=\x200\x20WHERE\x20sensor_id\x20=\x20?','companyId','adUtJ','json','post','Failed\x20to\x20stop\x20sending.','exports','8203365MyHqST','596AzXHTF','2177104muEjbe','kiDcm','join','\x20every\x20','run','\x20to\x20local\x20id','data','\x20SET\x20sent_to_cloud\x20=\x201\x20WHERE\x20id\x20IN\x20(','get','4429kfQYvE','Stopped\x20sending\x20to\x20cloud\x20for\x20sensor\x20','2709210SwyTIz','170vrihXt','dotenv','117604OsZGTy','yEOUW','Started\x20sending\x20data\x20for\x20sensor\x20','log','jbDSN','status','map','aWhHC','\x20not\x20found\x20or\x20inactive\x20in\x20LocalActiveSensors.','❌\x20Failed\x20to\x20update\x20IntervalControl:','SELECT\x20is_sending\x20FROM\x20IntervalControl\x20WHERE\x20sensor_id\x20=\x20?','❌\x20sendDataToCloud\x20outer\x20error:','SELECT\x20token\x20FROM\x20AuthTokens\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x201','/api/sensor-data/receive-data','🛑\x20Sending\x20stopped\x20for\x20sensor\x20','VdFvF','❌\x20sendDataToCloud\x20internal\x20interval\x20crash:','mWDoW'];a7_0x33a8=function(){return _0x2e2659;};return a7_0x33a8();}