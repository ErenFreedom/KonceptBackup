const a0_0x47ddfa=a0_0x27a6;function a0_0xebf0(){const _0x38bc38=['DApRg','LayQn','Sensor\x20ID\x20is\x20required.','length','vyQQq','❌\x20Failed\x20to\x20stop\x20jobs:\x20','/api/sensor-data/receive-data','SELECT\x20is_sending\x20FROM\x20IntervalControl\x20WHERE\x20sensor_id\x20=\x20?','❌\x20Interval\x20crash\x20(send):\x20','SELECT\x20token\x20FROM\x20AuthTokens\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x201','status','stopFetch','is_sending','get','map','TJPFG','message','dotenv','\x20to\x20local\x20id','error','caHcg','json','\x20not\x20found\x20or\x20inactive\x20in\x20LocalActiveSensors.','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INSERT\x20INTO\x20IntervalControl\x20(sensor_id,\x20is_sending)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(sensor_id)\x20DO\x20UPDATE\x20SET\x20is_sending\x20=\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20','3272885yaVuvU','companyId','❌\x20DB\x20Error\x20fetching\x20batch:\x20','❌\x20sendDataToCloud\x20outer\x20error:','Sensor\x20','iiIdm','🚀\x20Started\x20cloud\x20send\x20interval\x20for\x20sensor\x20','all','CLOUD_API_URL','PnTHl','query','🚀\x20Started\x20sending\x20data\x20to\x20cloud\x20every\x20','❌\x20Cannot\x20stop\x20sending:\x20sensor\x20','mKvvx','UPDATE\x20IntervalControl\x20SET\x20is_sending\x20=\x200,\x20is_fetching\x20=\x200\x20WHERE\x20sensor_id\x20=\x20?','SELECT\x20*\x20FROM\x20','UiPau','✅\x20Sent\x20batch\x20to\x20cloud.\x20Count:\x20','yKzqT','912hywZtG','PKJLo','❌\x20Failed\x20to\x20map\x20bank_id\x20','505180JFVHIz','750813MTYkvT','\x20SET\x20sent_to_cloud\x20=\x201\x20WHERE\x20id\x20IN\x20(','post','tvcYs','KUsvx','\x20not\x20found\x20or\x20inactive.','mivnc','24wZyRvC','SELECT\x20id,\x20interval_seconds,\x20batch_size\x20FROM\x20LocalActiveSensors\x20WHERE\x20bank_id\x20=\x20?\x20AND\x20is_active\x20=\x201','FzkWY','../utils/intervalManager','env','Started\x20sending\x20data\x20for\x20sensor\x20','join','sfxBz','SensorData_','32756iKHCqC','❌\x20Sensor\x20','7HfoqWc','corKD','SELECT\x20id\x20FROM\x20LocalActiveSensors\x20WHERE\x20bank_id\x20=\x20?','82vbqATl','kSskf','stopSend','\x0a\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20IntervalControl\x20(\x0a\x20\x20\x20\x20sensor_id\x20INTEGER\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20is_fetching\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20is_sending\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20FOREIGN\x20KEY\x20(sensor_id)\x20REFERENCES\x20LocalActiveSensors(id)\x20ON\x20DELETE\x20CASCADE\x0a\x20\x20)\x0a','❌\x20Failed\x20to\x20update\x20IntervalControl:\x20','startSend','\x20not\x20found\x20in\x20LocalActiveSensors','jsonwebtoken','3|2|0|4|1','../db/sensorDB','Bearer\x20','split','../utils/logHelpers','Sensor\x20ID\x20required\x20to\x20stop\x20sending.','WTuQE','Failed\x20to\x20stop\x20jobs.','lMoSp','log','✅\x20Cloud\x20response:','13950937sMHAYw','❌\x20Failed\x20to\x20update\x20IntervalControl:','636453RKxvXo','yvhIE','run','Stopped\x20all\x20jobs\x20for\x20sensor\x20','6dFVTDE','80uVXnhW','axios','NzVUx','orJKf','3969024KscfAB','mVIQo','🛑\x20Sending\x20and\x20Fetching\x20jobs\x20stopped.','config','YsqoS','ZHFPe','JWT_SECRET_APP'];a0_0xebf0=function(){return _0x38bc38;};return a0_0xebf0();}(function(_0x4e7b4d,_0x49a252){const _0x12a2ec=a0_0x27a6,_0x2dc702=_0x4e7b4d();while(!![]){try{const _0x1365f0=-parseInt(_0x12a2ec(0x119))/0x1*(parseInt(_0x12a2ec(0x11e))/0x2)+parseInt(_0x12a2ec(0x109))/0x3*(-parseInt(_0x12a2ec(0x110))/0x4)+-parseInt(_0x12a2ec(0xf2))/0x5*(parseInt(_0x12a2ec(0xce))/0x6)+parseInt(_0x12a2ec(0x11b))/0x7*(-parseInt(_0x12a2ec(0xd3))/0x8)+-parseInt(_0x12a2ec(0xca))/0x9*(-parseInt(_0x12a2ec(0xcf))/0xa)+parseInt(_0x12a2ec(0xc8))/0xb+parseInt(_0x12a2ec(0x105))/0xc*(parseInt(_0x12a2ec(0x108))/0xd);if(_0x1365f0===_0x49a252)break;else _0x2dc702['push'](_0x2dc702['shift']());}catch(_0x1bdad7){_0x2dc702['push'](_0x2dc702['shift']());}}}(a0_0xebf0,0xc15e4));const axios=require(a0_0x47ddfa(0xd0)),jwt=require(a0_0x47ddfa(0xbc)),{insertLog}=require(a0_0x47ddfa(0xc1)),intervalManager=require(a0_0x47ddfa(0x113)),{db}=require(a0_0x47ddfa(0xbe));require(a0_0x47ddfa(0xeb))[a0_0x47ddfa(0xd6)](),db[a0_0x47ddfa(0xcc)](a0_0x47ddfa(0x121));const getStoredToken=()=>{const _0x156b89=a0_0x47ddfa,_0x2a3795={'YsqoS':function(_0x136c6e,_0x85ce8e){return _0x136c6e||_0x85ce8e;},'TJPFG':function(_0x3d8ba3,_0x32f2dd){return _0x3d8ba3(_0x32f2dd);},'sCtTq':_0x156b89(0xe3)};return new Promise((_0x25dbae,_0x2180a3)=>{const _0x31bb85=_0x156b89;db[_0x31bb85(0xe7)](_0x2a3795['sCtTq'],[],(_0x1d0a31,_0x54647d)=>{const _0x1f9d87=_0x31bb85;if(_0x2a3795[_0x1f9d87(0xd7)](_0x1d0a31,!_0x54647d))return _0x2a3795[_0x1f9d87(0xe9)](_0x2180a3,'No\x20valid\x20token\x20found.');_0x25dbae(_0x54647d['token']);});});},getCompanyIdFromToken=async()=>{const _0x5d6cb6=a0_0x47ddfa,_0x11484a={'DApRg':function(_0x5c0ab6){return _0x5c0ab6();}},_0xfb83fe=await _0x11484a[_0x5d6cb6(0xda)](getStoredToken),_0x179c48=jwt['verify'](_0xfb83fe,process[_0x5d6cb6(0x114)][_0x5d6cb6(0xd9)]);return _0x179c48[_0x5d6cb6(0xf3)];},sendDataToCloud=async _0x12f606=>{const _0x3fda38=a0_0x47ddfa,_0x22d2d2={'KUsvx':function(_0x39d50f,_0x21f59c,_0x15587b){return _0x39d50f(_0x21f59c,_0x15587b);},'yKzqT':function(_0xc9210a){return _0xc9210a();},'UHixb':function(_0x45ad85,_0x320533){return _0x45ad85!==_0x320533;},'UiPau':_0x3fda38(0xc9),'mivnc':function(_0x53b95d,_0x5a59f6,_0x18c1c3){return _0x53b95d(_0x5a59f6,_0x18c1c3);},'WTuQE':function(_0x38d590,_0x44a33e){return _0x38d590*_0x44a33e;},'FSgZT':function(_0x307aaf,_0x49dda0){return _0x307aaf||_0x49dda0;},'yvhIE':_0x3fda38(0xf5)};try{const _0x12291d=await getCompanyIdFromToken(),_0x179e49=_0x3fda38(0x118)+_0x12291d+'_'+_0x12f606;db[_0x3fda38(0xe7)](_0x3fda38(0x111),[_0x12f606],(_0x448a83,_0x21212e)=>{const _0x488bae=_0x3fda38;if(_0x22d2d2['FSgZT'](_0x448a83,!_0x21212e)){console[_0x488bae(0xed)](_0x488bae(0x11a)+_0x12f606+_0x488bae(0x10e),_0x448a83?.[_0x488bae(0xea)]),insertLog(_0x12f606,_0x488bae(0x11a)+_0x12f606+_0x488bae(0xf0));return;}const {id:_0x3c4f96,interval_seconds:_0x25de26,batch_size:_0x210417}=_0x21212e;db['run'](_0x488bae(0xf1),[_0x3c4f96],_0x54a9c8=>{const _0x56b86f=_0x488bae,_0x53920f={'mKvvx':function(_0x1f8092,_0x25b0db,_0x524c2d){const _0x518698=a0_0x27a6;return _0x22d2d2[_0x518698(0x10d)](_0x1f8092,_0x25b0db,_0x524c2d);},'iiIdm':function(_0x5ad7a9){const _0x80d31d=a0_0x27a6;return _0x22d2d2[_0x80d31d(0x104)](_0x5ad7a9);},'PKJLo':_0x56b86f(0xc7),'sfxBz':function(_0x222d09,_0x1dc256){return _0x22d2d2['UHixb'](_0x222d09,_0x1dc256);},'lMoSp':function(_0xa68a1d,_0x1a97e5,_0x27ec41){return _0x22d2d2['KUsvx'](_0xa68a1d,_0x1a97e5,_0x27ec41);}};if(_0x54a9c8){console[_0x56b86f(0xed)](_0x22d2d2[_0x56b86f(0x102)],_0x54a9c8[_0x56b86f(0xea)]),_0x22d2d2[_0x56b86f(0x10f)](insertLog,_0x12f606,_0x56b86f(0x122)+_0x54a9c8[_0x56b86f(0xea)]);return;}intervalManager[_0x56b86f(0xba)](_0x12f606,async()=>{const _0x388e99=_0x56b86f,_0x3fa8db={'vyQQq':function(_0x4f5ed3,_0x119272,_0xd89c9a){const _0x58b492=a0_0x27a6;return _0x53920f[_0x58b492(0xff)](_0x4f5ed3,_0x119272,_0xd89c9a);},'kSskf':function(_0x4dceea){const _0x594f6a=a0_0x27a6;return _0x53920f[_0x594f6a(0xf7)](_0x4dceea);},'PnTHl':_0x53920f[_0x388e99(0x106)],'caHcg':function(_0x576f00,_0x3936d3){return _0x576f00||_0x3936d3;},'corKD':function(_0x26fa79,_0x3368c5){const _0x217126=_0x388e99;return _0x53920f[_0x217126(0x117)](_0x26fa79,_0x3368c5);}};try{db[_0x388e99(0xe7)](_0x388e99(0xe1),[_0x3c4f96],async(_0x525de1,_0x1f878b)=>{const _0x544912=_0x388e99,_0x23e776={'DrrNF':function(_0x476966,_0x440123,_0x2efca2){const _0x2d877b=a0_0x27a6;return _0x3fa8db[_0x2d877b(0xde)](_0x476966,_0x440123,_0x2efca2);},'orJKf':function(_0x12f559){const _0x5c16ec=a0_0x27a6;return _0x3fa8db[_0x5c16ec(0x11f)](_0x12f559);},'tvcYs':_0x3fa8db[_0x544912(0xfb)]};if(_0x3fa8db[_0x544912(0xee)](_0x525de1,!_0x1f878b)||_0x3fa8db[_0x544912(0x11c)](_0x1f878b[_0x544912(0xe6)],0x1))return;db[_0x544912(0xf9)](_0x544912(0x101)+_0x179e49+'\x20WHERE\x20sent_to_cloud\x20=\x200\x20ORDER\x20BY\x20timestamp\x20ASC\x20LIMIT\x20?',[_0x210417],async(_0x336640,_0x5460af)=>{const _0x3bcb0a=_0x544912;if(_0x336640){_0x23e776['DrrNF'](insertLog,_0x12f606,_0x3bcb0a(0xf4)+_0x336640[_0x3bcb0a(0xea)]);return;}if(_0x5460af[_0x3bcb0a(0xdd)]<_0x210417){insertLog(_0x12f606,'⏳\x20Waiting\x20for\x20full\x20batch\x20of\x20'+_0x210417+'.\x20Current:\x20'+_0x5460af[_0x3bcb0a(0xdd)]);return;}const _0x5c7070=_0x5460af[_0x3bcb0a(0xe8)](_0x257fc5=>({..._0x257fc5,'sensor_id':_0x12f606}));try{const _0x35b9fa=await axios[_0x3bcb0a(0x10b)](process['env'][_0x3bcb0a(0xfa)]+_0x3bcb0a(0xe0),{'companyId':_0x12291d,'sensorId':_0x12f606,'batch':_0x5c7070},{'headers':{'Authorization':_0x3bcb0a(0xbf)+await _0x23e776[_0x3bcb0a(0xd2)](getStoredToken)}});console[_0x3bcb0a(0xc6)](_0x23e776[_0x3bcb0a(0x10c)],_0x35b9fa['data']),insertLog(_0x12f606,_0x3bcb0a(0x103)+_0x5460af[_0x3bcb0a(0xdd)]);const _0x1e46a3=_0x5460af[_0x3bcb0a(0xe8)](_0x38dc50=>_0x38dc50['id'])[_0x3bcb0a(0x116)](',');db['run']('UPDATE\x20'+_0x179e49+_0x3bcb0a(0x10a)+_0x1e46a3+')');}catch(_0x478c4){console[_0x3bcb0a(0xed)]('❌\x20Cloud\x20send\x20error\x20for\x20sensor\x20'+_0x12f606+':',_0x478c4['message']),_0x23e776['DrrNF'](insertLog,_0x12f606,'❌\x20Cloud\x20send\x20failed:\x20'+_0x478c4[_0x3bcb0a(0xea)]);}});});}catch(_0x10c68f){console[_0x388e99(0xed)]('❌\x20Interval\x20crash\x20(send)\x20for\x20sensor\x20'+_0x12f606+':',_0x10c68f['message']),_0x53920f[_0x388e99(0xc5)](insertLog,_0x12f606,_0x388e99(0xe2)+_0x10c68f[_0x388e99(0xea)]);}},_0x22d2d2[_0x56b86f(0xc3)](_0x25de26,0x3e8)),console[_0x56b86f(0xc6)](_0x56b86f(0xf8)+_0x12f606),insertLog(_0x12f606,_0x56b86f(0xfd)+_0x25de26+'s');});});}catch(_0x1bcadc){console['error'](_0x22d2d2[_0x3fda38(0xcb)],_0x1bcadc['message']),_0x22d2d2['mivnc'](insertLog,_0x12f606,'❌\x20sendDataToCloud\x20outer\x20error:\x20'+_0x1bcadc[_0x3fda38(0xea)]);}},triggerSendSensorData=async(_0x551e0e,_0x19c71d)=>{const _0x4a0dd9=a0_0x47ddfa,_0x312cd3={'mVIQo':function(_0x239c7f,_0xbe45b4){return _0x239c7f(_0xbe45b4);}},{sensor_id:_0x22c90b}=_0x551e0e[_0x4a0dd9(0xfc)];if(!_0x22c90b)return _0x19c71d[_0x4a0dd9(0xe4)](0x190)['json']({'message':_0x4a0dd9(0xdc)});return await _0x312cd3[_0x4a0dd9(0xd4)](sendDataToCloud,_0x22c90b),_0x19c71d[_0x4a0dd9(0xe4)](0xc8)[_0x4a0dd9(0xef)]({'message':_0x4a0dd9(0x115)+_0x22c90b});},stopSendingToCloud=(_0x243b0b,_0x4bcf1c)=>{const _0x406057=a0_0x47ddfa,_0xb574f1={'ieTmI':_0x406057(0xbd),'NzVUx':function(_0x2e59f0,_0x56e1a4,_0x2cd1e7){return _0x2e59f0(_0x56e1a4,_0x2cd1e7);},'FzkWY':_0x406057(0xc4),'liEpB':function(_0x3f3749,_0x2421d5){return _0x3f3749||_0x2421d5;},'LayQn':function(_0x192a7b,_0x392ac8,_0x4f671d){return _0x192a7b(_0x392ac8,_0x4f671d);},'ZHFPe':_0x406057(0xc2)},{sensor_id:_0x392c09}=_0x243b0b[_0x406057(0xfc)];if(!_0x392c09)return _0x4bcf1c[_0x406057(0xe4)](0x190)[_0x406057(0xef)]({'message':_0xb574f1[_0x406057(0xd8)]});db[_0x406057(0xe7)](_0x406057(0x11d),[_0x392c09],(_0x102b8f,_0x15799c)=>{const _0x115708=_0x406057;if(_0xb574f1['liEpB'](_0x102b8f,!_0x15799c))return console['error'](_0x115708(0x107)+_0x392c09+_0x115708(0xec),_0x102b8f?.[_0x115708(0xea)]),_0xb574f1[_0x115708(0xdb)](insertLog,_0x392c09,_0x115708(0xfe)+_0x392c09+_0x115708(0xbb)),_0x4bcf1c['status'](0x194)[_0x115708(0xef)]({'message':_0x115708(0xf6)+_0x392c09+'\x20not\x20found.'});const _0x486274=_0x15799c['id'];db[_0x115708(0xcc)](_0x115708(0x100),[_0x486274],function(_0x3fd433){const _0x5551e8=_0x115708,_0x300abd=_0xb574f1['ieTmI'][_0x5551e8(0xc0)]('|');let _0x4dafe7=0x0;while(!![]){switch(_0x300abd[_0x4dafe7++]){case'0':intervalManager[_0x5551e8(0xe5)](_0x392c09);continue;case'1':return _0x4bcf1c[_0x5551e8(0xe4)](0xc8)[_0x5551e8(0xef)]({'message':_0x5551e8(0xcd)+_0x392c09});case'2':intervalManager[_0x5551e8(0x120)](_0x392c09);continue;case'3':if(_0x3fd433)return console[_0x5551e8(0xed)]('❌\x20Failed\x20to\x20stop\x20jobs:',_0x3fd433[_0x5551e8(0xea)]),_0xb574f1[_0x5551e8(0xd1)](insertLog,_0x392c09,_0x5551e8(0xdf)+_0x3fd433['message']),_0x4bcf1c['status'](0x1f4)['json']({'message':_0xb574f1[_0x5551e8(0x112)]});continue;case'4':insertLog(_0x392c09,_0x5551e8(0xd5));continue;}break;}});});};function a0_0x27a6(_0x59ea35,_0x472a6f){const _0xebf0e0=a0_0xebf0();return a0_0x27a6=function(_0x27a6b4,_0x1ca13b){_0x27a6b4=_0x27a6b4-0xba;let _0x1a5ea8=_0xebf0e0[_0x27a6b4];return _0x1a5ea8;},a0_0x27a6(_0x59ea35,_0x472a6f);}module['exports']={'triggerSendSensorData':triggerSendSensorData,'stopSendingToCloud':stopSendingToCloud,'sendDataToCloud':sendDataToCloud};